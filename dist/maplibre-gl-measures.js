(function(J,L){typeof exports=="object"&&typeof module<"u"?L(exports):typeof define=="function"&&define.amd?define(["exports"],L):(J=typeof globalThis<"u"?globalThis:J||self,L(J.maplibreGLMeasures={}))})(this,(function(J){"use strict";const L={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},U={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},M={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},F={POLYGON:"polygon",LINE:"line_string",POINT:"point"},m={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},_={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},A={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Q={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},w={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},O={ACTIVE:"true",INACTIVE:"false"},kt=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Mn=-90,Se=-85,Sn=90,Te=85,Ut=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:Sn,LAT_MIN:Mn,LAT_RENDERED_MAX:Te,LAT_RENDERED_MIN:Se,LNG_MAX:270,LNG_MIN:-270,activeStates:O,classes:L,cursors:M,events:A,geojsonTypes:m,interactions:kt,meta:w,modes:_,sources:U,types:F,updateActions:Q},Symbol.toStringTag,{value:"Module"}));function ae(e){return function(t){const r=t.featureTarget;return!r||!r.properties?!1:r.properties.meta===e}}function qt(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function W(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===O.ACTIVE&&e.featureTarget.properties.meta===w.FEATURE}function Le(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===O.INACTIVE&&e.featureTarget.properties.meta===w.FEATURE}function se(e){return e.featureTarget===void 0}function Oe(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===w.FEATURE}function j(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===w.VERTEX}function le(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function ue(e){return e.key==="Escape"||e.keyCode===27}function ce(e){return e.key==="Enter"||e.keyCode===13}function Ie(e){return e.key==="Backspace"||e.keyCode===8}function we(e){return e.key==="Delete"||e.keyCode===46}function Gt(e){return e.key==="1"||e.keyCode===49}function Vt(e){return e.key==="2"||e.keyCode===50}function xt(e){return e.key==="3"||e.keyCode===51}function Bt(e){const t=e.key||String.fromCharCode(e.keyCode);return t>="0"&&t<="9"}function Tn(){return!0}const Ln=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:W,isBackspaceKey:Ie,isDeleteKey:we,isDigit1Key:Gt,isDigit2Key:Vt,isDigit3Key:xt,isDigitKey:Bt,isEnterKey:ce,isEscapeKey:ue,isFeature:Oe,isInactiveFeature:Le,isOfMetaType:ae,isShiftDown:le,isShiftMousedown:qt,isTrue:Tn,isVertex:j,noTarget:se},Symbol.toStringTag,{value:"Module"}));function pe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var de={},ee={},$t;function On(){return $t||($t=1,ee.RADIUS=6378137,ee.FLATTENING=1/298.257223563,ee.POLAR_RADIUS=63567523142e-4),ee}var Kt;function In(){if(Kt)return de;Kt=1;var e=On();de.geometry=t,de.ring=n;function t(o){var a=0,s;switch(o.type){case"Polygon":return r(o.coordinates);case"MultiPolygon":for(s=0;s<o.coordinates.length;s++)a+=r(o.coordinates[s]);return a;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(s=0;s<o.geometries.length;s++)a+=t(o.geometries[s]);return a}}function r(o){var a=0;if(o&&o.length>0){a+=Math.abs(n(o[0]));for(var s=1;s<o.length;s++)a-=Math.abs(n(o[s]))}return a}function n(o){var a,s,l,c,h,d,u,p=0,f=o.length;if(f>2){for(u=0;u<f;u++)u===f-2?(c=f-2,h=f-1,d=0):u===f-1?(c=f-1,h=0,d=1):(c=u,h=u+1,d=u+2),a=o[c],s=o[h],l=o[d],p+=(i(l[0])-i(a[0]))*Math.sin(i(s[1]));p=p*e.RADIUS*e.RADIUS/2}return p}function i(o){return o*Math.PI/180}return de}var wn=In();const An=pe(wn),Ht={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Pn(e,t){const r=Ht[e.geometry.type]-Ht[t.geometry.type];return r===0&&e.geometry.type===m.POLYGON?e.area-t.area:r}function zt(e){return e.map(t=>(t.geometry.type===m.POLYGON&&(t.area=An.geometry({type:m.FEATURE,property:{},geometry:t.geometry})),t)).sort(Pn).map(t=>(delete t.area,t))}function Wt(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function q(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,r=e.length;t<r;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}q.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)},q.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)},q.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0},q.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,r)=>t.v-r.v).map(t=>t.k)},q.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const Nn=[w.FEATURE,w.MIDPOINT,w.VERTEX],Y={click:Rn,touch:Fn};function Rn(e,t,r){return Jt(e,t,r,r.options.clickBuffer)}function Fn(e,t,r){return Jt(e,t,r,r.options.touchBuffer)}function Jt(e,t,r,n){if(r.map===null)return[];const i=e?Wt(e,n):t,o={};r.options.styles&&(o.layers=r.options.styles.map(c=>c.id).filter(c=>r.map.getLayer(c)!=null));const a=r.map.queryRenderedFeatures(i,o).filter(c=>Nn.indexOf(c.properties.meta)!==-1),s=new q,l=[];return a.forEach(c=>{const h=c.properties.id;s.has(h)||(s.add(h),l.push(c))}),zt(l)}function he(e,t){const r=Y.click(e,null,t),n={mouse:M.NONE};return r[0]&&(n.mouse=r[0].properties.active===O.ACTIVE?M.MOVE:M.POINTER,n.feature=r[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(n.mouse=M.ADD),t.ui.queueMapClasses(n),t.ui.updateMapClasses(),r[0]}function Ae(e,t){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}const Dn=4,kn=12,Un=500;function Pe(e,t,r={}){const n=r.fineTolerance!=null?r.fineTolerance:Dn,i=r.grossTolerance!=null?r.grossTolerance:kn,o=r.interval!=null?r.interval:Un;e.point=e.point||t.point,e.time=e.time||t.time;const a=Ae(e.point,t.point);return a<n||a<i&&t.time-e.time<o}const qn=25,Gn=250;function Ne(e,t,r={}){const n=r.tolerance!=null?r.tolerance:qn,i=r.interval!=null?r.interval:Gn;return e.point=e.point||t.point,e.time=e.time||t.time,Ae(e.point,t.point)<n&&t.time-e.time<i}const Re=function(e,t){const r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},n={on(o,a,s){if(r[o]===void 0)throw new Error(`Invalid event type: ${o}`);r[o].push({selector:a,fn:s})},render(o){t.store.featureChanged(o)}},i=function(o,a){const s=r[o];let l=s.length;for(;l--;){const c=s[l];if(c.selector(a)){c.fn.call(n,a)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(n),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(o){i("drag",o)},click(o){i("click",o)},mousemove(o){i("mousemove",o)},mousedown(o){i("mousedown",o)},mouseup(o){i("mouseup",o)},mouseout(o){i("mouseout",o)},keydown(o){i("keydown",o)},keyup(o){i("keyup",o)},touchstart(o){i("touchstart",o)},touchmove(o){i("touchmove",o)},touchend(o){i("touchend",o)},tap(o){i("tap",o)}}},Vn=((e,t=21)=>(r=t)=>{let n="",i=r|0;for(;i--;)n+=e[Math.random()*e.length|0];return n})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function Fe(){return Vn()}const P=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||Fe(),this.type=t.geometry.type};P.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},P.prototype.incomingCoords=function(e){this.setCoordinates(e)},P.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},P.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},P.prototype.setProperty=function(e,t){this.properties[e]=t},P.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:m.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},P.prototype.internal=function(e){const t={id:this.id,meta:w.FEATURE,"meta:type":this.type,active:O.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const r in this.properties)t[`user_${r}`]=this.properties[r];return{type:m.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const H=function(e,t){P.call(this,e,t)};H.prototype=Object.create(P.prototype),H.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},H.prototype.updateCoordinate=function(e,t,r){arguments.length===3?this.coordinates=[t,r]:this.coordinates=[e,t],this.changed()},H.prototype.getCoordinate=function(){return this.getCoordinates()};const $=function(e,t){P.call(this,e,t)};$.prototype=Object.create(P.prototype),$.prototype.isValid=function(){return this.coordinates.length>1},$.prototype.addCoordinate=function(e,t,r){this.changed();const n=parseInt(e,10);this.coordinates.splice(n,0,[t,r])},$.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},$.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},$.prototype.updateCoordinate=function(e,t,r){const n=parseInt(e,10);this.coordinates[n]=[t,r],this.changed()};const D=function(e,t){P.call(this,e,t),this.coordinates=this.coordinates.map(r=>r.slice(0,-1))};D.prototype=Object.create(P.prototype),D.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)},D.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()},D.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},D.prototype.addCoordinate=function(e,t,r){this.changed();const n=e.split(".").map(o=>parseInt(o,10));this.coordinates[n[0]].splice(n[1],0,[t,r])},D.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(n=>parseInt(n,10)),r=this.coordinates[t[0]];r&&(r.splice(t[1],1),r.length<3&&this.coordinates.splice(t[0],1))},D.prototype.getCoordinate=function(e){const t=e.split(".").map(n=>parseInt(n,10)),r=this.coordinates[t[0]];return JSON.parse(JSON.stringify(r[t[1]]))},D.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))},D.prototype.updateCoordinate=function(e,t,r){this.changed();const n=e.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10);this.coordinates[i]===void 0&&(this.coordinates[i]=[]),this.coordinates[i][o]=[t,r]};const xn={MultiPoint:H,MultiLineString:$,MultiPolygon:D},fe=(e,t,r,n,i)=>{const o=r.split("."),a=parseInt(o[0],10),s=o[1]?o.slice(1).join("."):null;return e[a][t](s,n,i)},N=function(e,t){if(P.call(this,e,t),delete this.coordinates,this.model=xn[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};N.prototype=Object.create(P.prototype),N.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(r=>new t(this.ctx,{id:Fe(),type:m.FEATURE,properties:{},geometry:{coordinates:r,type:this.type.replace("Multi","")}}))},N.prototype.isValid=function(){return this.features.every(e=>e.isValid())},N.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},N.prototype.getCoordinate=function(e){return fe(this.features,"getCoordinate",e)},N.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===m.POLYGON?e.getCoordinates():e.coordinates)))},N.prototype.updateCoordinate=function(e,t,r){fe(this.features,"updateCoordinate",e,t,r),this.changed()},N.prototype.addCoordinate=function(e,t,r){fe(this.features,"addCoordinate",e,t,r),this.changed()},N.prototype.removeCoordinate=function(e){fe(this.features,"removeCoordinate",e),this.changed()},N.prototype.getFeatures=function(){return this.features};function y(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}y.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},y.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,r)=>(t[r.feature_id]===void 0&&(t[r.feature_id]=!0,this._ctx.store.get(r.feature_id).changed()),t),{})},y.prototype.getSelected=function(){return this._ctx.store.getSelected()},y.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},y.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},y.prototype.getFeature=function(e){return this._ctx.store.get(e)},y.prototype.select=function(e){return this._ctx.store.select(e)},y.prototype.deselect=function(e){return this._ctx.store.deselect(e)},y.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)},y.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)},y.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},y.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},y.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},y.prototype.changeMode=function(e,t={},r={}){return this._ctx.events.changeMode(e,t,r)},y.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)},y.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},y.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},y.prototype.featuresAt=function(e,t,r="click"){if(r!=="click"&&r!=="touch")throw new Error("invalid buffer type");return Y[r](e,t,this._ctx)},y.prototype.newFeature=function(e){const t=e.geometry.type;return t===m.POINT?new H(this._ctx,e):t===m.LINE_STRING?new $(this._ctx,e):t===m.POLYGON?new D(this._ctx,e):new N(this._ctx,e)},y.prototype.isInstanceOf=function(e,t){if(e===m.POINT)return t instanceof H;if(e===m.LINE_STRING)return t instanceof $;if(e===m.POLYGON)return t instanceof D;if(e==="MultiFeature")return t instanceof N;throw new Error(`Unknown feature class: ${e}`)},y.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},y.prototype.onSetup=function(){},y.prototype.onDrag=function(){},y.prototype.onClick=function(){},y.prototype.onMouseMove=function(){},y.prototype.onMouseDown=function(){},y.prototype.onMouseUp=function(){},y.prototype.onMouseOut=function(){},y.prototype.onKeyUp=function(){},y.prototype.onKeyDown=function(){},y.prototype.onTouchStart=function(){},y.prototype.onTouchMove=function(){},y.prototype.onTouchEnd=function(){},y.prototype.onTap=function(){},y.prototype.onStop=function(){},y.prototype.onTrash=function(){},y.prototype.onCombineFeature=function(){},y.prototype.onUncombineFeature=function(){},y.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const Yt={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Bn=Object.keys(Yt);function $n(e){const t=Object.keys(e);return function(r,n={}){let i={};const o=t.reduce((s,l)=>(s[l]=e[l],s),new y(r));function a(s){return l=>o[s](i,l)}return{start(){i=o.onSetup(n),Bn.forEach(s=>{const l=Yt[s];let c=()=>!1;e[l]&&(c=()=>!0),this.on(s,c,a(l))})},stop(){o.onStop(i)},trash(){o.onTrash(i)},combineFeatures(){o.onCombineFeatures(i)},uncombineFeatures(){o.onUncombineFeatures(i)},render(s,l){o.toDisplayFeatures(i,s,l)}}}}function Kn(e){const t=Object.keys(e.options.modes).reduce((u,p)=>(u[p]=$n(e.options.modes[p]),u),{});let r={},n={};const i={};let o=null,a=null;i.drag=function(u,p){p({point:u.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:M.DRAG}),a.drag(u)):u.originalEvent.stopPropagation()},i.mousedrag=function(u){i.drag(u,p=>!Pe(r,p))},i.touchdrag=function(u){i.drag(u,p=>!Ne(n,p))},i.mousemove=function(u){if((u.originalEvent.buttons!==void 0?u.originalEvent.buttons:u.originalEvent.which)===1)return i.mousedrag(u);const f=he(u,e);u.featureTarget=f,a.mousemove(u)},i.mousedown=function(u){r={time:new Date().getTime(),point:u.point};const p=he(u,e);u.featureTarget=p,a.mousedown(u)},i.mouseup=function(u){const p=he(u,e);u.featureTarget=p,Pe(r,{point:u.point,time:new Date().getTime()})?a.click(u):a.mouseup(u)},i.mouseout=function(u){a.mouseout(u)},i.touchstart=function(u){if(!e.options.touchEnabled)return;n={time:new Date().getTime(),point:u.point};const p=Y.touch(u,null,e)[0];u.featureTarget=p,a.touchstart(u)},i.touchmove=function(u){if(e.options.touchEnabled)return a.touchmove(u),i.touchdrag(u)},i.touchend=function(u){if(u.originalEvent.preventDefault(),!e.options.touchEnabled)return;const p=Y.touch(u,null,e)[0];u.featureTarget=p,Ne(n,{time:new Date().getTime(),point:u.point})?a.tap(u):a.touchend(u)};const s=u=>{const p=Ie(u),f=we(u),g=Bt(u);return!(p||f||g)};i.keydown=function(u){(u.srcElement||u.target).classList.contains(L.CANVAS)&&((Ie(u)||we(u))&&e.options.controls.trash?(u.preventDefault(),a.trash()):s(u)?a.keydown(u):Gt(u)&&e.options.controls.point?l(_.DRAW_POINT):Vt(u)&&e.options.controls.line_string?l(_.DRAW_LINE_STRING):xt(u)&&e.options.controls.polygon&&l(_.DRAW_POLYGON))},i.keyup=function(u){s(u)&&a.keyup(u)},i.zoomend=function(){e.store.changeZoom()},i.data=function(u){if(u.dataType==="style"){const{setup:p,map:f,options:g,store:S}=e;g.styles.some(G=>f.getLayer(G.id))||(p.addLayers(),S.setDirty(),S.render())}};function l(u,p,f={}){a.stop();const g=t[u];if(g===void 0)throw new Error(`${u} is not valid`);o=u;const S=g(e,p);a=Re(S,e),f.silent||e.map.fire(A.MODE_CHANGE,{mode:u}),e.store.setDirty(),e.store.render()}const c={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function h(u){let p=!1;Object.keys(u).forEach(f=>{if(c[f]===void 0)throw new Error("Invalid action type");c[f]!==u[f]&&(p=!0),c[f]=u[f]}),p&&e.map.fire(A.ACTIONABLE,{actions:c})}return{start(){o=e.options.defaultMode,a=Re(t[o](e),e)},changeMode:l,actionable:h,currentModeName(){return o},currentModeRender(u,p){return a.render(u,p)},fire(u,p){e.map&&e.map.fire(u,p)},addEventListeners(){e.map.on("mousemove",i.mousemove),e.map.on("mousedown",i.mousedown),e.map.on("mouseup",i.mouseup),e.map.on("data",i.data),e.map.on("touchmove",i.touchmove),e.map.on("touchstart",i.touchstart),e.map.on("touchend",i.touchend),e.container.addEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",i.keydown),e.container.addEventListener("keyup",i.keyup))},removeEventListeners(){e.map.off("mousemove",i.mousemove),e.map.off("mousedown",i.mousedown),e.map.off("mouseup",i.mouseup),e.map.off("data",i.data),e.map.off("touchmove",i.touchmove),e.map.off("touchstart",i.touchstart),e.map.off("touchend",i.touchend),e.container.removeEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",i.keydown),e.container.removeEventListener("keyup",i.keyup))},trash(u){a.trash(u)},combineFeatures(){a.combineFeatures()},uncombineFeatures(){a.uncombineFeatures()},getMode(){return o}}}function te(e){return[].concat(e).filter(t=>t!==void 0)}function Hn(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(U.HOT)!==void 0))return l();const r=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:r});let n=[],i=[];e.isDirty?i=e.getAllIds():(n=e.getChangedIds().filter(c=>e.get(c)!==void 0),i=e.sources.hot.filter(c=>c.properties.id&&n.indexOf(c.properties.id)===-1&&e.get(c.properties.id)!==void 0).map(c=>c.properties.id)),e.sources.hot=[];const o=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(c=>{const h=c.properties.id||c.properties.parent;return n.indexOf(h)===-1});const a=o!==e.sources.cold.length||i.length>0;n.forEach(c=>s(c,"hot")),i.forEach(c=>s(c,"cold"));function s(c,h){const u=e.get(c).internal(r);e.ctx.events.currentModeRender(u,p=>{p.properties.mode=r,e.sources[h].push(p)})}a&&e.ctx.map.getSource(U.COLD).setData({type:m.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(U.HOT).setData({type:m.FEATURE_COLLECTION,features:e.sources.hot}),l();function l(){e.isDirty=!1,e.clearChangedIds()}}function b(e){this._features={},this._featureIds=new q,this._selectedFeatureIds=new q,this._selectedCoordinates=[],this._changedFeatureIds=new q,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,Hn.call(this),this._emitSelectionChange&&(this.ctx.events.fire(A.SELECTION_CHANGE,{features:this.getSelected().map(r=>r.toGeoJSON()),points:this.getSelectedCoordinates().map(r=>({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:r.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(A.RENDER,{})}))},this.isDirty=!1}b.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}},b.prototype.setDirty=function(){return this.isDirty=!0,this},b.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const n=this.get(e);this.ctx.events.fire(A.CREATE,{features:[n.toGeoJSON()]})}return this},b.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(A.UPDATE,{action:t.action?t.action:Q.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this},b.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},b.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},b.prototype.getAllIds=function(){return this._featureIds.values()},b.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this},b.prototype.delete=function(e,t={}){const r=[];return te(e).forEach(n=>{this._featureIds.has(n)&&(this._featureIds.delete(n),this._selectedFeatureIds.delete(n),t.silent||r.indexOf(this._features[n])===-1&&r.push(this._features[n].toGeoJSON()),delete this._features[n],this.isDirty=!0)}),r.length&&this.ctx.events.fire(A.DELETE,{features:r}),Zt(this,t),this},b.prototype.get=function(e){return this._features[e]},b.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])},b.prototype.select=function(e,t={}){return te(e).forEach(r=>{this._selectedFeatureIds.has(r)||(this._selectedFeatureIds.add(r),this._changedFeatureIds.add(r),t.silent||(this._emitSelectionChange=!0))}),this},b.prototype.deselect=function(e,t={}){return te(e).forEach(r=>{this._selectedFeatureIds.has(r)&&(this._selectedFeatureIds.delete(r),this._changedFeatureIds.add(r),t.silent||(this._emitSelectionChange=!0))}),Zt(this,t),this},b.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},b.prototype.setSelected=function(e,t={}){return e=te(e),this.deselect(this._selectedFeatureIds.values().filter(r=>e.indexOf(r)===-1),{silent:t.silent}),this.select(e.filter(r=>!this._selectedFeatureIds.has(r)),{silent:t.silent}),this},b.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},b.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},b.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},b.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))},b.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))},b.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},b.prototype.setFeatureProperty=function(e,t,r,n={}){this.get(e).setProperty(t,r),this.featureChanged(e,{silent:n.silent,action:Q.CHANGE_PROPERTIES})};function Zt(e,t={}){const r=e._selectedCoordinates.filter(n=>e._selectedFeatureIds.has(n.feature_id));e._selectedCoordinates.length!==r.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=r}b.prototype.storeMapConfig=function(){kt.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})},b.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})},b.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const zn=["mode","feature","mouse"];function Wn(e){const t={};let r=null,n={mode:null,feature:null,mouse:null},i={mode:null,feature:null,mouse:null};function o(){a({mode:null,feature:null,mouse:null}),s()}function a(p){i=Object.assign(i,p)}function s(){if(!e.container)return;const p=[],f=[];zn.forEach(g=>{i[g]!==n[g]&&(p.push(`${g}-${n[g]}`),i[g]!==null&&f.push(`${g}-${i[g]}`))}),p.length>0&&e.container.classList.remove(...p),f.length>0&&e.container.classList.add(...f),n=Object.assign(n,i)}function l(p,f={}){const g=document.createElement("button");return g.className=`${L.CONTROL_BUTTON} ${f.className}`,g.setAttribute("title",f.title),f.container.appendChild(g),g.addEventListener("click",S=>{if(S.preventDefault(),S.stopPropagation(),S.target===r){c(),f.onDeactivate();return}h(p),f.onActivate()},!0),g}function c(){r&&(r.classList.remove(L.ACTIVE_BUTTON),r=null)}function h(p){c();const f=t[p];f&&f&&p!=="trash"&&(f.classList.add(L.ACTIVE_BUTTON),r=f)}function d(){const p=e.options.controls,f=document.createElement("div");return f.className=`${L.CONTROL_GROUP} ${L.CONTROL_BASE}`,p&&(p[F.POINT]&&(t[F.POINT]=l(F.POINT,{container:f,className:L.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(_.DRAW_POINT),onDeactivate:()=>e.events.trash()})),p[F.LINE]&&(t[F.LINE]=l(F.LINE,{container:f,className:L.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(_.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),p[F.POLYGON]&&(t[F.POLYGON]=l(F.POLYGON,{container:f,className:L.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(_.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),p.trash&&(t.trash=l("trash",{container:f,className:L.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),p.combine_features&&(t.combine_features=l("combineFeatures",{container:f,className:L.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),p.uncombine_features&&(t.uncombine_features=l("uncombineFeatures",{container:f,className:L.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),f}function u(){Object.keys(t).forEach(p=>{const f=t[p];f.parentNode&&f.parentNode.removeChild(f),delete t[p]})}return{setActiveButton:h,queueMapClasses:a,updateMapClasses:s,clearMapClasses:o,addButtons:d,removeButtons:u}}function Jn(e){let t=null,r=null;const n={onRemove(){return e.map.off("load",n.connect),clearInterval(r),n.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",n.connect),clearInterval(r),n.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(i){if(e.map=i,e.events=Kn(e),e.ui=Wn(e),e.container=i.getContainer(),e.store=new b(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=i.boxZoom.isEnabled(),i.boxZoom.disable();const o=i.dragPan.isEnabled();i.dragPan.disable(),i.dragPan.enable(),o||i.dragPan.disable()}return i.loaded()?n.connect():(i.on("load",n.connect),r=setInterval(()=>{i.loaded()&&n.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(U.COLD,{data:{type:m.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(U.HOT,{data:{type:m.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(i=>{e.map.addLayer(i)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(i=>{e.map.getLayer(i.id)&&e.map.removeLayer(i.id)}),e.map.getSource(U.COLD)&&e.map.removeSource(U.COLD),e.map.getSource(U.HOT)&&e.map.removeSource(U.HOT)}};return e.setup=n,n}const De="#3bb2d0",re="#fbb03b",Xt="#fff",Qt=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],re,De],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],re,De],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Xt}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],re,De]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Xt}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":re}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":re}}];function z(e,t){this.x=e,this.y=t}z.prototype={clone(){return new z(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround(e,t){const r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),o=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=o,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:z},z.convert=function(e){if(e instanceof z)return e;if(Array.isArray(e))return new z(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new z(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function ke(e,t){const r=t.getBoundingClientRect();return new z(e.clientX-r.left-(t.clientLeft||0),e.clientY-r.top-(t.clientTop||0))}function Z(e,t,r,n){return{type:m.FEATURE,properties:{meta:w.VERTEX,parent:e,coord_path:r,active:n?O.ACTIVE:O.INACTIVE},geometry:{type:m.POINT,coordinates:t}}}var R=63710088e-1,Yn={centimeters:R*100,centimetres:R*100,degrees:360/(2*Math.PI),feet:R*3.28084,inches:R*39.37,kilometers:R/1e3,kilometres:R/1e3,meters:R,metres:R,miles:R/1609.344,millimeters:R*1e3,millimetres:R*1e3,nauticalmiles:R/1852,radians:1,yards:R*1.0936};function me(e,t,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function Zn(e,t,r={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ue(e[0])||!Ue(e[1]))throw new Error("coordinates must contain numbers");return me({type:"Point",coordinates:e},t,r)}function jt(e,t,r={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return me({type:"LineString",coordinates:e},t,r)}function Xn(e,t={}){const r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function Qn(e,t="kilometers"){const r=Yn[t];if(!r)throw new Error(t+" units is invalid");return e*r}function ge(e){return e%360*Math.PI/180}function Ue(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function ye(e,t,r){if(e!==null)for(var n,i,o,a,s,l,c,h=0,d=0,u,p=e.type,f=p==="FeatureCollection",g=p==="Feature",S=f?e.features.length:1,v=0;v<S;v++){c=f?e.features[v].geometry:g?e.geometry:e,u=c?c.type==="GeometryCollection":!1,s=u?c.geometries.length:1;for(var G=0;G<s;G++){var I=0,k=0;if(a=u?c.geometries[G]:c,a!==null){l=a.coordinates;var T=a.type;switch(h=r&&(T==="Polygon"||T==="MultiPolygon")?1:0,T){case null:break;case"Point":if(t(l,d,v,I,k)===!1)return!1;d++,I++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(t(l[n],d,v,I,k)===!1)return!1;d++,T==="MultiPoint"&&I++}T==="LineString"&&I++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-h;i++){if(t(l[n][i],d,v,I,k)===!1)return!1;d++}T==="MultiLineString"&&I++,T==="Polygon"&&k++}T==="Polygon"&&I++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(k=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-h;o++){if(t(l[n][i][o],d,v,I,k)===!1)return!1;d++}k++}I++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(ye(a.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function er(e,t){var r,n,i,o,a,s,l,c,h,d,u=0,p=e.type==="FeatureCollection",f=e.type==="Feature",g=p?e.features.length:1;for(r=0;r<g;r++){for(s=p?e.features[r].geometry:f?e.geometry:e,c=p?e.features[r].properties:f?e.properties:{},h=p?e.features[r].bbox:f?e.bbox:void 0,d=p?e.features[r].id:f?e.id:void 0,l=s?s.type==="GeometryCollection":!1,a=l?s.geometries.length:1,i=0;i<a;i++){if(o=l?s.geometries[i]:s,o===null){if(t(null,u,c,h,d)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(o,u,c,h,d)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(t(o.geometries[n],u,c,h,d)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}u++}}function jn(e,t,r){var n=r;return er(e,function(i,o,a,s,l){n=t(n,i,o,a,s,l)}),n}function tr(e,t){er(e,function(r,n,i,o,a){var s=r===null?null:r.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return t(me(r,i,{bbox:o,id:a}),n,0)===!1?!1:void 0}var l;switch(s){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var c=0;c<r.coordinates.length;c++){var h=r.coordinates[c],d={type:l,coordinates:h};if(t(me(d,i),n,c)===!1)return!1}})}function ei(e,t){tr(e,function(r,n,i){var o=0;if(r.geometry){var a=r.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var s,l=0,c=0,h=0;if(ye(r,function(d,u,p,f,g){if(s===void 0||n>l||f>c||g>h){s=d,l=n,c=f,h=g,o=0;return}var S=jt([s,d],r.properties);if(t(S,n,i,g,o)===!1)return!1;o++,s=d})===!1)return!1}}})}function ti(e,t,r){var n=r,i=!1;return ei(e,function(o,a,s,l,c){i===!1&&r===void 0?n=o:n=t(n,o,a,s,l,c),i=!0}),n}function ri(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return rr(e);case"FeatureCollection":return ni(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return qe(e);default:throw new Error("unknown GeoJSON type")}}function rr(e){const t={type:"Feature"};return Object.keys(e).forEach(r=>{switch(r){case"type":case"properties":case"geometry":return;default:t[r]=e[r]}}),t.properties=nr(e.properties),e.geometry==null?t.geometry=null:t.geometry=qe(e.geometry),t}function nr(e){const t={};return e&&Object.keys(e).forEach(r=>{const n=e[r];typeof n=="object"?n===null?t[r]=null:Array.isArray(n)?t[r]=n.map(i=>i):t[r]=nr(n):t[r]=n}),t}function ni(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach(r=>{switch(r){case"type":case"features":return;default:t[r]=e[r]}}),t.features=e.features.map(r=>rr(r)),t}function qe(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(r=>qe(r)),t):(t.coordinates=ir(e.coordinates),t)}function ir(e){const t=e;return typeof t[0]!="object"?t.slice():t.map(r=>ir(r))}function or(e,t={}){return ar(e,"mercator",t)}function ii(e,t={}){return ar(e,"wgs84",t)}function ar(e,t,r={}){r=r||{};var n=r.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&Ue(e[0])?e=t==="mercator"?sr(e):lr(e):(n!==!0&&(e=ri(e)),ye(e,function(i){var o=t==="mercator"?sr(i):lr(i);i[0]=o[0],i[1]=o[1]})),e}function sr(e){var t=Math.PI/180,r=6378137,n=20037508342789244e-9,i=Math.abs(e[0])<=180?e[0]:e[0]-oi(e[0])*360,o=[r*i*t,r*Math.log(Math.tan(Math.PI*.25+.5*e[1]*t))];return o[0]>n&&(o[0]=n),o[0]<-n&&(o[0]=-n),o[1]>n&&(o[1]=n),o[1]<-n&&(o[1]=-n),o}function lr(e){var t=180/Math.PI,r=6378137;return[e[0]*t/r,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/r)))*t]}function oi(e){return e<0?-1:e>0?1:0}function ur(e,t,r){const n=t.geometry.coordinates,i=r.geometry.coordinates;if(n[1]>Te||n[1]<Se||i[1]>Te||i[1]<Se)return null;const o=or(n),a=or(i),s=d=>Number(d.toFixed(8)),l=(d,u)=>(d+u)/2,c=ii([l(o[0],a[0]),l(o[1],a[1])]),h=[s(c[0]),s(c[1])];return{type:m.FEATURE,properties:{meta:w.MIDPOINT,parent:e,lng:h[0],lat:h[1],coord_path:r.properties.coord_path},geometry:{type:m.POINT,coordinates:h}}}function _e(e,t={},r=null){const{type:n,coordinates:i}=e.geometry,o=e.properties&&e.properties.id;let a=[];n===m.POINT?a.push(Z(o,i,r,l(r))):n===m.POLYGON?i.forEach((h,d)=>{s(h,r!==null?`${r}.${d}`:String(d))}):n===m.LINE_STRING?s(i,r):n.indexOf(m.MULTI_PREFIX)===0&&c();function s(h,d){let u="",p=null;h.forEach((f,g)=>{const S=d!=null?`${d}.${g}`:String(g),v=Z(o,f,S,l(S));if(t.midpoints&&p){const I=ur(o,p,v);I&&a.push(I)}p=v;const G=JSON.stringify(f);u!==G&&a.push(v),g===0&&(u=G)})}function l(h){return t.selectedPaths?t.selectedPaths.indexOf(h)!==-1:!1}function c(){const h=n.replace(m.MULTI_PREFIX,"");i.forEach((d,u)=>{const p={type:m.FEATURE,properties:e.properties,geometry:{type:h,coordinates:d}};a=a.concat(_e(p,t,u))})}return a}const V={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:ve,LAT_MAX:Ce,LAT_RENDERED_MIN:cr,LAT_RENDERED_MAX:pr,LNG_MIN:dr,LNG_MAX:hr}=Ut;function ai(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],r=[e.geometry.coordinates].flat(t),n=r.map(s=>s[0]),i=r.map(s=>s[1]),o=s=>Math.min.apply(null,s),a=s=>Math.max.apply(null,s);return[o(n),o(i),a(n),a(i)]}function Ge(e,t){let r=ve,n=Ce,i=ve,o=Ce,a=hr,s=dr;e.forEach(c=>{const h=ai(c),d=h[1],u=h[3],p=h[0],f=h[2];d>r&&(r=d),u<n&&(n=u),u>i&&(i=u),d<o&&(o=d),p<a&&(a=p),f>s&&(s=f)});const l=t;return r+l.lat>pr&&(l.lat=pr-r),i+l.lat>Ce&&(l.lat=Ce-i),n+l.lat<cr&&(l.lat=cr-n),o+l.lat<ve&&(l.lat=ve-o),a+l.lng<=dr&&(l.lng+=Math.ceil(Math.abs(l.lng)/360)*360),s+l.lng>=hr&&(l.lng-=Math.ceil(Math.abs(l.lng)/360)*360),l}function Ve(e,t){const r=Ge(e.map(n=>n.toGeoJSON()),t);e.forEach(n=>{const i=n.getCoordinates(),o=c=>{const h={lng:c[0]+r.lng,lat:c[1]+r.lat};return[h.lng,h.lat]},a=c=>c.map(h=>o(h)),s=c=>c.map(h=>a(h));let l;n.type===m.POINT?l=o(i):n.type===m.LINE_STRING||n.type===m.MULTI_POINT?l=i.map(o):n.type===m.POLYGON||n.type===m.MULTI_LINE_STRING?l=i.map(a):n.type===m.MULTI_POLYGON&&(l=i.map(s)),n.incomingCoords(l)})}const C={};C.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(r=>this.getFeature(r)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t},C.fireUpdate=function(){this.fire(A.UPDATE,{action:Q.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})},C.fireActionable=function(){const e=this.getSelected(),t=e.filter(o=>this.isInstanceOf("MultiFeature",o));let r=!1;if(e.length>1){r=!0;const o=e[0].type.replace("Multi","");e.forEach(a=>{a.type.replace("Multi","")!==o&&(r=!1)})}const n=t.length>0,i=e.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:n,trash:i})},C.getUniqueIds=function(e){return e.length?e.map(r=>r.properties.id).filter(r=>r!==void 0).reduce((r,n)=>(r.add(n),r),new q).values():[]},C.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},C.onStop=function(){V.enable(this)},C.onMouseMove=function(e,t){return Oe(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},C.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0},C.onTap=C.onClick=function(e,t){if(se(t))return this.clickAnywhere(e,t);if(ae(w.VERTEX)(t))return this.clickOnVertex(e,t);if(Oe(t))return this.clickOnFeature(e,t)},C.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(r=>this.doRender(r))),V.enable(this),this.stopExtendedInteractions(e)},C.clickOnVertex=function(e,t){this.changeMode(_.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:M.MOVE})},C.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},C.clickOnFeature=function(e,t){V.disable(this),this.stopExtendedInteractions(e);const r=le(t),n=this.getSelectedIds(),i=t.featureTarget.properties.id,o=this.isSelected(i);if(!r&&o&&this.getFeature(i).type!==m.POINT)return this.changeMode(_.DIRECT_SELECT,{featureId:i});o&&r?(this.deselect(i),this.updateUIClasses({mouse:M.POINTER}),n.length===1&&V.enable(this)):!o&&r?(this.select(i),this.updateUIClasses({mouse:M.MOVE})):!o&&!r&&(n.forEach(a=>this.doRender(a)),this.setSelected(i),this.updateUIClasses({mouse:M.MOVE})),this.doRender(i)},C.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),W(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&qt(t))return this.startBoxSelect(e,t)},C.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=ke(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},C.onTouchStart=function(e,t){if(W(t))return this.startOnActiveFeature(e,t)},C.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)},C.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:M.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(L.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const r=ke(t.originalEvent,this.map.getContainer()),n=Math.min(e.boxSelectStartLocation.x,r.x),i=Math.max(e.boxSelectStartLocation.x,r.x),o=Math.min(e.boxSelectStartLocation.y,r.y),a=Math.max(e.boxSelectStartLocation.y,r.y),s=`translate(${n}px, ${o}px)`;e.boxSelectElement.style.transform=s,e.boxSelectElement.style.WebkitTransform=s,e.boxSelectElement.style.width=`${i-n}px`,e.boxSelectElement.style.height=`${a-o}px`},C.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};Ve(this.getSelected(),r),e.dragMoveLocation=t.lngLat},C.onTouchEnd=C.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const r=[e.boxSelectStartLocation,ke(t.originalEvent,this.map.getContainer())],n=this.featuresAt(null,r,"click"),i=this.getUniqueIds(n).filter(o=>!this.isSelected(o));i.length&&(this.select(i),i.forEach(o=>this.doRender(o)),this.updateUIClasses({mouse:M.MOVE}))}this.stopExtendedInteractions(e)},C.toDisplayFeatures=function(e,t,r){t.properties.active=this.isSelected(t.properties.id)?O.ACTIVE:O.INACTIVE,r(t),this.fireActionable(),!(t.properties.active!==O.ACTIVE||t.geometry.type===m.POINT)&&_e(t).forEach(r)},C.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},C.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],r=[],n=e[0].type.replace("Multi","");for(let i=0;i<e.length;i++){const o=e[i];if(o.type.replace("Multi","")!==n)return;o.type.includes("Multi")?o.getCoordinates().forEach(a=>{t.push(a)}):t.push(o.getCoordinates()),r.push(o.toGeoJSON())}if(r.length>1){const i=this.newFeature({type:m.FEATURE,properties:r[0].properties,geometry:{type:`Multi${n}`,coordinates:t}});this.addFeature(i),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([i.id]),this.fire(A.COMBINE_FEATURES,{createdFeatures:[i.toGeoJSON()],deletedFeatures:r})}this.fireActionable()},C.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],r=[];for(let n=0;n<e.length;n++){const i=e[n];this.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach(o=>{this.addFeature(o),o.properties=i.properties,t.push(o.toGeoJSON()),this.select([o.id])}),this.deleteFeature(i.id,{silent:!0}),r.push(i.toGeoJSON()))}t.length>1&&this.fire(A.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:r}),this.fireActionable()};const fr=ae(w.VERTEX),mr=ae(w.MIDPOINT),E={};E.fireUpdate=function(){this.fire(A.UPDATE,{action:Q.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})},E.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},E.startDragging=function(e,t){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},E.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},E.onVertex=function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties,n=e.selectedCoordPaths.indexOf(r.coord_path);!le(t)&&n===-1?e.selectedCoordPaths=[r.coord_path]:le(t)&&n===-1&&e.selectedCoordPaths.push(r.coord_path);const i=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(i)},E.onMidpoint=function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties;e.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),e.selectedCoordPaths=[r.coord_path]},E.pathsToCoordinates=function(e,t){return t.map(r=>({feature_id:e,coord_path:r}))},E.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)},E.dragFeature=function(e,t,r){Ve(this.getSelected(),r),e.dragMoveLocation=t.lngLat},E.dragVertex=function(e,t,r){const n=e.selectedCoordPaths.map(a=>e.feature.getCoordinate(a)),i=n.map(a=>({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:a}})),o=Ge(i,r);for(let a=0;a<n.length;a++){const s=n[a];e.feature.updateCoordinate(e.selectedCoordPaths[a],s[0]+o.lng,s[1]+o.lat)}},E.clickNoTarget=function(){this.changeMode(_.SIMPLE_SELECT)},E.clickInactive=function(){this.changeMode(_.SIMPLE_SELECT)},E.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},E.onSetup=function(e){const t=e.featureId,r=this.getFeature(t);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===m.POINT)throw new TypeError("direct_select mode doesn't handle point features");const n={featureId:t,feature:r,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,n.selectedCoordPaths)),this.setSelected(t),V.disable(this),this.setActionableState({trash:!0}),n},E.onStop=function(){V.enable(this),this.clearSelectedCoordinates()},E.toDisplayFeatures=function(e,t,r){e.featureId===t.properties.id?(t.properties.active=O.ACTIVE,r(t),_e(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(r)):(t.properties.active=O.INACTIVE,r(t)),this.fireActionable(e)},E.onTrash=function(e){e.selectedCoordPaths.sort((t,r)=>r.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(_.SIMPLE_SELECT,{}))},E.onMouseMove=function(e,t){const r=W(t),n=fr(t),i=mr(t),o=e.selectedCoordPaths.length===0;return r&&o?this.updateUIClasses({mouse:M.MOVE}):n&&!o?this.updateUIClasses({mouse:M.MOVE}):this.updateUIClasses({mouse:M.NONE}),(n||r||i)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},E.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0},E.onTouchStart=E.onMouseDown=function(e,t){if(fr(t))return this.onVertex(e,t);if(W(t))return this.onFeature(e,t);if(mr(t))return this.onMidpoint(e,t)},E.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,r):this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat},E.onClick=function(e,t){if(se(t))return this.clickNoTarget(e,t);if(W(t))return this.clickActiveFeature(e,t);if(Le(t))return this.clickInactive(e,t);this.stopDragging(e)},E.onTap=function(e,t){if(se(t))return this.clickNoTarget(e,t);if(W(t))return this.clickActiveFeature(e,t);if(Le(t))return this.clickInactive(e,t)},E.onTouchEnd=E.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const K={};K.onSetup=function(){const e=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:M.ADD}),this.activateUIButton(F.POINT),this.setActionableState({trash:!0}),{point:e}},K.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT)},K.onTap=K.onClick=function(e,t){this.updateUIClasses({mouse:M.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(A.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.point.id]})},K.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},K.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.point.id;if(t.properties.active=n?O.ACTIVE:O.INACTIVE,!n)return r(t)},K.onTrash=K.stopDrawingAndRemove,K.onKeyUp=function(e,t){if(ue(t)||ce(t))return this.stopDrawingAndRemove(e,t)};function Ee(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const x={};x.onSetup=function(){const e=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),V.disable(this),this.updateUIClasses({mouse:M.ADD}),this.activateUIButton(F.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},x.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&Ee(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:M.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)},x.clickOnVertex=function(e){return this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},x.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),j(t)&&this.updateUIClasses({mouse:M.POINTER})},x.onTap=x.onClick=function(e,t){return j(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},x.onKeyUp=function(e,t){ue(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT)):ce(t)&&this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},x.onStop=function(e){this.updateUIClasses({mouse:M.NONE}),V.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(A.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT,{},{silent:!0})))},x.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.polygon.id;if(t.properties.active=n?O.ACTIVE:O.INACTIVE,!n)return r(t);if(t.geometry.coordinates.length===0)return;const i=t.geometry.coordinates[0].length;if(!(i<3)){if(t.properties.meta=w.FEATURE,r(Z(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),i>3){const o=t.geometry.coordinates[0].length-3;r(Z(e.polygon.id,t.geometry.coordinates[0][o],`0.${o}`,!1))}if(i<=4){const o=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:m.FEATURE,properties:t.properties,geometry:{coordinates:o,type:m.LINE_STRING}}),i===3)return}return r(t)}},x.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT)};const B={};B.onSetup=function(e){e=e||{};const t=e.featureId;let r,n,i="forward";if(t){if(r=this.getFeature(t),!r)throw new Error("Could not find a feature with the provided featureId");let o=e.from;if(o&&o.type==="Feature"&&o.geometry&&o.geometry.type==="Point"&&(o=o.geometry),o&&o.type==="Point"&&o.coordinates&&o.coordinates.length===2&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=r.coordinates.length-1;if(r.coordinates[a][0]===o[0]&&r.coordinates[a][1]===o[1])n=a+1,r.addCoordinate(n,...r.coordinates[a]);else if(r.coordinates[0][0]===o[0]&&r.coordinates[0][1]===o[1])i="backwards",n=0,r.addCoordinate(n,...r.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else r=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(r);return this.clearSelectedFeatures(),V.disable(this),this.updateUIClasses({mouse:M.ADD}),this.activateUIButton(F.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:n,direction:i}},B.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&Ee(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&Ee(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:M.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},B.clickOnVertex=function(e){return this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.line.id]})},B.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),j(t)&&this.updateUIClasses({mouse:M.POINTER})},B.onTap=B.onClick=function(e,t){if(j(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},B.onKeyUp=function(e,t){ce(t)?this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.line.id]}):ue(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT))},B.onStop=function(e){V.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(A.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT,{},{silent:!0})))},B.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT)},B.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.line.id;if(t.properties.active=n?O.ACTIVE:O.INACTIVE,!n)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=w.FEATURE,r(Z(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),r(t))};const gr={simple_select:C,direct_select:E,draw_point:K,draw_polygon:x,draw_line_string:B},si={defaultMode:_.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Qt,modes:gr,controls:{},userProperties:!1,suppressAPIEvents:!0},li={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ui={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function yr(e,t){return e.map(r=>r.source?r:Object.assign({},r,{id:`${r.id}.${t}`,source:t==="hot"?U.HOT:U.COLD}))}function ci(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},ui,e.controls):t.controls=Object.assign({},li,e.controls),t=Object.assign({},si,t),t.styles=yr(t.styles,"cold").concat(yr(t.styles,"hot")),t}var xe,_r;function pi(){return _r||(_r=1,xe=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,i,o;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(i=n;i--!==0;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(o=Object.keys(t),n=o.length,n!==Object.keys(r).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;i--!==0;){var a=o[i];if(!e(t[a],r[a]))return!1}return!0}return t!==t&&r!==r}),xe}var di=pi();const vr=pe(di);var Be,Cr;function hi(){if(Cr)return Be;Cr=1,Be=t;var e={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function t(r){if(!r||!r.type)return null;var n=e[r.type];if(!n)return null;if(n==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:r}]};if(n==="feature")return{type:"FeatureCollection",features:[r]};if(n==="featurecollection")return r}return Be}var fi=hi();const mi=pe(fi);function Er(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(r=>r).sort())===JSON.stringify(t.map(r=>r).sort())}const gi={Polygon:D,LineString:$,Point:H,MultiPolygon:N,MultiLineString:N,MultiPoint:N};function yi(e,t){t.modes=_;const r=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(n){return Y.click({point:n},null,e).map(o=>o.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:m.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(n=>e.store.get(n)).map(n=>n.toGeoJSON())}},t.getSelectedPoints=function(){return{type:m.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(n=>({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:n.coordinates}}))}},t.set=function(n){if(n.type===void 0||n.type!==m.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");const i=e.store.createRenderBatch();let o=e.store.getAllIds().slice();const a=t.add(n),s=new q(a);return o=o.filter(l=>!s.has(l)),o.length&&t.delete(o),i(),a},t.add=function(n){const o=JSON.parse(JSON.stringify(mi(n))).features.map(a=>{if(a.id=a.id||Fe(),a.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(a.id)===void 0||e.store.get(a.id).type!==a.geometry.type){const s=gi[a.geometry.type];if(s===void 0)throw new Error(`Invalid geometry type: ${a.geometry.type}.`);const l=new s(e,a);e.store.add(l,{silent:r})}else{const s=e.store.get(a.id),l=s.properties;s.properties=a.properties,vr(l,a.properties)||e.store.featureChanged(s.id,{silent:r}),vr(s.getCoordinates(),a.geometry.coordinates)||s.incomingCoords(a.geometry.coordinates)}return a.id});return e.store.render(),o},t.get=function(n){const i=e.store.get(n);if(i)return i.toGeoJSON()},t.getAll=function(){return{type:m.FEATURE_COLLECTION,features:e.store.getAll().map(n=>n.toGeoJSON())}},t.delete=function(n){return e.store.delete(n,{silent:r}),t.getMode()===_.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(_.SIMPLE_SELECT,void 0,{silent:r}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:r}),t.getMode()===_.DIRECT_SELECT?e.events.changeMode(_.SIMPLE_SELECT,void 0,{silent:r}):e.store.render(),t},t.changeMode=function(n,i={}){return n===_.SIMPLE_SELECT&&t.getMode()===_.SIMPLE_SELECT?(Er(i.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(i.featureIds,{silent:r}),e.store.render()),t):(n===_.DIRECT_SELECT&&t.getMode()===_.DIRECT_SELECT&&i.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(n,i,{silent:r}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:r}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:r}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:r}),t},t.setFeatureProperty=function(n,i,o){return e.store.setFeatureProperty(n,i,o,{silent:r}),t},t}const _i=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:Ln,ModeHandler:Re,StringSet:q,constrainFeatureMovement:Ge,createMidPoint:ur,createSupplementaryPoints:_e,createVertex:Z,doubleClickZoom:V,euclideanDistance:Ae,featuresAt:Y,getFeatureAtAndSetCursors:he,isClick:Pe,isEventAtCoordinates:Ee,isTap:Ne,mapEventToBoundingBox:Wt,moveFeatures:Ve,sortFeatures:zt,stringSetsAreEqual:Er,theme:Qt,toDenseArray:te},Symbol.toStringTag,{value:"Module"})),vi=function(e,t){e=ci(e);const r={options:e};t=yi(r,t),r.api=t;const n=Jn(r);return t.onAdd=n.onAdd,t.onRemove=n.onRemove,t.types=F,t.options=e,t};function ne(e){vi(e,this)}ne.modes=gr,ne.constants=Ut,ne.lib=_i;function br(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mr(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ci(e,t,r={}){var n=br(e),i=br(t),o=ge(i[1]-n[1]),a=ge(i[0]-n[0]),s=ge(n[1]),l=ge(i[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(l);return Qn(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),r.units)}function Ei(e){return jn(e,(t,r)=>t+bi(r),0)}function bi(e){let t=0,r;switch(e.type){case"Polygon":return Sr(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)t+=Sr(e.coordinates[r]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function Sr(e){let t=0;if(e&&e.length>0){t+=Math.abs(Tr(e[0]));for(let r=1;r<e.length;r++)t-=Math.abs(Tr(e[r]))}return t}var Mi=R*R/2,$e=Math.PI/180;function Tr(e){const t=e.length-1;if(t<=2)return 0;let r=0,n=0;for(;n<t;){const i=e[n],o=e[n+1===t?0:n+1],a=e[n+2>=t?(n+2)%t:n+2],s=i[0]*$e,l=o[1]*$e,c=a[0]*$e;r+=(c-s)*Math.sin(l),n++}return r*Mi}function Si(e){if(!e)throw new Error("geojson is required");const t=[];return tr(e,r=>{Ti(r,t)}),Xn(t)}function Ti(e,t){let r=[];const n=e.geometry;if(n!==null){switch(n.type){case"Polygon":r=Mr(n);break;case"LineString":r=[Mr(n)]}r.forEach(i=>{Li(i,e.properties).forEach(a=>{a.id=t.length,t.push(a)})})}}function Li(e,t){const r=[];return e.reduce((n,i)=>{const o=jt([n,i],t);return o.bbox=Oi(n,i),r.push(o),i}),r}function Oi(e,t){const r=e[0],n=e[1],i=t[0],o=t[1],a=r<i?r:i,s=n<o?n:o,l=r>i?r:i,c=n>o?n:o;return[a,s,l,c]}function Ke(e,t={}){let r=0,n=0,i=0;return ye(e,function(o){r+=o[0],n+=o[1],i++},!0),Zn([r/i,n/i],t.properties)}function Lr(e,t={}){return ti(e,(r,n)=>{const i=n.geometry.coordinates;return r+Ci(i[0],i[1],t)},0)}var He,Or;function ze(){if(Or)return He;Or=1;var e={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1};return He=e,He}var We,Ir;function be(){if(Ir)return We;Ir=1;var e=ze();function t(r){return!!(r&&e[typeof r])}return We=t,We}var Je,wr;function ie(){if(wr)return Je;wr=1;var e=Object.prototype,t=e.toString,r=RegExp("^"+String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return Je=r,Je}var Ye,Ar;function Ii(){if(Ar)return Ye;Ar=1;var e=ze(),t=Object.prototype,r=t.hasOwnProperty,n=function(i){var o,a=i,s=[];if(!a||!e[typeof i])return s;for(o in a)r.call(a,o)&&s.push(o);return s};return Ye=n,Ye}var Ze,Pr;function Nr(){if(Pr)return Ze;Pr=1;var e=be(),t=ie(),r=Ii(),n=t.test(n=Object.keys)&&n,i=n?function(o){return e(o)?n(o):[]}:r;return Ze=i,Ze}var Xe,Rr;function Fr(){if(Rr)return Xe;Rr=1;function e(){}return Xe=e,Xe}var Qe,Dr;function kr(){if(Dr)return Qe;Dr=1;var e=be();Fr();var t=ie(),r=t.test(r=Object.create)&&r;function n(i,o){return e(i)?r(i):{}}return r||(n=(function(){function i(){}return function(o){if(e(o)){i.prototype=o;var a=new i;i.prototype=null}return a||window.Object()}})()),Qe=n,Qe}var je,Ur;function et(){if(Ur)return je;Ur=1;var e=Fr(),t=ie(),r={configurable:!1,enumerable:!1,value:null,writable:!1},n=(function(){try{var o={},a=t.test(a=Object.defineProperty)&&a,s=a(o,o,o)&&a}catch{}return s})(),i=n?function(o,a){r.value=a,n(o,"__bindData__",r)}:e;return je=i,je}var tt,qr;function wi(){if(qr)return tt;qr=1;var e=kr(),t=be(),r=et(),n=[],i=n.push;function o(a){var s=a[0],l=a[2],c=a[4];function h(){if(l){var d=l.slice();i.apply(d,arguments)}if(this instanceof h){var u=e(s.prototype),p=s.apply(u,d||arguments);return t(p)?p:u}return s.apply(c,d||arguments)}return r(h,a),h}return tt=o,tt}var rt,Gr;function Vr(){if(Gr)return rt;Gr=1;function e(t,r,n){r||(r=0),typeof n>"u"&&(n=t?t.length:0);for(var i=-1,o=n-r||0,a=Array(o<0?0:o);++i<o;)a[i]=t[r+i];return a}return rt=e,rt}var nt,xr;function Ai(){if(xr)return nt;xr=1;var e=kr(),t=be(),r=et(),n=Vr(),i=[],o=i.push;function a(s){var l=s[0],c=s[1],h=s[2],d=s[3],u=s[4],p=s[5],f=c&1,g=c&2,S=c&4,v=c&8,G=l;function I(){var k=f?u:this;if(h){var T=h.slice();o.apply(T,arguments)}if((d||S)&&(T||(T=n(arguments)),d&&o.apply(T,d),S&&T.length<p))return c|=16,a([l,v?c:c&-4,T,null,u,p]);if(T||(T=arguments),g&&(l=k[G]),this instanceof I){k=e(l.prototype);var bn=l.apply(k,T);return t(bn)?bn:k}return l.apply(k,T)}return r(I,s),I}return nt=a,nt}var it,Br;function Pi(){if(Br)return it;Br=1;function e(t){return typeof t=="function"}return it=e,it}var ot,$r;function Ni(){if($r)return ot;$r=1;var e=wi(),t=Ai(),r=Pi(),n=[],i=n.push;function o(a,s,l,c,h,d){var u=s&1,p=s&2,f=s&4,g=s&16,S=s&32;if(!p&&!r(a))throw new TypeError;g&&!l.length&&(s&=-17,g=l=!1),S&&!c.length&&(s&=-33,S=c=!1);var v=a&&a.__bindData__;if(v&&v!==!0)return v=v.slice(),u&&!(v[1]&1)&&(v[4]=h),!u&&v[1]&1&&(s|=8),f&&!(v[1]&4)&&(v[5]=d),g&&i.apply(v[2]||(v[2]=[]),l),S&&i.apply(v[3]||(v[3]=[]),c),v[1]|=s,o.apply(null,v);var G=s==1||s===17?e:t;return G([a,s,l,c,h,d])}return ot=o,ot}var at,Kr;function Ri(){if(Kr)return at;Kr=1;var e=Ni();ie();var t=Vr();function r(n,i){return arguments.length>2?e(n,17,t(arguments,2),null,i):e(n,1,null,null,i)}return at=r,at}var st,Hr;function Fi(){if(Hr)return st;Hr=1;function e(t){return t}return st=e,st}var lt,zr;function Di(){if(zr)return lt;zr=1;var e=ie(),t=/\bthis\b/,r={};return r.funcDecomp=!e.test(window.WinRTError)&&t.test(function(){return this}),r.funcNames=typeof Function.name=="string",lt=r,lt}var ut,Wr;function Jr(){if(Wr)return ut;Wr=1;var e=Ri(),t=Fi(),r=et(),n=Di(),i=/^\s*function[ \n\r\t]+\w/,o=/\bthis\b/,a=Function.prototype.toString;function s(l,c,h){if(typeof l!="function")return t;if(typeof c>"u"||!("prototype"in l))return l;var d=l.__bindData__;if(typeof d>"u"&&(n.funcNames&&(d=!l.name),d=d||!n.funcDecomp,!d)){var u=a.call(l);n.funcNames||(d=!i.test(u)),d||(d=o.test(u),r(l,d))}if(d===!1||d!==!0&&d[1]&1)return l;switch(h){case 1:return function(p){return l.call(c,p)};case 2:return function(p,f){return l.call(c,p,f)};case 3:return function(p,f,g){return l.call(c,p,f,g)};case 4:return function(p,f,g,S){return l.call(c,p,f,g,S)}}return e(l,c)}return ut=s,ut}var ct,Yr;function ki(){if(Yr)return ct;Yr=1;var e=Jr(),t=Nr(),r=ze(),n=function(i,o,a){var s,l=i,c=l;if(!l||!r[typeof l])return c;o=o&&typeof a>"u"?o:e(o,a,3);for(var h=-1,d=r[typeof l]&&t(l),u=d?d.length:0;++h<u;)if(s=d[h],o(l[s],s,i)===!1)return c;return c};return ct=n,ct}var pt,Zr;function Ui(){if(Zr)return pt;Zr=1;var e=Jr(),t=ki();function r(n,i,o){var a=-1,s=n?n.length:0;if(i=i&&typeof o>"u"?i:e(i,o,3),typeof s=="number")for(;++a<s&&i(n[a],a,n)!==!1;);else t(n,i);return n}return pt=r,pt}var dt,Xr;function qi(){if(Xr)return dt;Xr=1;var e,t;return e={mm:{name:{singular:"Millimeter",plural:"Millimeters"},to_anchor:1/1e3},cm:{name:{singular:"Centimeter",plural:"Centimeters"},to_anchor:1/100},m:{name:{singular:"Meter",plural:"Meters"},to_anchor:1},km:{name:{singular:"Kilometer",plural:"Kilometers"},to_anchor:1e3}},t={in:{name:{singular:"Inch",plural:"Inches"},to_anchor:1/12},yd:{name:{singular:"Yard",plural:"Yards"},to_anchor:3},"ft-us":{name:{singular:"US Survey Foot",plural:"US Survey Feet"},to_anchor:1.000002},ft:{name:{singular:"Foot",plural:"Feet"},to_anchor:1},mi:{name:{singular:"Mile",plural:"Miles"},to_anchor:5280}},dt={metric:e,imperial:t,_anchors:{metric:{unit:"m",ratio:3.28084},imperial:{unit:"ft",ratio:1/3.28084}}},dt}var ht,Qr;function Gi(){if(Qr)return ht;Qr=1;var e,t;return e={mm2:{name:{singular:"Square Millimeter",plural:"Square Millimeters"},to_anchor:1/1e6},cm2:{name:{singular:"Centimeter",plural:"Centimeters"},to_anchor:1/1e4},m2:{name:{singular:"Square Meter",plural:"Square Meters"},to_anchor:1},ha:{name:{singular:"Hectare",plural:"Hectares"},to_anchor:1e4},km2:{name:{singular:"Square Kilometer",plural:"Square Kilometers"},to_anchor:1e6}},t={in2:{name:{singular:"Square Inch",plural:"Square Inches"},to_anchor:1/144},yd2:{name:{singular:"Square Yard",plural:"Square Yards"},to_anchor:9},ft2:{name:{singular:"Square Foot",plural:"Square Feet"},to_anchor:1},ac:{name:{singular:"Acre",plural:"Acres"},to_anchor:43560},mi2:{name:{singular:"Square Mile",plural:"Square Miles"},to_anchor:27878400}},ht={metric:e,imperial:t,_anchors:{metric:{unit:"m2",ratio:10.7639},imperial:{unit:"ft2",ratio:1/10.7639}}},ht}var ft,jr;function Vi(){if(jr)return ft;jr=1;var e,t;return e={mcg:{name:{singular:"Microgram",plural:"Micrograms"},to_anchor:1/1e6},mg:{name:{singular:"Milligram",plural:"Milligrams"},to_anchor:1/1e3},g:{name:{singular:"Gram",plural:"Grams"},to_anchor:1},kg:{name:{singular:"Kilogram",plural:"Kilograms"},to_anchor:1e3},mt:{name:{singular:"Metric Tonne",plural:"Metric Tonnes"},to_anchor:1e6}},t={oz:{name:{singular:"Ounce",plural:"Ounces"},to_anchor:1/16},lb:{name:{singular:"Pound",plural:"Pounds"},to_anchor:1},t:{name:{singular:"Ton",plural:"Tons"},to_anchor:2e3}},ft={metric:e,imperial:t,_anchors:{metric:{unit:"g",ratio:1/453.592},imperial:{unit:"lb",ratio:453.592}}},ft}var mt,en;function xi(){if(en)return mt;en=1;var e,t;return e={mm3:{name:{singular:"Cubic Millimeter",plural:"Cubic Millimeters"},to_anchor:1/1e6},cm3:{name:{singular:"Cubic Centimeter",plural:"Cubic Centimeters"},to_anchor:1/1e3},ml:{name:{singular:"Millilitre",plural:"Millilitres"},to_anchor:1/1e3},cl:{name:{singular:"Centilitre",plural:"Centilitres"},to_anchor:1/100},dl:{name:{singular:"Decilitre",plural:"Decilitres"},to_anchor:1/10},l:{name:{singular:"Litre",plural:"Litres"},to_anchor:1},kl:{name:{singular:"Kilolitre",plural:"Kilolitres"},to_anchor:1e3},m3:{name:{singular:"Cubic meter",plural:"Cubic meters"},to_anchor:1e3},km3:{name:{singular:"Cubic kilometer",plural:"Cubic kilometers"},to_anchor:1e12},krm:{name:{singular:"Matsked",plural:"Matskedar"},to_anchor:1/1e3},tsk:{name:{singular:"Tesked",plural:"Teskedar"},to_anchor:5/1e3},msk:{name:{singular:"Matsked",plural:"Matskedar"},to_anchor:15/1e3},kkp:{name:{singular:"Kaffekopp",plural:"Kaffekoppar"},to_anchor:150/1e3},glas:{name:{singular:"Glas",plural:"Glas"},to_anchor:200/1e3},kanna:{name:{singular:"Kanna",plural:"Kannor"},to_anchor:2.617}},t={tsp:{name:{singular:"Teaspoon",plural:"Teaspoons"},to_anchor:1/6},Tbs:{name:{singular:"Tablespoon",plural:"Tablespoons"},to_anchor:1/2},in3:{name:{singular:"Cubic inch",plural:"Cubic inches"},to_anchor:.55411},"fl-oz":{name:{singular:"Fluid Ounce",plural:"Fluid Ounces"},to_anchor:1},cup:{name:{singular:"Cup",plural:"Cups"},to_anchor:8},pnt:{name:{singular:"Pint",plural:"Pints"},to_anchor:16},qt:{name:{singular:"Quart",plural:"Quarts"},to_anchor:32},gal:{name:{singular:"Gallon",plural:"Gallons"},to_anchor:128},ft3:{name:{singular:"Cubic foot",plural:"Cubic feet"},to_anchor:957.506},yd3:{name:{singular:"Cubic yard",plural:"Cubic yards"},to_anchor:25852.7}},mt={metric:e,imperial:t,_anchors:{metric:{unit:"l",ratio:33.8140226},imperial:{unit:"fl-oz",ratio:1/33.8140226}}},mt}var gt,tn;function Bi(){if(tn)return gt;tn=1;var e;return e={ea:{name:{singular:"Each",plural:"Each"},to_anchor:1},dz:{name:{singular:"Dozen",plural:"Dozens"},to_anchor:12}},gt={metric:e,imperial:{},_anchors:{metric:{unit:"ea",ratio:1}}},gt}var yt,rn;function $i(){if(rn)return yt;rn=1;var e,t;return e={C:{name:{singular:"degree Celsius",plural:"degrees Celsius"},to_anchor:1,anchor_shift:0},K:{name:{singular:"degree Kelvin",plural:"degrees Kelvin"},to_anchor:1,anchor_shift:273.15}},t={F:{name:{singular:"degree Fahrenheit",plural:"degrees Fahrenheit"},to_anchor:1},R:{name:{singular:"degree Rankine",plural:"degrees Rankine"},to_anchor:1,anchor_shift:459.67}},yt={metric:e,imperial:t,_anchors:{metric:{unit:"C",transform:function(r){return r/(5/9)+32}},imperial:{unit:"F",transform:function(r){return(r-32)*(5/9)}}}},yt}var _t,nn;function Ki(){if(nn)return _t;nn=1;var e,t=365.25;return e={ns:{name:{singular:"Nanosecond",plural:"Nanoseconds"},to_anchor:1/1e9},mu:{name:{singular:"Microsecond",plural:"Microseconds"},to_anchor:1/1e6},ms:{name:{singular:"Millisecond",plural:"Milliseconds"},to_anchor:1/1e3},s:{name:{singular:"Second",plural:"Seconds"},to_anchor:1},min:{name:{singular:"Minute",plural:"Minutes"},to_anchor:60},h:{name:{singular:"Hour",plural:"Hours"},to_anchor:3600},d:{name:{singular:"Day",plural:"Days"},to_anchor:3600*24},week:{name:{singular:"Week",plural:"Weeks"},to_anchor:3600*24*7},month:{name:{singular:"Month",plural:"Months"},to_anchor:3600*24*t/12},year:{name:{singular:"Year",plural:"Years"},to_anchor:3600*24*t}},_t={metric:e,_anchors:{metric:{unit:"s",ratio:1}}},_t}var vt,on;function Hi(){if(on)return vt;on=1;var e,t;return e={b:{name:{singular:"Bit",plural:"Bits"},to_anchor:1},Kb:{name:{singular:"Kilobit",plural:"Kilobits"},to_anchor:1024},Mb:{name:{singular:"Megabit",plural:"Megabits"},to_anchor:1048576},Gb:{name:{singular:"Gigabit",plural:"Gigabits"},to_anchor:1073741824},Tb:{name:{singular:"Terabit",plural:"Terabits"},to_anchor:1099511627776}},t={B:{name:{singular:"Byte",plural:"Bytes"},to_anchor:1},KB:{name:{singular:"Kilobyte",plural:"Kilobytes"},to_anchor:1024},MB:{name:{singular:"Megabyte",plural:"Megabytes"},to_anchor:1048576},GB:{name:{singular:"Gigabyte",plural:"Gigabytes"},to_anchor:1073741824},TB:{name:{singular:"Terabyte",plural:"Terabytes"},to_anchor:1099511627776}},vt={bits:e,bytes:t,_anchors:{bits:{unit:"b",ratio:1/8},bytes:{unit:"B",ratio:8}}},vt}var Ct,an;function zi(){if(an)return Ct;an=1;var e;return e={ppm:{name:{singular:"Part-per Million",plural:"Parts-per Million"},to_anchor:1},ppb:{name:{singular:"Part-per Billion",plural:"Parts-per Billion"},to_anchor:.001},ppt:{name:{singular:"Part-per Trillion",plural:"Parts-per Trillion"},to_anchor:1e-6},ppq:{name:{singular:"Part-per Quadrillion",plural:"Parts-per Quadrillion"},to_anchor:1e-9}},Ct={metric:e,imperial:{},_anchors:{metric:{unit:"ppm",ratio:1e-6}}},Ct}var Et,sn;function Wi(){if(sn)return Et;sn=1;var e,t;return e={"m/s":{name:{singular:"Metre per second",plural:"Metres per second"},to_anchor:3.6},"km/h":{name:{singular:"Kilometre per hour",plural:"Kilometres per hour"},to_anchor:1}},t={"m/h":{name:{singular:"Mile per hour",plural:"Miles per hour"},to_anchor:1},knot:{name:{singular:"Knot",plural:"Knots"},to_anchor:1.150779},"ft/s":{name:{singular:"Foot per second",plural:"Feet per second"},to_anchor:.681818}},Et={metric:e,imperial:t,_anchors:{metric:{unit:"km/h",ratio:1/1.609344},imperial:{unit:"m/h",ratio:1.609344}}},Et}var bt,ln;function Ji(){if(ln)return bt;ln=1;var e,t;return e={"min/km":{name:{singular:"Minute per kilometre",plural:"Minutes per kilometre"},to_anchor:.06},"s/m":{name:{singular:"Second per metre",plural:"Seconds per metre"},to_anchor:1}},t={"min/mi":{name:{singular:"Minute per mile",plural:"Minutes per mile"},to_anchor:.0113636},"s/ft":{name:{singular:"Second per foot",plural:"Seconds per foot"},to_anchor:1}},bt={metric:e,imperial:t,_anchors:{metric:{unit:"s/m",ratio:.3048},imperial:{unit:"s/ft",ratio:1/.3048}}},bt}var Mt,un;function Yi(){if(un)return Mt;un=1;var e,t;return e={Pa:{name:{singular:"pascal",plural:"pascals"},to_anchor:1/1e3},kPa:{name:{singular:"kilopascal",plural:"kilopascals"},to_anchor:1},MPa:{name:{singular:"megapascal",plural:"megapascals"},to_anchor:1e3},hPa:{name:{singular:"hectopascal",plural:"hectopascals"},to_anchor:1/10},bar:{name:{singular:"bar",plural:"bar"},to_anchor:100},torr:{name:{singular:"torr",plural:"torr"},to_anchor:101325/76e4}},t={psi:{name:{singular:"pound per square inch",plural:"pounds per square inch"},to_anchor:1/1e3},ksi:{name:{singular:"kilopound per square inch",plural:"kilopound per square inch"},to_anchor:1}},Mt={metric:e,imperial:t,_anchors:{metric:{unit:"kPa",ratio:.00014503768078},imperial:{unit:"psi",ratio:1/.00014503768078}}},Mt}var St,cn;function Zi(){if(cn)return St;cn=1;var e;return e={A:{name:{singular:"Ampere",plural:"Amperes"},to_anchor:1},mA:{name:{singular:"Milliampere",plural:"Milliamperes"},to_anchor:.001},kA:{name:{singular:"Kiloampere",plural:"Kiloamperes"},to_anchor:1e3}},St={metric:e,_anchors:{metric:{unit:"A",ratio:1}}},St}var Tt,pn;function Xi(){if(pn)return Tt;pn=1;var e;return e={V:{name:{singular:"Volt",plural:"Volts"},to_anchor:1},mV:{name:{singular:"Millivolt",plural:"Millivolts"},to_anchor:.001},kV:{name:{singular:"Kilovolt",plural:"Kilovolts"},to_anchor:1e3}},Tt={metric:e,_anchors:{metric:{unit:"V",ratio:1}}},Tt}var Lt,dn;function Qi(){if(dn)return Lt;dn=1;var e;return e={W:{name:{singular:"Watt",plural:"Watts"},to_anchor:1},mW:{name:{singular:"Milliwatt",plural:"Milliwatts"},to_anchor:.001},kW:{name:{singular:"Kilowatt",plural:"Kilowatts"},to_anchor:1e3},MW:{name:{singular:"Megawatt",plural:"Megawatts"},to_anchor:1e6},GW:{name:{singular:"Gigawatt",plural:"Gigawatts"},to_anchor:1e9}},Lt={metric:e,_anchors:{metric:{unit:"W",ratio:1}}},Lt}var Ot,hn;function ji(){if(hn)return Ot;hn=1;var e;return e={VAR:{name:{singular:"Volt-Ampere Reactive",plural:"Volt-Amperes Reactive"},to_anchor:1},mVAR:{name:{singular:"Millivolt-Ampere Reactive",plural:"Millivolt-Amperes Reactive"},to_anchor:.001},kVAR:{name:{singular:"Kilovolt-Ampere Reactive",plural:"Kilovolt-Amperes Reactive"},to_anchor:1e3},MVAR:{name:{singular:"Megavolt-Ampere Reactive",plural:"Megavolt-Amperes Reactive"},to_anchor:1e6},GVAR:{name:{singular:"Gigavolt-Ampere Reactive",plural:"Gigavolt-Amperes Reactive"},to_anchor:1e9}},Ot={metric:e,_anchors:{metric:{unit:"VAR",ratio:1}}},Ot}var It,fn;function eo(){if(fn)return It;fn=1;var e;return e={VA:{name:{singular:"Volt-Ampere",plural:"Volt-Amperes"},to_anchor:1},mVA:{name:{singular:"Millivolt-Ampere",plural:"Millivolt-Amperes"},to_anchor:.001},kVA:{name:{singular:"Kilovolt-Ampere",plural:"Kilovolt-Amperes"},to_anchor:1e3},MVA:{name:{singular:"Megavolt-Ampere",plural:"Megavolt-Amperes"},to_anchor:1e6},GVA:{name:{singular:"Gigavolt-Ampere",plural:"Gigavolt-Amperes"},to_anchor:1e9}},It={metric:e,_anchors:{metric:{unit:"VA",ratio:1}}},It}var wt,mn;function to(){if(mn)return wt;mn=1;var e;return e={Wh:{name:{singular:"Watt-hour",plural:"Watt-hours"},to_anchor:3600},mWh:{name:{singular:"Milliwatt-hour",plural:"Milliwatt-hours"},to_anchor:3.6},kWh:{name:{singular:"Kilowatt-hour",plural:"Kilowatt-hours"},to_anchor:36e5},MWh:{name:{singular:"Megawatt-hour",plural:"Megawatt-hours"},to_anchor:36e8},GWh:{name:{singular:"Gigawatt-hour",plural:"Gigawatt-hours"},to_anchor:36e11},J:{name:{singular:"Joule",plural:"Joules"},to_anchor:1},kJ:{name:{singular:"Kilojoule",plural:"Kilojoules"},to_anchor:1e3}},wt={metric:e,_anchors:{metric:{unit:"J",ratio:1}}},wt}var At,gn;function ro(){if(gn)return At;gn=1;var e;return e={VARh:{name:{singular:"Volt-Ampere Reactive Hour",plural:"Volt-Amperes Reactive Hour"},to_anchor:1},mVARh:{name:{singular:"Millivolt-Ampere Reactive Hour",plural:"Millivolt-Amperes Reactive Hour"},to_anchor:.001},kVARh:{name:{singular:"Kilovolt-Ampere Reactive Hour",plural:"Kilovolt-Amperes Reactive Hour"},to_anchor:1e3},MVARh:{name:{singular:"Megavolt-Ampere Reactive Hour",plural:"Megavolt-Amperes Reactive Hour"},to_anchor:1e6},GVARh:{name:{singular:"Gigavolt-Ampere Reactive Hour",plural:"Gigavolt-Amperes Reactive Hour"},to_anchor:1e9}},At={metric:e,_anchors:{metric:{unit:"VARh",ratio:1}}},At}var Pt,yn;function no(){if(yn)return Pt;yn=1;var e,t;return e={"mm3/s":{name:{singular:"Cubic Millimeter per second",plural:"Cubic Millimeters per second"},to_anchor:1/1e6},"cm3/s":{name:{singular:"Cubic Centimeter per second",plural:"Cubic Centimeters per second"},to_anchor:1/1e3},"ml/s":{name:{singular:"Millilitre per second",plural:"Millilitres per second"},to_anchor:1/1e3},"cl/s":{name:{singular:"Centilitre per second",plural:"Centilitres per second"},to_anchor:1/100},"dl/s":{name:{singular:"Decilitre per second",plural:"Decilitres per second"},to_anchor:1/10},"l/s":{name:{singular:"Litre per second",plural:"Litres per second"},to_anchor:1},"l/min":{name:{singular:"Litre per minute",plural:"Litres per minute"},to_anchor:1/60},"l/h":{name:{singular:"Litre per hour",plural:"Litres per hour"},to_anchor:1/3600},"kl/s":{name:{singular:"Kilolitre per second",plural:"Kilolitres per second"},to_anchor:1e3},"kl/min":{name:{singular:"Kilolitre per minute",plural:"Kilolitres per minute"},to_anchor:50/3},"kl/h":{name:{singular:"Kilolitre per hour",plural:"Kilolitres per hour"},to_anchor:5/18},"m3/s":{name:{singular:"Cubic meter per second",plural:"Cubic meters per second"},to_anchor:1e3},"m3/min":{name:{singular:"Cubic meter per minute",plural:"Cubic meters per minute"},to_anchor:50/3},"m3/h":{name:{singular:"Cubic meter per hour",plural:"Cubic meters per hour"},to_anchor:5/18},"km3/s":{name:{singular:"Cubic kilometer per second",plural:"Cubic kilometers per second"},to_anchor:1e12}},t={"tsp/s":{name:{singular:"Teaspoon per second",plural:"Teaspoons per second"},to_anchor:1/6},"Tbs/s":{name:{singular:"Tablespoon per second",plural:"Tablespoons per second"},to_anchor:1/2},"in3/s":{name:{singular:"Cubic inch per second",plural:"Cubic inches per second"},to_anchor:.55411},"in3/min":{name:{singular:"Cubic inch per minute",plural:"Cubic inches per minute"},to_anchor:.55411/60},"in3/h":{name:{singular:"Cubic inch per hour",plural:"Cubic inches per hour"},to_anchor:.55411/3600},"fl-oz/s":{name:{singular:"Fluid Ounce per second",plural:"Fluid Ounces per second"},to_anchor:1},"fl-oz/min":{name:{singular:"Fluid Ounce per minute",plural:"Fluid Ounces per minute"},to_anchor:1/60},"fl-oz/h":{name:{singular:"Fluid Ounce per hour",plural:"Fluid Ounces per hour"},to_anchor:1/3600},"cup/s":{name:{singular:"Cup per second",plural:"Cups per second"},to_anchor:8},"pnt/s":{name:{singular:"Pint per second",plural:"Pints per second"},to_anchor:16},"pnt/min":{name:{singular:"Pint per minute",plural:"Pints per minute"},to_anchor:4/15},"pnt/h":{name:{singular:"Pint per hour",plural:"Pints per hour"},to_anchor:1/225},"qt/s":{name:{singular:"Quart per second",plural:"Quarts per second"},to_anchor:32},"gal/s":{name:{singular:"Gallon per second",plural:"Gallons per second"},to_anchor:128},"gal/min":{name:{singular:"Gallon per minute",plural:"Gallons per minute"},to_anchor:32/15},"gal/h":{name:{singular:"Gallon per hour",plural:"Gallons per hour"},to_anchor:8/225},"ft3/s":{name:{singular:"Cubic foot per second",plural:"Cubic feet per second"},to_anchor:957.506},"ft3/min":{name:{singular:"Cubic foot per minute",plural:"Cubic feet per minute"},to_anchor:957.506/60},"ft3/h":{name:{singular:"Cubic foot per hour",plural:"Cubic feet per hour"},to_anchor:957.506/3600},"yd3/s":{name:{singular:"Cubic yard per second",plural:"Cubic yards per second"},to_anchor:25852.7},"yd3/min":{name:{singular:"Cubic yard per minute",plural:"Cubic yards per minute"},to_anchor:25852.7/60},"yd3/h":{name:{singular:"Cubic yard per hour",plural:"Cubic yards per hour"},to_anchor:25852.7/3600}},Pt={metric:e,imperial:t,_anchors:{metric:{unit:"l/s",ratio:33.8140227},imperial:{unit:"fl-oz/s",ratio:1/33.8140227}}},Pt}var Nt,_n;function io(){if(_n)return Nt;_n=1;var e,t;return e={lx:{name:{singular:"Lux",plural:"Lux"},to_anchor:1}},t={"ft-cd":{name:{singular:"Foot-candle",plural:"Foot-candles"},to_anchor:1}},Nt={metric:e,imperial:t,_anchors:{metric:{unit:"lx",ratio:1/10.76391},imperial:{unit:"ft-cd",ratio:10.76391}}},Nt}var Rt,vn;function oo(){if(vn)return Rt;vn=1;var e;return e={mHz:{name:{singular:"millihertz",plural:"millihertz"},to_anchor:1/1e3},Hz:{name:{singular:"hertz",plural:"hertz"},to_anchor:1},kHz:{name:{singular:"kilohertz",plural:"kilohertz"},to_anchor:1e3},MHz:{name:{singular:"megahertz",plural:"megahertz"},to_anchor:1e3*1e3},GHz:{name:{singular:"gigahertz",plural:"gigahertz"},to_anchor:1e3*1e3*1e3},THz:{name:{singular:"terahertz",plural:"terahertz"},to_anchor:1e3*1e3*1e3*1e3},rpm:{name:{singular:"rotation per minute",plural:"rotations per minute"},to_anchor:1/60},"deg/s":{name:{singular:"degree per second",plural:"degrees per second"},to_anchor:1/360},"rad/s":{name:{singular:"radian per second",plural:"radians per second"},to_anchor:1/(Math.PI*2)}},Rt={metric:e,_anchors:{frequency:{unit:"hz",ratio:1}}},Rt}var Ft,Cn;function ao(){if(Cn)return Ft;Cn=1;var e;return e={rad:{name:{singular:"radian",plural:"radians"},to_anchor:180/Math.PI},deg:{name:{singular:"degree",plural:"degrees"},to_anchor:1},grad:{name:{singular:"gradian",plural:"gradians"},to_anchor:9/10},arcmin:{name:{singular:"arcminute",plural:"arcminutes"},to_anchor:1/60},arcsec:{name:{singular:"arcsecond",plural:"arcseconds"},to_anchor:1/3600}},Ft={metric:e,_anchors:{metric:{unit:"deg",ratio:1}}},Ft}var Dt,En;function so(){if(En)return Dt;En=1;var e,t=Nr(),r=Ui(),n={length:qi(),area:Gi(),mass:Vi(),volume:xi(),each:Bi(),temperature:$i(),time:Ki(),digital:Hi(),partsPer:zi(),speed:Wi(),pace:Ji(),pressure:Yi(),current:Zi(),voltage:Xi(),power:Qi(),reactivePower:ji(),apparentPower:eo(),energy:to(),reactiveEnergy:ro(),volumeFlowRate:no(),illuminance:io(),frequency:oo(),angle:ao()},i;i=function(a,s){s?this.val=a/s:this.val=a},i.prototype.from=function(a){if(this.destination)throw new Error(".from must be called before .to");return this.origin=this.getUnit(a),this.origin||this.throwUnsupportedUnitError(a),this},i.prototype.to=function(a){if(!this.origin)throw new Error(".to must be called after .from");this.destination=this.getUnit(a);var s,l;if(this.destination||this.throwUnsupportedUnitError(a),this.origin.abbr===this.destination.abbr)return this.val;if(this.destination.measure!=this.origin.measure)throw new Error("Cannot convert incompatible measures of "+this.destination.measure+" and "+this.origin.measure);return s=this.val*this.origin.unit.to_anchor,this.origin.unit.anchor_shift&&(s-=this.origin.unit.anchor_shift),this.origin.system!=this.destination.system&&(l=n[this.origin.measure]._anchors[this.origin.system].transform,typeof l=="function"?s=l(s):s*=n[this.origin.measure]._anchors[this.origin.system].ratio),this.destination.unit.anchor_shift&&(s+=this.destination.unit.anchor_shift),s/this.destination.unit.to_anchor},i.prototype.toBest=function(s){if(!this.origin)throw new Error(".toBest must be called after .from");var s=Object.assign({exclude:[],cutOffNumber:1},s),l;return r(this.possibilities(),(function(c){var h=this.describe(c),d=s.exclude.indexOf(c)===-1;if(d&&h.system===this.origin.system){var u=this.to(c);(!l||u>=s.cutOffNumber&&u<l.val)&&(l={val:u,unit:c,singular:h.singular,plural:h.plural})}}).bind(this)),l},i.prototype.getUnit=function(a){var s;return r(n,function(l,c){if(r(l,function(h,d){if(d=="_anchors"||(r(h,function(u,p){if(p==a)return s={abbr:a,measure:c,system:d,unit:u},!1}),s))return!1}),s)return!1}),s};var o=function(a){return{abbr:a.abbr,measure:a.measure,system:a.system,singular:a.unit.name.singular,plural:a.unit.name.plural}};return i.prototype.describe=function(a){var s=i.prototype.getUnit(a),l=null;try{l=o(s)}catch{this.throwUnsupportedUnitError(a)}return l},i.prototype.list=function(a){var s=[];return r(n,function(l,c){a&&a!==c||r(l,function(h,d){if(d=="_anchors")return!1;r(h,function(u,p){s=s.concat(o({abbr:p,measure:c,system:d,unit:u}))})})}),s},i.prototype.throwUnsupportedUnitError=function(a){var s=[];throw r(n,function(l,c){r(l,function(h,d){if(d=="_anchors")return!1;s=s.concat(t(h))})}),new Error("Unsupported unit "+a+", use one of: "+s.join(", "))},i.prototype.possibilities=function(a){var s=[];return!this.origin&&!a?r(t(n),function(l){r(n[l],function(c,h){if(h=="_anchors")return!1;s=s.concat(t(c))})}):(a=a||this.origin.measure,r(n[a],function(l,c){if(c=="_anchors")return!1;s=s.concat(t(l))})),s},i.prototype.measures=function(){return t(n)},e=function(a){return new i(a)},Dt=e,Dt}var lo=so();const X=pe(lo),oe="source-draw-labels",Me="layer-draw-labels",uo={type:"FeatureCollection",features:[]};class co{constructor(t){this.options=t,this._drawCtrl=new ne({displayControlsDefault:!1,styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":this.options?.style?.lengthMeasurement?.lineColor??"#D20C0C","line-dasharray":[.2,2],"line-width":this.options?.style?.lengthMeasurement?.lineWidth??2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":this.options?.style?.areaMeasurement?.fillColor??"#D20C0C","fill-outline-color":this.options?.style?.areaMeasurement?.fillOutlineColor??"#D20C0C","fill-opacity":this.options?.style?.areaMeasurement?.fillOpacity??.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":this.options?.style?.common?.midPointRadius??3,"circle-color":this.options?.style?.common?.midPointColor??"#fbb03b"}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":this.options?.style?.areaMeasurement?.fillOutlineColor??"#D20C0C","line-dasharray":[.2,2],"line-width":this.options?.style?.areaMeasurement?.lineWidth??2}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":this.options?.style?.common?.midPointHaloRadius??3,"circle-color":this.options?.style?.common?.midPointHaloColor??"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":this.options?.style?.common?.midPointRadius??3,"circle-color":this.options?.style?.common?.midPointColor??"#fbb03b"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":this.options?.style?.lengthMeasurement?.lineColor??"#D20C0C","line-width":this.options?.style?.lengthMeasurement?.lineWidth??3}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","$type","Polygon"],["==","mode","static"]],paint:{"fill-color":this.options?.style?.areaMeasurement?.fillColor??"#000","fill-outline-color":this.options?.style?.areaMeasurement?.fillOutlineColor??"#000","fill-opacity":this.options?.style?.areaMeasurement?.fillOpacity??.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":this.options?.style?.areaMeasurement?.fillOutlineColor??"#000","line-width":this.options?.style?.areaMeasurement?.lineWidth??2}}]})}onAdd(t){return this._map=t,this._map.addControl(this._drawCtrl,"top-left"),this._initControl(),this._registerEvents(),this._container}_initControl(){this._container=document.createElement("div"),this._container.className="maplibregl-ctrl mapboxgl-ctrl maplibregl-measures maplibregl-ctrl-group mapboxgl-ctrl-group",this.initDrawBtn(this._drawCtrl.modes.DRAW_LINE_STRING),this.initDrawBtn(this._drawCtrl.modes.DRAW_POLYGON),this.initClearBtn()}_formatMeasure(t,r=!1){return this.options?.units==="imperial"?r?this._formatAreaToImperialSystem(t):this._formatToImperialSystem(t):r?this._formatAreaToMetricSystem(t):this._formatToMetricSystem(t)}_formatAreaToMetricSystem(t){let r=X(t).from("m2").toBest({system:"metric"}),n=r.unit.replaceAll("2","");return`${this._getLocaleNumber(r.val)} ${n}`}_formatAreaToImperialSystem(t){let r=X(t).from("m2").to("mi2");r=X(r).from("mi2").toBest({system:"imperial"});let n=r.unit.replaceAll("2","");return`${this._getLocaleNumber(r.val)} ${n}`}_formatToMetricSystem(t){let r=X(t).from("m").toBest({system:"metric"});return`${this._getLocaleNumber(r.val)} ${r.unit}`}_formatToImperialSystem(t){let r=X(t).from("m").to("mi");return r=X(r).from("mi").toBest({system:"imperial"}),`${this._getLocaleNumber(r.val)} ${r.unit}`}_getLocaleNumber(t){let r=t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2,useGrouping:!this.options?.unitsGroupingSeparator}),n=this.options?.unitsGroupingSeparator;return n&&(r=r.replace(/\B(?=(\d{3})+(?!\d))/g,n)),r}initDrawBtn(t){let r=document.createElement("button");switch(r.type="button",t){case this._drawCtrl.modes.DRAW_LINE_STRING:r.title=this.options?.lang?.lengthMeasurementButtonTitle??"",r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 512 512" xml:space="preserve" style="padding:4px">
               <path d="M503.467,0h-51.2c-4.71,0-8.533,3.814-8.533,8.533v51.2c0,4.719,3.823,8.533,8.533,8.533h16.077
                   c-15.027,136.132-31.095,243.354-75.81,275.678V332.8c0-4.719-3.823-8.533-8.533-8.533h-51.2c-4.71,0-8.533,3.814-8.533,8.533
                   v9.207c-24.226-20.591-47.59-60.45-70.298-99.26c-22.485-38.426-43.793-74.795-66.236-93.269V128c0-4.719-3.823-8.533-8.533-8.533
                   H128c-4.71,0-8.533,3.814-8.533,8.533v20.326c-45.833,25.207-73.916,114.697-93.005,295.407H8.533
                   c-4.71,0-8.533,3.814-8.533,8.533v51.2C0,508.186,3.823,512,8.533,512h51.2c4.71,0,8.533-3.814,8.533-8.533v-51.2
                   c0-4.719-3.823-8.533-8.533-8.533H43.622c16.734-157.124,41.054-245.598,75.844-274.765V179.2c0,4.719,3.823,8.533,8.533,8.533
                   h51.2c4.71,0,8.533-3.814,8.533-8.533v-5.973c16.614,18.56,33.664,47.667,51.499,78.14
                   c26.539,45.363,53.948,92.117,85.035,111.829V384c0,4.719,3.823,8.533,8.533,8.533H384c4.71,0,8.533-3.814,8.533-8.533v-20.096
                   c58.539-29.158,75.981-141.21,92.979-295.637h17.954c4.71,0,8.533-3.814,8.533-8.533v-51.2C512,3.814,508.177,0,503.467,0z"/>
           </svg>`;break;case this._drawCtrl.modes.DRAW_POLYGON:r.title=this.options?.lang?.areaMeasurementButtonTitle??"",r.innerHTML=`<svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 38C18 40.2091 16.2091 42 14 42C11.7909 42 10 40.2091 10 38C10 35.7909 11.7909 34 14 34C16.2091 34 18 35.7909 18 38Z" fill="#333333"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M14 40C15.1046 40 16 39.1046 16 38C16 36.8954 15.1046 36 14 36C12.8954 36 12 36.8954 12 38C12 39.1046 12.8954 40 14 40ZM14 42C16.2091 42 18 40.2091 18 38C18 35.7909 16.2091 34 14 34C11.7909 34 10 35.7909 10 38C10 40.2091 11.7909 42 14 42Z" fill="#333333"/>
                <path d="M14 20C14 22.2091 12.2091 24 10 24C7.79086 24 6 22.2091 6 20C6 17.7909 7.79086 16 10 16C12.2091 16 14 17.7909 14 20Z" fill="#333333"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M10 22C11.1046 22 12 21.1046 12 20C12 18.8954 11.1046 18 10 18C8.89543 18 8 18.8954 8 20C8 21.1046 8.89543 22 10 22ZM10 24C12.2091 24 14 22.2091 14 20C14 17.7909 12.2091 16 10 16C7.79086 16 6 17.7909 6 20C6 22.2091 7.79086 24 10 24Z" fill="#333333"/>
                <path d="M42 20C42 22.2091 40.2091 24 38 24C35.7909 24 34 22.2091 34 20C34 17.7909 35.7909 16 38 16C40.2091 16 42 17.7909 42 20Z" fill="#333333"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M38 22C39.1046 22 40 21.1046 40 20C40 18.8954 39.1046 18 38 18C36.8954 18 36 18.8954 36 20C36 21.1046 36.8954 22 38 22ZM38 24C40.2091 24 42 22.2091 42 20C42 17.7909 40.2091 16 38 16C35.7909 16 34 17.7909 34 20C34 22.2091 35.7909 24 38 24Z" fill="#333333"/>
                <path d="M38 38C38 40.2091 36.2091 42 34 42C31.7909 42 30 40.2091 30 38C30 35.7909 31.7909 34 34 34C36.2091 34 38 35.7909 38 38Z" fill="#333333"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M34 40C35.1046 40 36 39.1046 36 38C36 36.8954 35.1046 36 34 36C32.8954 36 32 36.8954 32 38C32 39.1046 32.8954 40 34 40ZM34 42C36.2091 42 38 40.2091 38 38C38 35.7909 36.2091 34 34 34C31.7909 34 30 35.7909 30 38C30 40.2091 31.7909 42 34 42Z" fill="#333333"/>
                <path d="M28 10C28 12.2091 26.2091 14 24 14C21.7909 14 20 12.2091 20 10C20 7.79086 21.7909 6 24 6C26.2091 6 28 7.79086 28 10Z" fill="#333333"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M24 12C25.1046 12 26 11.1046 26 10C26 8.89543 25.1046 8 24 8C22.8954 8 22 8.89543 22 10C22 11.1046 22.8954 12 24 12ZM24 14C26.2091 14 28 12.2091 28 10C28 7.79086 26.2091 6 24 6C21.7909 6 20 7.79086 20 10C20 12.2091 21.7909 14 24 14Z" fill="#333333"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M34.9188 19.028L25.9188 12.5994L27.0812 10.9719L36.0812 17.4005L34.9188 19.028ZM21.7844 12.8114L13.0812 19.028L11.9187 17.4005L20.6219 11.1839L21.7844 12.8114ZM11.6428 22.783L14.3095 34.783L12.3571 35.2169L9.69047 23.2169L11.6428 22.783ZM33.6905 34.783L36.246 23.283L38.1984 23.7169L35.6428 35.2169L33.6905 34.783ZM17 36.9999H31V38.9999H17V36.9999Z" fill="#333333"/>
                </svg>
                `;break}r.addEventListener("click",()=>{this._drawCtrl.changeMode(t)}),this._container.appendChild(r)}initClearBtn(){let t=document.createElement("button");t.type="button",t.title=this.options?.lang?.clearMeasurementsButtonTitle??"",t.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 465.311 465.311" style="padding:5px" xml:space="preserve">
                            <g>
                                <path d="M372.811,51.002h-59.908V36.566C312.902,16.404,296.499,0,276.335,0h-87.356c-20.163,0-36.567,16.404-36.567,36.566v14.436
                                    H92.5c-20.726,0-37.587,16.861-37.587,37.587v38.91c0,8.284,6.716,15,15,15h7.728v307.812c0,8.284,6.716,15,15,15H372.67
                                    c8.284,0,15-6.716,15-15V142.499h7.728c8.284,0,15-6.716,15-15v-38.91C410.397,67.863,393.536,51.002,372.811,51.002z
                                        M182.412,36.566c0-3.621,2.946-6.566,6.567-6.566h87.356c3.621,0,6.567,2.946,6.567,6.566v14.436h-100.49V36.566z M84.914,88.589
                                    c0-4.184,3.403-7.587,7.587-7.587h280.31c4.184,0,7.587,3.403,7.587,7.587v23.91H84.914V88.589z M357.67,435.311H107.641V142.499
                                    H357.67V435.311z"/>
                                <path d="M137.41,413.485c5.523,0,10-4.477,10-10V166.497c0-5.523-4.477-10-10-10s-10,4.477-10,10v236.988
                                    C127.41,409.008,131.887,413.485,137.41,413.485z"/>
                                <path d="M200.907,413.485c5.523,0,10-4.477,10-10V166.497c0-5.523-4.477-10-10-10s-10,4.477-10,10v236.988
                                    C190.907,409.008,195.384,413.485,200.907,413.485z"/>
                                <path d="M264.404,413.485c5.523,0,10-4.477,10-10V166.497c0-5.523-4.477-10-10-10s-10,4.477-10,10v236.988
                                    C254.404,409.008,258.881,413.485,264.404,413.485z"/>
                                <path d="M327.901,413.485c5.523,0,10-4.477,10-10V166.497c0-5.523-4.477-10-10-10s-10,4.477-10,10v236.988
                                    C317.901,409.008,322.378,413.485,327.901,413.485z"/>
                            </g>
                            </svg>`,t.addEventListener("click",()=>{this._drawCtrl.deleteAll(),this._updateLabels()}),this._container.appendChild(t)}_registerEvents(){this._map&&(this._map.on("load",()=>{this._recreateSourceAndLayers()}),this._map.on("draw.create",()=>{this._updateLabels(),this._handleOnCreate()}),this._map.on("draw.update",this._updateLabels.bind(this)),this._map.on("draw.delete",this._updateLabels.bind(this)),this._map.on("draw.render",()=>{this._updateLabels(),this._handleOnRender()}))}_recreateSourceAndLayers(){this._map.getSource(oe)||this._map.addSource(oe,{type:"geojson",data:uo}),this._map.getLayer(Me)||this._map.addLayer({id:Me,type:"symbol",source:oe,layout:{"text-font":[this.options?.style?.text?.font??"Klokantech Noto Sans Bold"],"text-field":["get","measurement"],"text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":this.options?.style?.text?.radialOffset??.5,"text-justify":"auto","text-letter-spacing":this.options?.style?.text?.letterSpacing??.05,"text-size":["interpolate",["linear"],["zoom"],5,10,10,12,13,14,14,16,18,18]},paint:{"text-color":this.options?.style?.text?.color??"#D20C0C","text-halo-color":this.options?.style?.text?.haloColor??"#fff","text-halo-width":this.options?.style?.text?.haloWidth??10}})}_reorderLayers(){if(this._map){let t=Object.values(ne.constants.sources);this._map.getStyle().layers.filter(r=>t.includes(r.source)).forEach(r=>{this._map.moveLayer(r.id)}),this._map.moveLayer(Me)}}_handleOnRender(){if(this.options&&this.options.onRender!==null&&this.options.onRender!==void 0&&this.options.onRender instanceof Function){const t=this._getDrawnFeatures();try{this.options.onRender.call(this,t)}catch(r){console.error(r)}}}_handleOnCreate(){if(this.options&&this.options.onCreate!==null&&this.options.onCreate!==void 0&&this.options.onCreate instanceof Function){const t=this._getDrawnFeatures();try{this.options.onCreate.call(this,t)}catch(r){console.error(r)}}}_updateLabels(){let t=this._map.getSource(oe);!t&&this._map&&(this._recreateSourceAndLayers(),t=this._map.getSource(oe));const r=this._getDrawnFeatures();t.setData(r),this._reorderLayers()}_getDrawnFeatures(){let t=[];return this._drawCtrl.getAll().features.forEach(n=>{try{if(n.geometry.type==="Polygon"){let i=this._formatMeasure(Ei(n),!0),o=Ke(n),a=`${i}`;o.properties={measurement:a},t.push(o)}else if(n.geometry.type==="LineString")if(this.options?.showOnlyTotalLineLength){const i=this._formatMeasure(Lr(n)*1e3),o=Ke(n),a=`${i}`;o.properties={measurement:a},t.push(o)}else Si(n).features.forEach(o=>{let a=Ke(o),l=`${this._formatMeasure(Lr(o)*1e3)}`;a.properties={measurement:l},t.push(a)})}catch{}}),{type:"FeatureCollection",features:t}}onRemove(){this._container.parentNode.removeChild(this._container),this._map.removeLayer(Me),this._map=void 0}}J.default=co,Object.defineProperties(J,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=maplibre-gl-measures.js.map
