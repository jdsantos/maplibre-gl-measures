{"version":3,"file":"maplibre-gl-measures.js","sources":["../node_modules/@mapbox/mapbox-gl-draw/src/constants.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/common_selectors.js","../node_modules/wgs84/index.js","../node_modules/@mapbox/geojson-area/index.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/sort_features.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/map_event_to_bounding_box.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/string_set.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/features_at.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/get_features_and_set_cursor.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/euclidean_distance.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/is_click.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/is_tap.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/mode_handler.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/id.js","../node_modules/nanoid/non-secure/index.js","../node_modules/@mapbox/mapbox-gl-draw/src/feature_types/feature.js","../node_modules/@mapbox/mapbox-gl-draw/src/feature_types/point.js","../node_modules/@mapbox/mapbox-gl-draw/src/feature_types/line_string.js","../node_modules/@mapbox/mapbox-gl-draw/src/feature_types/polygon.js","../node_modules/@mapbox/mapbox-gl-draw/src/feature_types/multi_feature.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/mode_interface_accessors.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/mode_interface.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/object_to_mode.js","../node_modules/@mapbox/mapbox-gl-draw/src/events.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/to_dense_array.js","../node_modules/@mapbox/mapbox-gl-draw/src/render.js","../node_modules/@mapbox/mapbox-gl-draw/src/store.js","../node_modules/@mapbox/mapbox-gl-draw/src/ui.js","../node_modules/@mapbox/mapbox-gl-draw/src/setup.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/theme.js","../node_modules/@mapbox/point-geometry/index.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/mouse_event_point.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/create_vertex.js","../node_modules/@turf/helpers/dist/esm/index.js","../node_modules/@turf/meta/dist/esm/index.js","../node_modules/@turf/clone/dist/esm/index.js","../node_modules/@turf/projection/dist/esm/index.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/create_midpoint.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/create_supplementary_points.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/double_click_zoom.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/constrain_feature_movement.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/move_features.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/simple_select.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/direct_select.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/draw_point.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/is_event_at_coordinates.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/draw_polygon.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/draw_line_string.js","../node_modules/@mapbox/mapbox-gl-draw/src/modes/index.js","../node_modules/@mapbox/mapbox-gl-draw/src/options.js","../node_modules/fast-deep-equal/index.js","../node_modules/@mapbox/geojson-normalize/index.js","../node_modules/@mapbox/mapbox-gl-draw/src/lib/string_sets_are_equal.js","../node_modules/@mapbox/mapbox-gl-draw/src/api.js","../node_modules/@mapbox/mapbox-gl-draw/index.js","../node_modules/@turf/invariant/dist/esm/index.js","../node_modules/@turf/distance/dist/esm/index.js","../node_modules/@turf/area/dist/esm/index.js","../node_modules/@turf/line-segment/dist/esm/index.js","../node_modules/@turf/centroid/dist/esm/index.js","../node_modules/@turf/length/dist/esm/index.js","../src/convert-units.js","../src/maplibre-gl-measures.js"],"sourcesContent":["export const classes = {\n  CANVAS: 'mapboxgl-canvas',\n  CONTROL_BASE: 'mapboxgl-ctrl',\n  CONTROL_PREFIX: 'mapboxgl-ctrl-',\n  CONTROL_BUTTON: 'mapbox-gl-draw_ctrl-draw-btn',\n  CONTROL_BUTTON_LINE: 'mapbox-gl-draw_line',\n  CONTROL_BUTTON_POLYGON: 'mapbox-gl-draw_polygon',\n  CONTROL_BUTTON_POINT: 'mapbox-gl-draw_point',\n  CONTROL_BUTTON_TRASH: 'mapbox-gl-draw_trash',\n  CONTROL_BUTTON_COMBINE_FEATURES: 'mapbox-gl-draw_combine',\n  CONTROL_BUTTON_UNCOMBINE_FEATURES: 'mapbox-gl-draw_uncombine',\n  CONTROL_GROUP: 'mapboxgl-ctrl-group',\n  ATTRIBUTION: 'mapboxgl-ctrl-attrib',\n  ACTIVE_BUTTON: 'active',\n  BOX_SELECT: 'mapbox-gl-draw_boxselect'\n};\n\nexport const sources = {\n  HOT: 'mapbox-gl-draw-hot',\n  COLD: 'mapbox-gl-draw-cold'\n};\n\nexport const cursors = {\n  ADD: 'add',\n  MOVE: 'move',\n  DRAG: 'drag',\n  POINTER: 'pointer',\n  NONE: 'none'\n};\n\nexport const types = {\n  POLYGON: 'polygon',\n  LINE: 'line_string',\n  POINT: 'point'\n};\n\nexport const geojsonTypes = {\n  FEATURE: 'Feature',\n  POLYGON: 'Polygon',\n  LINE_STRING: 'LineString',\n  POINT: 'Point',\n  FEATURE_COLLECTION: 'FeatureCollection',\n  MULTI_PREFIX: 'Multi',\n  MULTI_POINT: 'MultiPoint',\n  MULTI_LINE_STRING: 'MultiLineString',\n  MULTI_POLYGON: 'MultiPolygon'\n};\n\nexport const modes = {\n  DRAW_LINE_STRING: 'draw_line_string',\n  DRAW_POLYGON: 'draw_polygon',\n  DRAW_POINT: 'draw_point',\n  SIMPLE_SELECT: 'simple_select',\n  DIRECT_SELECT: 'direct_select'\n};\n\nexport const events = {\n  CREATE: 'draw.create',\n  DELETE: 'draw.delete',\n  UPDATE: 'draw.update',\n  SELECTION_CHANGE: 'draw.selectionchange',\n  MODE_CHANGE: 'draw.modechange',\n  ACTIONABLE: 'draw.actionable',\n  RENDER: 'draw.render',\n  COMBINE_FEATURES: 'draw.combine',\n  UNCOMBINE_FEATURES: 'draw.uncombine'\n};\n\nexport const updateActions = {\n  MOVE: 'move',\n  CHANGE_PROPERTIES: 'change_properties',\n  CHANGE_COORDINATES: 'change_coordinates'\n};\n\nexport const meta = {\n  FEATURE: 'feature',\n  MIDPOINT: 'midpoint',\n  VERTEX: 'vertex'\n};\n\nexport const activeStates = {\n  ACTIVE: 'true',\n  INACTIVE: 'false'\n};\n\nexport const interactions = [\n  'scrollZoom',\n  'boxZoom',\n  'dragRotate',\n  'dragPan',\n  'keyboard',\n  'doubleClickZoom',\n  'touchZoomRotate'\n];\n\nexport const LAT_MIN = -90;\nexport const LAT_RENDERED_MIN = -85;\nexport const LAT_MAX = 90;\nexport const LAT_RENDERED_MAX = 85;\nexport const LNG_MIN = -270;\nexport const LNG_MAX = 270;\n","import * as Constants from '../constants.js';\n\nexport function isOfMetaType(type) {\n  return function(e) {\n    const featureTarget = e.featureTarget;\n    if (!featureTarget) return false;\n    if (!featureTarget.properties) return false;\n    return featureTarget.properties.meta === type;\n  };\n}\n\nexport function isShiftMousedown(e) {\n  if (!e.originalEvent) return false;\n  if (!e.originalEvent.shiftKey) return false;\n  return e.originalEvent.button === 0;\n}\n\nexport function isActiveFeature(e) {\n  if (!e.featureTarget) return false;\n  if (!e.featureTarget.properties) return false;\n  return e.featureTarget.properties.active === Constants.activeStates.ACTIVE &&\n    e.featureTarget.properties.meta === Constants.meta.FEATURE;\n}\n\nexport function isInactiveFeature(e) {\n  if (!e.featureTarget) return false;\n  if (!e.featureTarget.properties) return false;\n  return e.featureTarget.properties.active === Constants.activeStates.INACTIVE &&\n    e.featureTarget.properties.meta === Constants.meta.FEATURE;\n}\n\nexport function noTarget(e) {\n  return e.featureTarget === undefined;\n}\n\nexport function isFeature(e) {\n  if (!e.featureTarget) return false;\n  if (!e.featureTarget.properties) return false;\n  return e.featureTarget.properties.meta === Constants.meta.FEATURE;\n}\n\nexport function isVertex(e) {\n  const featureTarget = e.featureTarget;\n  if (!featureTarget) return false;\n  if (!featureTarget.properties) return false;\n  return featureTarget.properties.meta === Constants.meta.VERTEX;\n}\n\nexport function isShiftDown(e) {\n  if (!e.originalEvent) return false;\n  return e.originalEvent.shiftKey === true;\n}\n\nexport function isEscapeKey(e) {\n  return e.key === 'Escape' || e.keyCode === 27;\n}\n\nexport function isEnterKey(e) {\n  return e.key === 'Enter' || e.keyCode === 13;\n}\n\nexport function isBackspaceKey(e) {\n  return e.key === 'Backspace' || e.keyCode === 8;\n}\n\nexport function isDeleteKey(e) {\n  return e.key === 'Delete' || e.keyCode === 46;\n}\n\nexport function isDigit1Key(e) {\n  return e.key === '1' || e.keyCode === 49;\n}\n\nexport function isDigit2Key(e) {\n  return e.key === '2' || e.keyCode === 50;\n}\n\nexport function isDigit3Key(e) {\n  return e.key === '3' || e.keyCode === 51;\n}\n\nexport function isDigitKey(e) {\n  const key = e.key || String.fromCharCode(e.keyCode);\n  const isDigitKey = key >= '0' && key <= '9';\n  return isDigitKey;\n}\n\nexport function isTrue() {\n  return true;\n}\n","module.exports.RADIUS = 6378137;\nmodule.exports.FLATTENING = 1/298.257223563;\nmodule.exports.POLAR_RADIUS = 6356752.3142;\n","var wgs84 = require('wgs84');\n\nmodule.exports.geometry = geometry;\nmodule.exports.ring = ringArea;\n\nfunction geometry(_) {\n    var area = 0, i;\n    switch (_.type) {\n        case 'Polygon':\n            return polygonArea(_.coordinates);\n        case 'MultiPolygon':\n            for (i = 0; i < _.coordinates.length; i++) {\n                area += polygonArea(_.coordinates[i]);\n            }\n            return area;\n        case 'Point':\n        case 'MultiPoint':\n        case 'LineString':\n        case 'MultiLineString':\n            return 0;\n        case 'GeometryCollection':\n            for (i = 0; i < _.geometries.length; i++) {\n                area += geometry(_.geometries[i]);\n            }\n            return area;\n    }\n}\n\nfunction polygonArea(coords) {\n    var area = 0;\n    if (coords && coords.length > 0) {\n        area += Math.abs(ringArea(coords[0]));\n        for (var i = 1; i < coords.length; i++) {\n            area -= Math.abs(ringArea(coords[i]));\n        }\n    }\n    return area;\n}\n\n/**\n * Calculate the approximate area of the polygon were it projected onto\n *     the earth.  Note that this area will be positive if ring is oriented\n *     clockwise, otherwise it will be negative.\n *\n * Reference:\n * Robert. G. Chamberlain and William H. Duquette, \"Some Algorithms for\n *     Polygons on a Sphere\", JPL Publication 07-03, Jet Propulsion\n *     Laboratory, Pasadena, CA, June 2007 http://trs-new.jpl.nasa.gov/dspace/handle/2014/40409\n *\n * Returns:\n * {float} The approximate signed geodesic area of the polygon in square\n *     meters.\n */\n\nfunction ringArea(coords) {\n    var p1, p2, p3, lowerIndex, middleIndex, upperIndex, i,\n    area = 0,\n    coordsLength = coords.length;\n\n    if (coordsLength > 2) {\n        for (i = 0; i < coordsLength; i++) {\n            if (i === coordsLength - 2) {// i = N-2\n                lowerIndex = coordsLength - 2;\n                middleIndex = coordsLength -1;\n                upperIndex = 0;\n            } else if (i === coordsLength - 1) {// i = N-1\n                lowerIndex = coordsLength - 1;\n                middleIndex = 0;\n                upperIndex = 1;\n            } else { // i = 0 to N-3\n                lowerIndex = i;\n                middleIndex = i+1;\n                upperIndex = i+2;\n            }\n            p1 = coords[lowerIndex];\n            p2 = coords[middleIndex];\n            p3 = coords[upperIndex];\n            area += ( rad(p3[0]) - rad(p1[0]) ) * Math.sin( rad(p2[1]));\n        }\n\n        area = area * wgs84.RADIUS * wgs84.RADIUS / 2;\n    }\n\n    return area;\n}\n\nfunction rad(_) {\n    return _ * Math.PI / 180;\n}","import area from '@mapbox/geojson-area';\nimport * as Constants from '../constants.js';\n\nconst FEATURE_SORT_RANKS = {\n  Point: 0,\n  LineString: 1,\n  MultiLineString: 1,\n  Polygon: 2\n};\n\nfunction comparator(a, b) {\n  const score = FEATURE_SORT_RANKS[a.geometry.type] - FEATURE_SORT_RANKS[b.geometry.type];\n\n  if (score === 0 && a.geometry.type === Constants.geojsonTypes.POLYGON) {\n    return a.area - b.area;\n  }\n\n  return score;\n}\n\n// Sort in the order above, then sort polygons by area ascending.\nfunction sortFeatures(features) {\n  return features.map((feature) => {\n    if (feature.geometry.type === Constants.geojsonTypes.POLYGON) {\n      feature.area = area.geometry({\n        type: Constants.geojsonTypes.FEATURE,\n        property: {},\n        geometry: feature.geometry\n      });\n    }\n    return feature;\n  }).sort(comparator).map((feature) => {\n    delete feature.area;\n    return feature;\n  });\n}\n\nexport default sortFeatures;\n","/**\n * Returns a bounding box representing the event's location.\n *\n * @param {Event} mapEvent - Mapbox GL JS map event, with a point properties.\n * @return {Array<Array<number>>} Bounding box.\n */\nfunction mapEventToBoundingBox(mapEvent, buffer = 0) {\n  return [\n    [mapEvent.point.x - buffer, mapEvent.point.y - buffer],\n    [mapEvent.point.x + buffer, mapEvent.point.y + buffer]\n  ];\n}\n\nexport default mapEventToBoundingBox;\n","function StringSet(items) {\n  this._items = {};\n  this._nums = {};\n  this._length = items ? items.length : 0;\n  if (!items) return;\n  for (let i = 0, l = items.length; i < l; i++) {\n    this.add(items[i]);\n    if (items[i] === undefined) continue;\n    if (typeof items[i] === 'string') this._items[items[i]] = i;\n    else this._nums[items[i]] = i;\n\n  }\n}\n\nStringSet.prototype.add = function(x) {\n  if (this.has(x)) return this;\n  this._length++;\n  if (typeof x === 'string') this._items[x] = this._length;\n  else this._nums[x] = this._length;\n  return this;\n};\n\nStringSet.prototype.delete = function(x) {\n  if (this.has(x) === false) return this;\n  this._length--;\n  delete this._items[x];\n  delete this._nums[x];\n  return this;\n};\n\nStringSet.prototype.has = function(x) {\n  if (typeof x !== 'string' && typeof x !== 'number') return false;\n  return this._items[x] !== undefined || this._nums[x] !== undefined;\n};\n\nStringSet.prototype.values = function() {\n  const values = [];\n  Object.keys(this._items).forEach((k) => {\n    values.push({ k, v: this._items[k] });\n  });\n  Object.keys(this._nums).forEach((k) => {\n    values.push({ k: JSON.parse(k), v: this._nums[k] });\n  });\n\n  return values.sort((a, b) => a.v - b.v).map(a => a.k);\n};\n\nStringSet.prototype.clear = function() {\n  this._length = 0;\n  this._items = {};\n  this._nums = {};\n  return this;\n};\n\nexport default StringSet;\n","import sortFeatures from './sort_features.js';\nimport mapEventToBoundingBox from './map_event_to_bounding_box.js';\nimport * as Constants from '../constants.js';\nimport StringSet from './string_set.js';\n\nconst META_TYPES = [\n  Constants.meta.FEATURE,\n  Constants.meta.MIDPOINT,\n  Constants.meta.VERTEX\n];\n\n// Requires either event or bbox\nexport default {\n  click: featuresAtClick,\n  touch: featuresAtTouch\n};\n\nfunction featuresAtClick(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.clickBuffer);\n}\n\nfunction featuresAtTouch(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.touchBuffer);\n}\n\nfunction featuresAt(event, bbox, ctx, buffer) {\n  if (ctx.map === null) return [];\n\n  const box = (event) ? mapEventToBoundingBox(event, buffer) : bbox;\n\n  const queryParams = {};\n\n  if (ctx.options.styles) queryParams.layers = ctx.options.styles.map(s => s.id).filter(id => ctx.map.getLayer(id) != null);\n\n  const features = ctx.map.queryRenderedFeatures(box, queryParams)\n    .filter(feature => META_TYPES.indexOf(feature.properties.meta) !== -1);\n\n  const featureIds = new StringSet();\n  const uniqueFeatures = [];\n  features.forEach((feature) => {\n    const featureId = feature.properties.id;\n    if (featureIds.has(featureId)) return;\n    featureIds.add(featureId);\n    uniqueFeatures.push(feature);\n  });\n\n  return sortFeatures(uniqueFeatures);\n}\n","import featuresAt from './features_at.js';\nimport * as Constants from '../constants.js';\n\nexport default function getFeatureAtAndSetCursors(event, ctx) {\n  const features = featuresAt.click(event, null, ctx);\n  const classes = { mouse: Constants.cursors.NONE };\n\n  if (features[0]) {\n    classes.mouse = (features[0].properties.active === Constants.activeStates.ACTIVE) ?\n      Constants.cursors.MOVE : Constants.cursors.POINTER;\n    classes.feature = features[0].properties.meta;\n  }\n\n  if (ctx.events.currentModeName().indexOf('draw') !== -1) {\n    classes.mouse = Constants.cursors.ADD;\n  }\n\n  ctx.ui.queueMapClasses(classes);\n  ctx.ui.updateMapClasses();\n\n  return features[0];\n}\n","export default function(a, b) {\n  const x = a.x - b.x;\n  const y = a.y - b.y;\n  return Math.sqrt((x * x) + (y * y));\n}\n","import euclideanDistance from './euclidean_distance.js';\n\nconst FINE_TOLERANCE = 4;\nconst GROSS_TOLERANCE = 12;\nconst INTERVAL = 500;\n\nexport default function isClick(start, end, options = {}) {\n  const fineTolerance = (options.fineTolerance != null) ? options.fineTolerance : FINE_TOLERANCE;\n  const grossTolerance = (options.grossTolerance != null) ? options.grossTolerance : GROSS_TOLERANCE;\n  const interval = (options.interval != null) ? options.interval : INTERVAL;\n\n  start.point = start.point || end.point;\n  start.time = start.time || end.time;\n  const moveDistance = euclideanDistance(start.point, end.point);\n\n  return moveDistance < fineTolerance ||\n    (moveDistance < grossTolerance && (end.time - start.time) < interval);\n}\n","import euclideanDistance from './euclidean_distance.js';\n\nexport const TAP_TOLERANCE = 25;\nexport const TAP_INTERVAL = 250;\n\nexport default function isTap(start, end, options = {}) {\n  const tolerance = (options.tolerance != null) ? options.tolerance : TAP_TOLERANCE;\n  const interval = (options.interval != null) ? options.interval : TAP_INTERVAL;\n\n  start.point = start.point || end.point;\n  start.time = start.time || end.time;\n  const moveDistance = euclideanDistance(start.point, end.point);\n\n  return moveDistance < tolerance && (end.time - start.time) < interval;\n}\n","\nconst ModeHandler = function(mode, DrawContext) {\n\n  const handlers = {\n    drag: [],\n    click: [],\n    mousemove: [],\n    mousedown: [],\n    mouseup: [],\n    mouseout: [],\n    keydown: [],\n    keyup: [],\n    touchstart: [],\n    touchmove: [],\n    touchend: [],\n    tap: []\n  };\n\n  const ctx = {\n    on(event, selector, fn) {\n      if (handlers[event] === undefined) {\n        throw new Error(`Invalid event type: ${event}`);\n      }\n      handlers[event].push({\n        selector,\n        fn\n      });\n    },\n    render(id) {\n      DrawContext.store.featureChanged(id);\n    }\n  };\n\n  const delegate = function (eventName, event) {\n    const handles = handlers[eventName];\n    let iHandle = handles.length;\n    while (iHandle--) {\n      const handle = handles[iHandle];\n      if (handle.selector(event)) {\n        const skipRender = handle.fn.call(ctx, event);\n        if (!skipRender) {\n          DrawContext.store.render();\n        }\n        DrawContext.ui.updateMapClasses();\n\n        // ensure an event is only handled once\n        // we do this to let modes have multiple overlapping selectors\n        // and relay on order of oppertations to filter\n        break;\n      }\n    }\n  };\n\n  mode.start.call(ctx);\n\n  return {\n    render: mode.render,\n    stop() {\n      if (mode.stop) mode.stop();\n    },\n    trash() {\n      if (mode.trash) {\n        mode.trash();\n        DrawContext.store.render();\n      }\n    },\n    combineFeatures() {\n      if (mode.combineFeatures) {\n        mode.combineFeatures();\n      }\n    },\n    uncombineFeatures() {\n      if (mode.uncombineFeatures) {\n        mode.uncombineFeatures();\n      }\n    },\n    drag(event) {\n      delegate('drag', event);\n    },\n    click(event) {\n      delegate('click', event);\n    },\n    mousemove(event) {\n      delegate('mousemove', event);\n    },\n    mousedown(event) {\n      delegate('mousedown', event);\n    },\n    mouseup(event) {\n      delegate('mouseup', event);\n    },\n    mouseout(event) {\n      delegate('mouseout', event);\n    },\n    keydown(event) {\n      delegate('keydown', event);\n    },\n    keyup(event) {\n      delegate('keyup', event);\n    },\n    touchstart(event) {\n      delegate('touchstart', event);\n    },\n    touchmove(event) {\n      delegate('touchmove', event);\n    },\n    touchend(event) {\n      delegate('touchend', event);\n    },\n    tap(event) {\n      delegate('tap', event);\n    }\n  };\n};\n\nexport default ModeHandler;\n","import {customAlphabet} from 'nanoid/non-secure';\n\nconst nanoid = customAlphabet('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz', 32);\n\nexport function generateID() {\n  return nanoid();\n}\n","/* @ts-self-types=\"./index.d.ts\" */\nlet urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\nexport let customAlphabet = (alphabet, defaultSize = 21) => {\n  return (size = defaultSize) => {\n    let id = ''\n    let i = size | 0\n    while (i--) {\n      id += alphabet[(Math.random() * alphabet.length) | 0]\n    }\n    return id\n  }\n}\nexport let nanoid = (size = 21) => {\n  let id = ''\n  let i = size | 0\n  while (i--) {\n    id += urlAlphabet[(Math.random() * 64) | 0]\n  }\n  return id\n}\n","import {generateID} from '../lib/id.js';\nimport * as Constants from '../constants.js';\n\nconst Feature = function(ctx, geojson) {\n  this.ctx = ctx;\n  this.properties = geojson.properties || {};\n  this.coordinates = geojson.geometry.coordinates;\n  this.id = geojson.id || generateID();\n  this.type = geojson.geometry.type;\n};\n\nFeature.prototype.changed = function() {\n  this.ctx.store.featureChanged(this.id);\n};\n\nFeature.prototype.incomingCoords = function(coords) {\n  this.setCoordinates(coords);\n};\n\nFeature.prototype.setCoordinates = function(coords) {\n  this.coordinates = coords;\n  this.changed();\n};\n\nFeature.prototype.getCoordinates = function() {\n  return JSON.parse(JSON.stringify(this.coordinates));\n};\n\nFeature.prototype.setProperty = function(property, value) {\n  this.properties[property] = value;\n};\n\nFeature.prototype.toGeoJSON = function() {\n  return JSON.parse(JSON.stringify({\n    id: this.id,\n    type: Constants.geojsonTypes.FEATURE,\n    properties: this.properties,\n    geometry: {\n      coordinates: this.getCoordinates(),\n      type: this.type\n    }\n  }));\n};\n\nFeature.prototype.internal = function(mode) {\n  const properties = {\n    id: this.id,\n    meta: Constants.meta.FEATURE,\n    'meta:type': this.type,\n    active: Constants.activeStates.INACTIVE,\n    mode\n  };\n\n  if (this.ctx.options.userProperties) {\n    for (const name in this.properties) {\n      properties[`user_${name}`] = this.properties[name];\n    }\n  }\n\n  return {\n    type: Constants.geojsonTypes.FEATURE,\n    properties,\n    geometry: {\n      coordinates: this.getCoordinates(),\n      type: this.type\n    }\n  };\n};\n\nexport default Feature;\n","import Feature from './feature.js';\n\nconst Point = function(ctx, geojson) {\n  Feature.call(this, ctx, geojson);\n};\n\nPoint.prototype = Object.create(Feature.prototype);\n\nPoint.prototype.isValid = function() {\n  return typeof this.coordinates[0] === 'number' &&\n    typeof this.coordinates[1] === 'number';\n};\n\nPoint.prototype.updateCoordinate = function(pathOrLng, lngOrLat, lat) {\n  if (arguments.length === 3) {\n    this.coordinates = [lngOrLat, lat];\n  } else {\n    this.coordinates = [pathOrLng, lngOrLat];\n  }\n  this.changed();\n};\n\nPoint.prototype.getCoordinate = function() {\n  return this.getCoordinates();\n};\n\nexport default Point;\n","import Feature from './feature.js';\n\nconst LineString = function(ctx, geojson) {\n  Feature.call(this, ctx, geojson);\n};\n\nLineString.prototype = Object.create(Feature.prototype);\n\nLineString.prototype.isValid = function() {\n  return this.coordinates.length > 1;\n};\n\nLineString.prototype.addCoordinate = function(path, lng, lat) {\n  this.changed();\n  const id = parseInt(path, 10);\n  this.coordinates.splice(id, 0, [lng, lat]);\n};\n\nLineString.prototype.getCoordinate = function(path) {\n  const id = parseInt(path, 10);\n  return JSON.parse(JSON.stringify(this.coordinates[id]));\n};\n\nLineString.prototype.removeCoordinate = function(path) {\n  this.changed();\n  this.coordinates.splice(parseInt(path, 10), 1);\n};\n\nLineString.prototype.updateCoordinate = function(path, lng, lat) {\n  const id = parseInt(path, 10);\n  this.coordinates[id] = [lng, lat];\n  this.changed();\n};\n\nexport default LineString;\n","import Feature from './feature.js';\n\nconst Polygon = function(ctx, geojson) {\n  Feature.call(this, ctx, geojson);\n  this.coordinates = this.coordinates.map(ring => ring.slice(0, -1));\n};\n\nPolygon.prototype = Object.create(Feature.prototype);\n\nPolygon.prototype.isValid = function() {\n  if (this.coordinates.length === 0) return false;\n  return this.coordinates.every(ring => ring.length > 2);\n};\n\n// Expects valid geoJSON polygon geometry: first and last positions must be equivalent.\nPolygon.prototype.incomingCoords = function(coords) {\n  this.coordinates = coords.map(ring => ring.slice(0, -1));\n  this.changed();\n};\n\n// Does NOT expect valid geoJSON polygon geometry: first and last positions should not be equivalent.\nPolygon.prototype.setCoordinates = function(coords) {\n  this.coordinates = coords;\n  this.changed();\n};\n\nPolygon.prototype.addCoordinate = function(path, lng, lat) {\n  this.changed();\n  const ids = path.split('.').map(x => parseInt(x, 10));\n\n  const ring = this.coordinates[ids[0]];\n\n  ring.splice(ids[1], 0, [lng, lat]);\n};\n\nPolygon.prototype.removeCoordinate = function(path) {\n  this.changed();\n  const ids = path.split('.').map(x => parseInt(x, 10));\n  const ring = this.coordinates[ids[0]];\n  if (ring) {\n    ring.splice(ids[1], 1);\n    if (ring.length < 3) {\n      this.coordinates.splice(ids[0], 1);\n    }\n  }\n};\n\nPolygon.prototype.getCoordinate = function(path) {\n  const ids = path.split('.').map(x => parseInt(x, 10));\n  const ring = this.coordinates[ids[0]];\n  return JSON.parse(JSON.stringify(ring[ids[1]]));\n};\n\nPolygon.prototype.getCoordinates = function() {\n  return this.coordinates.map(coords => coords.concat([coords[0]]));\n};\n\nPolygon.prototype.updateCoordinate = function(path, lng, lat) {\n  this.changed();\n  const parts = path.split('.');\n  const ringId = parseInt(parts[0], 10);\n  const coordId = parseInt(parts[1], 10);\n\n  if (this.coordinates[ringId] === undefined) {\n    this.coordinates[ringId] = [];\n  }\n\n  this.coordinates[ringId][coordId] = [lng, lat];\n};\n\nexport default Polygon;\n","import {generateID} from '../lib/id.js';\nimport Feature from './feature.js';\nimport * as Constants from '../constants.js';\n\nimport MultiPoint from './point.js';\nimport MultiLineString from './line_string.js';\nimport MultiPolygon from './polygon.js';\n\nconst models = {\n  MultiPoint,\n  MultiLineString,\n  MultiPolygon\n};\n\nconst takeAction = (features, action, path, lng, lat) => {\n  const parts = path.split('.');\n  const idx = parseInt(parts[0], 10);\n  const tail = (!parts[1]) ? null : parts.slice(1).join('.');\n  return features[idx][action](tail, lng, lat);\n};\n\nconst MultiFeature = function(ctx, geojson) {\n  Feature.call(this, ctx, geojson);\n\n  delete this.coordinates;\n  this.model = models[geojson.geometry.type];\n  if (this.model === undefined) throw new TypeError(`${geojson.geometry.type} is not a valid type`);\n  this.features = this._coordinatesToFeatures(geojson.geometry.coordinates);\n};\n\nMultiFeature.prototype = Object.create(Feature.prototype);\n\nMultiFeature.prototype._coordinatesToFeatures = function(coordinates) {\n  const Model = this.model.bind(this);\n  return coordinates.map(coords => new Model(this.ctx, {\n    id: generateID(),\n    type: Constants.geojsonTypes.FEATURE,\n    properties: {},\n    geometry: {\n      coordinates: coords,\n      type: this.type.replace('Multi', '')\n    }\n  }));\n};\n\nMultiFeature.prototype.isValid = function() {\n  return this.features.every(f => f.isValid());\n};\n\nMultiFeature.prototype.setCoordinates = function(coords) {\n  this.features = this._coordinatesToFeatures(coords);\n  this.changed();\n};\n\nMultiFeature.prototype.getCoordinate = function(path) {\n  return takeAction(this.features, 'getCoordinate', path);\n};\n\nMultiFeature.prototype.getCoordinates = function() {\n  return JSON.parse(JSON.stringify(this.features.map((f) => {\n    if (f.type === Constants.geojsonTypes.POLYGON) return f.getCoordinates();\n    return f.coordinates;\n  })));\n};\n\nMultiFeature.prototype.updateCoordinate = function(path, lng, lat) {\n  takeAction(this.features, 'updateCoordinate', path, lng, lat);\n  this.changed();\n};\n\nMultiFeature.prototype.addCoordinate = function(path, lng, lat) {\n  takeAction(this.features, 'addCoordinate', path, lng, lat);\n  this.changed();\n};\n\nMultiFeature.prototype.removeCoordinate = function(path) {\n  takeAction(this.features, 'removeCoordinate', path);\n  this.changed();\n};\n\nMultiFeature.prototype.getFeatures = function() {\n  return this.features;\n};\n\nexport default MultiFeature;\n","import * as Constants from '../constants.js';\nimport featuresAt from '../lib/features_at.js';\nimport Point from '../feature_types/point.js';\nimport LineString from '../feature_types/line_string.js';\nimport Polygon from '../feature_types/polygon.js';\nimport MultiFeature from '../feature_types/multi_feature.js';\n\nexport default function ModeInterface(ctx) {\n  this.map = ctx.map;\n  this.drawConfig = JSON.parse(JSON.stringify(ctx.options || {}));\n  this._ctx = ctx;\n}\n\n/**\n * Sets Draw's interal selected state\n * @name this.setSelected\n * @param {DrawFeature[]} - whats selected as a [DrawFeature](https://github.com/mapbox/mapbox-gl-draw/blob/main/src/feature_types/feature.js)\n */\nModeInterface.prototype.setSelected = function(features) {\n  return this._ctx.store.setSelected(features);\n};\n\n/**\n * Sets Draw's internal selected coordinate state\n * @name this.setSelectedCoordinates\n * @param {Object[]} coords - a array of {coord_path: 'string', feature_id: 'string'}\n */\nModeInterface.prototype.setSelectedCoordinates = function(coords) {\n  this._ctx.store.setSelectedCoordinates(coords);\n  coords.reduce((m, c) => {\n    if (m[c.feature_id] === undefined) {\n      m[c.feature_id] = true;\n      this._ctx.store.get(c.feature_id).changed();\n    }\n    return m;\n  }, {});\n};\n\n/**\n * Get all selected features as a [DrawFeature](https://github.com/mapbox/mapbox-gl-draw/blob/main/src/feature_types/feature.js)\n * @name this.getSelected\n * @returns {DrawFeature[]}\n */\nModeInterface.prototype.getSelected = function() {\n  return this._ctx.store.getSelected();\n};\n\n/**\n * Get the ids of all currently selected features\n * @name this.getSelectedIds\n * @returns {String[]}\n */\nModeInterface.prototype.getSelectedIds = function() {\n  return this._ctx.store.getSelectedIds();\n};\n\n/**\n * Check if a feature is selected\n * @name this.isSelected\n * @param {String} id - a feature id\n * @returns {Boolean}\n */\nModeInterface.prototype.isSelected = function(id) {\n  return this._ctx.store.isSelected(id);\n};\n\n/**\n * Get a [DrawFeature](https://github.com/mapbox/mapbox-gl-draw/blob/main/src/feature_types/feature.js) by its id\n * @name this.getFeature\n * @param {String} id - a feature id\n * @returns {DrawFeature}\n */\nModeInterface.prototype.getFeature = function(id) {\n  return this._ctx.store.get(id);\n};\n\n/**\n * Add a feature to draw's internal selected state\n * @name this.select\n * @param {String} id\n */\nModeInterface.prototype.select = function(id) {\n  return this._ctx.store.select(id);\n};\n\n/**\n * Remove a feature from draw's internal selected state\n * @name this.delete\n * @param {String} id\n */\nModeInterface.prototype.deselect = function(id) {\n  return this._ctx.store.deselect(id);\n};\n\n/**\n * Delete a feature from draw\n * @name this.deleteFeature\n * @param {String} id - a feature id\n */\nModeInterface.prototype.deleteFeature = function(id, opts = {}) {\n  return this._ctx.store.delete(id, opts);\n};\n\n/**\n * Add a [DrawFeature](https://github.com/mapbox/mapbox-gl-draw/blob/main/src/feature_types/feature.js) to draw.\n * See `this.newFeature` for converting geojson into a DrawFeature\n * @name this.addFeature\n * @param {DrawFeature} feature - the feature to add\n */\nModeInterface.prototype.addFeature = function(feature, opts = {}) {\n  return this._ctx.store.add(feature, opts);\n};\n\n/**\n * Clear all selected features\n */\nModeInterface.prototype.clearSelectedFeatures = function() {\n  return this._ctx.store.clearSelected();\n};\n\n/**\n * Clear all selected coordinates\n */\nModeInterface.prototype.clearSelectedCoordinates = function() {\n  return this._ctx.store.clearSelectedCoordinates();\n};\n\n/**\n * Indicate if the different action are currently possible with your mode\n * See [draw.actionalbe](https://github.com/mapbox/mapbox-gl-draw/blob/main/API.md#drawactionable) for a list of possible actions. All undefined actions are set to **false** by default\n * @name this.setActionableState\n * @param {Object} actions\n */\nModeInterface.prototype.setActionableState = function(actions = {}) {\n  const newSet = {\n    trash: actions.trash || false,\n    combineFeatures: actions.combineFeatures || false,\n    uncombineFeatures: actions.uncombineFeatures || false\n  };\n  return this._ctx.events.actionable(newSet);\n};\n\n/**\n * Trigger a mode change\n * @name this.changeMode\n * @param {String} mode - the mode to transition into\n * @param {Object} opts - the options object to pass to the new mode\n * @param {Object} eventOpts - used to control what kind of events are emitted.\n */\nModeInterface.prototype.changeMode = function(mode, opts = {}, eventOpts = {}) {\n  return this._ctx.events.changeMode(mode, opts, eventOpts);\n};\n\n/**\n * Fire a map event\n * @name this.fire\n * @param {String} eventName - the event name.\n * @param {Object} eventData - the event data object.\n */\nModeInterface.prototype.fire = function(eventName, eventData) {\n  return this._ctx.events.fire(eventName, eventData);\n};\n\n/**\n * Update the state of draw map classes\n * @name this.updateUIClasses\n * @param {Object} opts\n */\nModeInterface.prototype.updateUIClasses = function(opts) {\n  return this._ctx.ui.queueMapClasses(opts);\n};\n\n/**\n * If a name is provided it makes that button active, else if makes all buttons inactive\n * @name this.activateUIButton\n * @param {String?} name - name of the button to make active, leave as undefined to set buttons to be inactive\n */\nModeInterface.prototype.activateUIButton = function(name) {\n  return this._ctx.ui.setActiveButton(name);\n};\n\n/**\n * Get the features at the location of an event object or in a bbox\n * @name this.featuresAt\n * @param {Event||NULL} event - a mapbox-gl event object\n * @param {BBOX||NULL} bbox - the area to get features from\n * @param {String} bufferType - is this `click` or `tap` event, defaults to click\n */\nModeInterface.prototype.featuresAt = function(event, bbox, bufferType = 'click') {\n  if (bufferType !== 'click' && bufferType !== 'touch') throw new Error('invalid buffer type');\n  return featuresAt[bufferType](event, bbox, this._ctx);\n};\n\n/**\n * Create a new [DrawFeature](https://github.com/mapbox/mapbox-gl-draw/blob/main/src/feature_types/feature.js) from geojson\n * @name this.newFeature\n * @param {GeoJSONFeature} geojson\n * @returns {DrawFeature}\n */\nModeInterface.prototype.newFeature = function(geojson) {\n  const type = geojson.geometry.type;\n  if (type === Constants.geojsonTypes.POINT) return new Point(this._ctx, geojson);\n  if (type === Constants.geojsonTypes.LINE_STRING) return new LineString(this._ctx, geojson);\n  if (type === Constants.geojsonTypes.POLYGON) return new Polygon(this._ctx, geojson);\n  return new MultiFeature(this._ctx, geojson);\n};\n\n/**\n * Check is an object is an instance of a [DrawFeature](https://github.com/mapbox/mapbox-gl-draw/blob/main/src/feature_types/feature.js)\n * @name this.isInstanceOf\n * @param {String} type - `Point`, `LineString`, `Polygon`, `MultiFeature`\n * @param {Object} feature - the object that needs to be checked\n * @returns {Boolean}\n */\nModeInterface.prototype.isInstanceOf = function(type, feature) {\n  if (type === Constants.geojsonTypes.POINT) return feature instanceof Point;\n  if (type === Constants.geojsonTypes.LINE_STRING) return feature instanceof LineString;\n  if (type === Constants.geojsonTypes.POLYGON) return feature instanceof Polygon;\n  if (type === 'MultiFeature') return feature instanceof MultiFeature;\n  throw new Error(`Unknown feature class: ${type}`);\n};\n\n/**\n * Force draw to rerender the feature of the provided id\n * @name this.doRender\n * @param {String} id - a feature id\n */\nModeInterface.prototype.doRender = function(id) {\n  return this._ctx.store.featureChanged(id);\n};\n\n","import ModeInterface from './mode_interface_accessors.js';\nexport default ModeInterface;\n\n/**\n * Triggered while a mode is being transitioned into.\n * @param opts {Object} - this is the object passed via `draw.changeMode('mode', opts)`;\n * @name MODE.onSetup\n * @returns {Object} - this object will be passed to all other life cycle functions\n */\nModeInterface.prototype.onSetup = function() {};\n\n/**\n * Triggered when a drag event is detected on the map\n * @name MODE.onDrag\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onDrag = function() {};\n\n/**\n * Triggered when the mouse is clicked\n * @name MODE.onClick\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onClick = function() {};\n\n/**\n * Triggered with the mouse is moved\n * @name MODE.onMouseMove\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onMouseMove = function() {};\n\n/**\n * Triggered when the mouse button is pressed down\n * @name MODE.onMouseDown\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onMouseDown = function() {};\n\n/**\n * Triggered when the mouse button is released\n * @name MODE.onMouseUp\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onMouseUp = function() {};\n\n/**\n * Triggered when the mouse leaves the map's container\n * @name MODE.onMouseOut\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onMouseOut = function() {};\n\n/**\n * Triggered when a key up event is detected\n * @name MODE.onKeyUp\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onKeyUp = function() {};\n\n/**\n * Triggered when a key down event is detected\n * @name MODE.onKeyDown\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onKeyDown = function() {};\n\n/**\n * Triggered when a touch event is started\n * @name MODE.onTouchStart\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onTouchStart = function() {};\n\n/**\n * Triggered when one drags thier finger on a mobile device\n * @name MODE.onTouchMove\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onTouchMove = function() {};\n\n/**\n * Triggered when one removes their finger from the map\n * @name MODE.onTouchEnd\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onTouchEnd = function() {};\n\n/**\n * Triggered when one quicly taps the map\n * @name MODE.onTap\n * @param state {Object} - a mutible state object created by onSetup\n * @param e {Object} - the captured event that is triggering this life cycle event\n */\nModeInterface.prototype.onTap = function() {};\n\n/**\n * Triggered when the mode is being exited, to be used for cleaning up artifacts such as invalid features\n * @name MODE.onStop\n * @param state {Object} - a mutible state object created by onSetup\n */\nModeInterface.prototype.onStop = function() {};\n\n/**\n * Triggered when [draw.trash()](https://github.com/mapbox/mapbox-gl-draw/blob/main/API.md#trash-draw) is called.\n * @name MODE.onTrash\n * @param state {Object} - a mutible state object created by onSetup\n */\nModeInterface.prototype.onTrash = function() {};\n\n/**\n * Triggered when [draw.combineFeatures()](https://github.com/mapbox/mapbox-gl-draw/blob/main/API.md#combinefeatures-draw) is called.\n * @name MODE.onCombineFeature\n * @param state {Object} - a mutible state object created by onSetup\n */\nModeInterface.prototype.onCombineFeature = function() {};\n\n/**\n * Triggered when [draw.uncombineFeatures()](https://github.com/mapbox/mapbox-gl-draw/blob/main/API.md#uncombinefeatures-draw) is called.\n * @name MODE.onUncombineFeature\n * @param state {Object} - a mutible state object created by onSetup\n */\nModeInterface.prototype.onUncombineFeature = function() {};\n\n/**\n * Triggered per feature on render to convert raw features into set of features for display on the map\n * See [styling draw](https://github.com/mapbox/mapbox-gl-draw/blob/main/API.md#styling-draw) for information about what geojson properties Draw uses as part of rendering.\n * @name MODE.toDisplayFeatures\n * @param state {Object} - a mutible state object created by onSetup\n * @param geojson {Object} - a geojson being evaulated. To render, pass to `display`.\n * @param display {Function} - all geojson objects passed to this be rendered onto the map\n */\nModeInterface.prototype.toDisplayFeatures = function() {\n  throw new Error('You must overwrite toDisplayFeatures');\n};\n\n","import ModeInterface from './mode_interface.js';\n\nconst eventMapper = {\n  drag: 'onDrag',\n  click: 'onClick',\n  mousemove: 'onMouseMove',\n  mousedown: 'onMouseDown',\n  mouseup: 'onMouseUp',\n  mouseout: 'onMouseOut',\n  keyup: 'onKeyUp',\n  keydown: 'onKeyDown',\n  touchstart: 'onTouchStart',\n  touchmove: 'onTouchMove',\n  touchend: 'onTouchEnd',\n  tap: 'onTap'\n};\n\nconst eventKeys = Object.keys(eventMapper);\n\nexport default function(modeObject) {\n  const modeObjectKeys = Object.keys(modeObject);\n\n  return function(ctx, startOpts = {}) {\n    let state = {};\n\n    const mode = modeObjectKeys.reduce((m, k) => {\n      m[k] = modeObject[k];\n      return m;\n    }, new ModeInterface(ctx));\n\n    function wrapper(eh) {\n      return e => mode[eh](state, e);\n    }\n\n    return {\n      start() {\n        state = mode.onSetup(startOpts); // this should set ui buttons\n\n        // Adds event handlers for all event options\n        // add sets the selector to false for all\n        // handlers that are not present in the mode\n        // to reduce on render calls for functions that\n        // have no logic\n        eventKeys.forEach((key) => {\n          const modeHandler = eventMapper[key];\n          let selector = () => false;\n          if (modeObject[modeHandler]) {\n            selector = () => true;\n          }\n          this.on(key, selector, wrapper(modeHandler));\n        });\n\n      },\n      stop() {\n        mode.onStop(state);\n      },\n      trash() {\n        mode.onTrash(state);\n      },\n      combineFeatures() {\n        mode.onCombineFeatures(state);\n      },\n      uncombineFeatures() {\n        mode.onUncombineFeatures(state);\n      },\n      render(geojson, push) {\n        mode.toDisplayFeatures(state, geojson, push);\n      }\n    };\n  };\n}\n","import * as Constants from './constants.js';\nimport * as CommonSelectors from './lib/common_selectors.js';\nimport featuresAt from './lib/features_at.js';\nimport getFeaturesAndSetCursor from './lib/get_features_and_set_cursor.js';\nimport isClick from './lib/is_click.js';\nimport isTap from './lib/is_tap.js';\nimport setupModeHandler from './lib/mode_handler.js';\nimport objectToMode from './modes/object_to_mode.js';\n\nexport default function(ctx) {\n\n  const modes = Object.keys(ctx.options.modes).reduce((m, k) => {\n    m[k] = objectToMode(ctx.options.modes[k]);\n    return m;\n  }, {});\n\n  let mouseDownInfo = {};\n  let touchStartInfo = {};\n  const events = {};\n  let currentModeName = null;\n  let currentMode = null;\n\n  events.drag = function(event, isDrag) {\n    if (isDrag({\n      point: event.point,\n      time: new Date().getTime()\n    })) {\n      ctx.ui.queueMapClasses({ mouse: Constants.cursors.DRAG });\n      currentMode.drag(event);\n    } else {\n      event.originalEvent.stopPropagation();\n    }\n  };\n\n  events.mousedrag = function(event) {\n    events.drag(event, endInfo => !isClick(mouseDownInfo, endInfo));\n  };\n\n  events.touchdrag = function(event) {\n    events.drag(event, endInfo => !isTap(touchStartInfo, endInfo));\n  };\n\n  events.mousemove = function(event) {\n    const button = event.originalEvent.buttons !== undefined ? event.originalEvent.buttons : event.originalEvent.which;\n    if (button === 1) {\n      return events.mousedrag(event);\n    }\n    const target = getFeaturesAndSetCursor(event, ctx);\n    event.featureTarget = target;\n    currentMode.mousemove(event);\n  };\n\n  events.mousedown = function(event) {\n    mouseDownInfo = {\n      time: new Date().getTime(),\n      point: event.point\n    };\n    const target = getFeaturesAndSetCursor(event, ctx);\n    event.featureTarget = target;\n    currentMode.mousedown(event);\n  };\n\n  events.mouseup = function(event) {\n    const target = getFeaturesAndSetCursor(event, ctx);\n    event.featureTarget = target;\n\n    if (isClick(mouseDownInfo, {\n      point: event.point,\n      time: new Date().getTime()\n    })) {\n      currentMode.click(event);\n    } else {\n      currentMode.mouseup(event);\n    }\n  };\n\n  events.mouseout = function(event) {\n    currentMode.mouseout(event);\n  };\n\n  events.touchstart = function(event) {\n    if (!ctx.options.touchEnabled) {\n      return;\n    }\n\n    touchStartInfo = {\n      time: new Date().getTime(),\n      point: event.point\n    };\n    const target = featuresAt.touch(event, null, ctx)[0];\n    event.featureTarget = target;\n    currentMode.touchstart(event);\n  };\n\n  events.touchmove = function(event) {\n    if (!ctx.options.touchEnabled) {\n      return;\n    }\n\n    currentMode.touchmove(event);\n    return events.touchdrag(event);\n  };\n\n  events.touchend = function(event) {\n    // Prevent emulated mouse events because we will fully handle the touch here.\n    // This does not stop the touch events from propogating to mapbox though.\n    event.originalEvent.preventDefault();\n    if (!ctx.options.touchEnabled) {\n      return;\n    }\n\n    const target = featuresAt.touch(event, null, ctx)[0];\n    event.featureTarget = target;\n    if (isTap(touchStartInfo, {\n      time: new Date().getTime(),\n      point: event.point\n    })) {\n      currentMode.tap(event);\n    } else {\n      currentMode.touchend(event);\n    }\n  };\n\n  const isKeyModeValid = (event) => {\n    const isBackspaceKey = CommonSelectors.isBackspaceKey(event);\n    const isDeleteKey = CommonSelectors.isDeleteKey(event);\n    const isDigitKey = CommonSelectors.isDigitKey(event);\n    return !(isBackspaceKey || isDeleteKey || isDigitKey);\n  };\n\n  events.keydown = function(event) {\n    const isMapElement = (event.srcElement || event.target).classList.contains(Constants.classes.CANVAS);\n    if (!isMapElement) return; // we only handle events on the map\n\n    if ((CommonSelectors.isBackspaceKey(event) || CommonSelectors.isDeleteKey(event)) && ctx.options.controls.trash) {\n      event.preventDefault();\n      currentMode.trash();\n    } else if (isKeyModeValid(event)) {\n      currentMode.keydown(event);\n    } else if (CommonSelectors.isDigit1Key(event) && ctx.options.controls.point) {\n      changeMode(Constants.modes.DRAW_POINT);\n    } else if (CommonSelectors.isDigit2Key(event) && ctx.options.controls.line_string) {\n      changeMode(Constants.modes.DRAW_LINE_STRING);\n    } else if (CommonSelectors.isDigit3Key(event) && ctx.options.controls.polygon) {\n      changeMode(Constants.modes.DRAW_POLYGON);\n    }\n  };\n\n  events.keyup = function(event) {\n    if (isKeyModeValid(event)) {\n      currentMode.keyup(event);\n    }\n  };\n\n  events.zoomend = function() {\n    ctx.store.changeZoom();\n  };\n\n  events.data = function(event) {\n    if (event.dataType === 'style') {\n      const { setup, map, options, store } = ctx;\n      const hasLayers = options.styles.some(style => map.getLayer(style.id));\n      if (!hasLayers) {\n        setup.addLayers();\n        store.setDirty();\n        store.render();\n      }\n    }\n  };\n\n  function changeMode(modename, nextModeOptions, eventOptions = {}) {\n    currentMode.stop();\n\n    const modebuilder = modes[modename];\n    if (modebuilder === undefined) {\n      throw new Error(`${modename} is not valid`);\n    }\n    currentModeName = modename;\n    const mode = modebuilder(ctx, nextModeOptions);\n    currentMode = setupModeHandler(mode, ctx);\n\n    if (!eventOptions.silent) {\n      ctx.map.fire(Constants.events.MODE_CHANGE, { mode: modename});\n    }\n\n    ctx.store.setDirty();\n    ctx.store.render();\n  }\n\n  const actionState = {\n    trash: false,\n    combineFeatures: false,\n    uncombineFeatures: false\n  };\n\n  function actionable(actions) {\n    let changed = false;\n    Object.keys(actions).forEach((action) => {\n      if (actionState[action] === undefined) throw new Error('Invalid action type');\n      if (actionState[action] !== actions[action]) changed = true;\n      actionState[action] = actions[action];\n    });\n    if (changed) ctx.map.fire(Constants.events.ACTIONABLE, { actions: actionState });\n  }\n\n  const api = {\n    start() {\n      currentModeName = ctx.options.defaultMode;\n      currentMode = setupModeHandler(modes[currentModeName](ctx), ctx);\n    },\n    changeMode,\n    actionable,\n    currentModeName() {\n      return currentModeName;\n    },\n    currentModeRender(geojson, push) {\n      return currentMode.render(geojson, push);\n    },\n    fire(eventName, eventData) {\n      if (!ctx.map) return;\n      ctx.map.fire(eventName, eventData);\n    },\n    addEventListeners() {\n      ctx.map.on('mousemove', events.mousemove);\n      ctx.map.on('mousedown', events.mousedown);\n      ctx.map.on('mouseup', events.mouseup);\n      ctx.map.on('data', events.data);\n\n      ctx.map.on('touchmove', events.touchmove);\n      ctx.map.on('touchstart', events.touchstart);\n      ctx.map.on('touchend', events.touchend);\n\n      ctx.container.addEventListener('mouseout', events.mouseout);\n\n      if (ctx.options.keybindings) {\n        ctx.container.addEventListener('keydown', events.keydown);\n        ctx.container.addEventListener('keyup', events.keyup);\n      }\n    },\n    removeEventListeners() {\n      ctx.map.off('mousemove', events.mousemove);\n      ctx.map.off('mousedown', events.mousedown);\n      ctx.map.off('mouseup', events.mouseup);\n      ctx.map.off('data', events.data);\n\n      ctx.map.off('touchmove', events.touchmove);\n      ctx.map.off('touchstart', events.touchstart);\n      ctx.map.off('touchend', events.touchend);\n\n      ctx.container.removeEventListener('mouseout', events.mouseout);\n\n      if (ctx.options.keybindings) {\n        ctx.container.removeEventListener('keydown', events.keydown);\n        ctx.container.removeEventListener('keyup', events.keyup);\n      }\n    },\n    trash(options) {\n      currentMode.trash(options);\n    },\n    combineFeatures() {\n      currentMode.combineFeatures();\n    },\n    uncombineFeatures() {\n      currentMode.uncombineFeatures();\n    },\n    getMode() {\n      return currentModeName;\n    }\n  };\n\n  return api;\n}\n","/**\n * Derive a dense array (no `undefined`s) from a single value or array.\n *\n * @param {any} x\n * @return {Array<any>}\n */\nfunction toDenseArray(x) {\n  return [].concat(x).filter(y => y !== undefined);\n}\n\nexport default toDenseArray;\n","import * as Constants from './constants.js';\n\nexport default function render() {\n  // eslint-disable-next-line no-invalid-this\n  const store = this;\n  const mapExists = store.ctx.map && store.ctx.map.getSource(Constants.sources.HOT) !== undefined;\n  if (!mapExists) return cleanup();\n\n  const mode = store.ctx.events.currentModeName();\n\n  store.ctx.ui.queueMapClasses({ mode });\n\n  let newHotIds = [];\n  let newColdIds = [];\n\n  if (store.isDirty) {\n    newColdIds = store.getAllIds();\n  } else {\n    newHotIds = store.getChangedIds().filter(id => store.get(id) !== undefined);\n    newColdIds = store.sources.hot.filter(geojson => geojson.properties.id && newHotIds.indexOf(geojson.properties.id) === -1 && store.get(geojson.properties.id) !== undefined).map(geojson => geojson.properties.id);\n  }\n\n  store.sources.hot = [];\n  const lastColdCount = store.sources.cold.length;\n  store.sources.cold = store.isDirty ? [] : store.sources.cold.filter((geojson) => {\n    const id = geojson.properties.id || geojson.properties.parent;\n    return newHotIds.indexOf(id) === -1;\n  });\n\n  const coldChanged = lastColdCount !== store.sources.cold.length || newColdIds.length > 0;\n  newHotIds.forEach(id => renderFeature(id, 'hot'));\n  newColdIds.forEach(id => renderFeature(id, 'cold'));\n\n  function renderFeature(id, source) {\n    const feature = store.get(id);\n    const featureInternal = feature.internal(mode);\n    store.ctx.events.currentModeRender(featureInternal, (geojson) => {\n      geojson.properties.mode = mode;\n      store.sources[source].push(geojson);\n    });\n  }\n\n  if (coldChanged) {\n    store.ctx.map.getSource(Constants.sources.COLD).setData({\n      type: Constants.geojsonTypes.FEATURE_COLLECTION,\n      features: store.sources.cold\n    });\n  }\n\n  store.ctx.map.getSource(Constants.sources.HOT).setData({\n    type: Constants.geojsonTypes.FEATURE_COLLECTION,\n    features: store.sources.hot\n  });\n\n  cleanup();\n\n  function cleanup() {\n    store.isDirty = false;\n    store.clearChangedIds();\n  }\n}\n","import toDenseArray from './lib/to_dense_array.js';\nimport StringSet from './lib/string_set.js';\nimport render from './render.js';\nimport * as Constants from './constants.js';\n\nexport default function Store(ctx) {\n  this._features = {};\n  this._featureIds = new StringSet();\n  this._selectedFeatureIds = new StringSet();\n  this._selectedCoordinates = [];\n  this._changedFeatureIds = new StringSet();\n  this._emitSelectionChange = false;\n  this._mapInitialConfig = {};\n  this.ctx = ctx;\n  this.sources = {\n    hot: [],\n    cold: []\n  };\n\n  // Deduplicate requests to render and tie them to animation frames.\n  let renderRequest;\n  this.render = () => {\n    if (!renderRequest) {\n      renderRequest = requestAnimationFrame(() => {\n        renderRequest = null;\n        render.call(this);\n\n        // Fire deduplicated selection change event\n        if (this._emitSelectionChange) {\n          this.ctx.events.fire(Constants.events.SELECTION_CHANGE, {\n            features: this.getSelected().map(feature => feature.toGeoJSON()),\n            points: this.getSelectedCoordinates().map(coordinate => ({\n              type: Constants.geojsonTypes.FEATURE,\n              properties: {},\n              geometry: {\n                type: Constants.geojsonTypes.POINT,\n                coordinates: coordinate.coordinates\n              }\n            }))\n          });\n\n          this._emitSelectionChange = false;\n        }\n\n        // Fire render event\n        this.ctx.events.fire(Constants.events.RENDER, {});\n      });\n    }\n  };\n\n  this.isDirty = false;\n}\n\n/**\n * Delays all rendering until the returned function is invoked\n * @return {Function} renderBatch\n */\nStore.prototype.createRenderBatch = function() {\n  const holdRender = this.render;\n  let numRenders = 0;\n  this.render = function() {\n    numRenders++;\n  };\n\n  return () => {\n    this.render = holdRender;\n    if (numRenders > 0) {\n      this.render();\n    }\n  };\n};\n\n/**\n * Sets the store's state to dirty.\n * @return {Store} this\n */\nStore.prototype.setDirty = function() {\n  this.isDirty = true;\n  return this;\n};\n\n/**\n * Sets a feature's state to changed.\n * @param {string} featureId\n * @return {Store} this\n */\nStore.prototype.featureCreated = function(featureId, options = {}) {\n  this._changedFeatureIds.add(featureId);\n\n  const silent = options.silent != null ? options.silent : this.ctx.options.suppressAPIEvents;\n  if (silent !== true) {\n    const feature = this.get(featureId);\n    this.ctx.events.fire(Constants.events.CREATE, {\n      features: [feature.toGeoJSON()]\n    });\n  }\n\n  return this;\n};\n\n/**\n * Sets a feature's state to changed.\n * @param {string} featureId\n * @return {Store} this\n */\nStore.prototype.featureChanged = function(featureId, options = {}) {\n  this._changedFeatureIds.add(featureId);\n\n  const silent = options.silent != null ? options.silent : this.ctx.options.suppressAPIEvents;\n  if (silent !== true) {\n    this.ctx.events.fire(Constants.events.UPDATE, {\n      action: options.action ? options.action : Constants.updateActions.CHANGE_COORDINATES,\n      features: [this.get(featureId).toGeoJSON()]\n    });\n  }\n\n  return this;\n};\n\n/**\n * Gets the ids of all features currently in changed state.\n * @return {Store} this\n */\nStore.prototype.getChangedIds = function() {\n  return this._changedFeatureIds.values();\n};\n\n/**\n * Sets all features to unchanged state.\n * @return {Store} this\n */\nStore.prototype.clearChangedIds = function() {\n  this._changedFeatureIds.clear();\n  return this;\n};\n\n/**\n * Gets the ids of all features in the store.\n * @return {Store} this\n */\nStore.prototype.getAllIds = function() {\n  return this._featureIds.values();\n};\n\n/**\n * Adds a feature to the store.\n * @param {Object} feature\n * @param {Object} [options]\n * @param {Object} [options.silent] - If `true`, this invocation will not fire an event.\n *\n * @return {Store} this\n */\nStore.prototype.add = function(feature, options = {}) {\n  this._features[feature.id] = feature;\n  this._featureIds.add(feature.id);\n  this.featureCreated(feature.id, {silent: options.silent});\n  return this;\n};\n\n/**\n * Deletes a feature or array of features from the store.\n * Cleans up after the deletion by deselecting the features.\n * If changes were made, sets the state to the dirty\n * and fires an event.\n * @param {string | Array<string>} featureIds\n * @param {Object} [options]\n * @param {Object} [options.silent] - If `true`, this invocation will not fire an event.\n * @return {Store} this\n */\nStore.prototype.delete = function(featureIds, options = {}) {\n  const deletedFeaturesToEmit = [];\n  toDenseArray(featureIds).forEach((id) => {\n    if (!this._featureIds.has(id)) return;\n    this._featureIds.delete(id);\n    this._selectedFeatureIds.delete(id);\n    if (!options.silent) {\n      if (deletedFeaturesToEmit.indexOf(this._features[id]) === -1) {\n        deletedFeaturesToEmit.push(this._features[id].toGeoJSON());\n      }\n    }\n    delete this._features[id];\n    this.isDirty = true;\n  });\n\n  if (deletedFeaturesToEmit.length) {\n    this.ctx.events.fire(Constants.events.DELETE, {features: deletedFeaturesToEmit});\n  }\n\n  refreshSelectedCoordinates(this, options);\n  return this;\n};\n\n/**\n * Returns a feature in the store matching the specified value.\n * @return {Object | undefined} feature\n */\nStore.prototype.get = function(id) {\n  return this._features[id];\n};\n\n/**\n * Returns all features in the store.\n * @return {Array<Object>}\n */\nStore.prototype.getAll = function() {\n  return Object.keys(this._features).map(id => this._features[id]);\n};\n\n/**\n * Adds features to the current selection.\n * @param {string | Array<string>} featureIds\n * @param {Object} [options]\n * @param {Object} [options.silent] - If `true`, this invocation will not fire an event.\n * @return {Store} this\n */\nStore.prototype.select = function(featureIds, options = {}) {\n  toDenseArray(featureIds).forEach((id) => {\n    if (this._selectedFeatureIds.has(id)) return;\n    this._selectedFeatureIds.add(id);\n    this._changedFeatureIds.add(id);\n    if (!options.silent) {\n      this._emitSelectionChange = true;\n    }\n  });\n  return this;\n};\n\n/**\n * Deletes features from the current selection.\n * @param {string | Array<string>} featureIds\n * @param {Object} [options]\n * @param {Object} [options.silent] - If `true`, this invocation will not fire an event.\n * @return {Store} this\n */\nStore.prototype.deselect = function(featureIds, options = {}) {\n  toDenseArray(featureIds).forEach((id) => {\n    if (!this._selectedFeatureIds.has(id)) return;\n    this._selectedFeatureIds.delete(id);\n    this._changedFeatureIds.add(id);\n    if (!options.silent) {\n      this._emitSelectionChange = true;\n    }\n  });\n  refreshSelectedCoordinates(this, options);\n  return this;\n};\n\n/**\n * Clears the current selection.\n * @param {Object} [options]\n * @param {Object} [options.silent] - If `true`, this invocation will not fire an event.\n * @return {Store} this\n */\nStore.prototype.clearSelected = function(options = {}) {\n  this.deselect(this._selectedFeatureIds.values(), { silent: options.silent });\n  return this;\n};\n\n/**\n * Sets the store's selection, clearing any prior values.\n * If no feature ids are passed, the store is just cleared.\n * @param {string | Array<string> | undefined} featureIds\n * @param {Object} [options]\n * @param {Object} [options.silent] - If `true`, this invocation will not fire an event.\n * @return {Store} this\n */\nStore.prototype.setSelected = function(featureIds, options = {}) {\n  featureIds = toDenseArray(featureIds);\n\n  // Deselect any features not in the new selection\n  this.deselect(this._selectedFeatureIds.values().filter(id => featureIds.indexOf(id) === -1), { silent: options.silent });\n\n  // Select any features in the new selection that were not already selected\n  this.select(featureIds.filter(id => !this._selectedFeatureIds.has(id)), { silent: options.silent });\n\n  return this;\n};\n\n/**\n * Sets the store's coordinates selection, clearing any prior values.\n * @param {Array<Array<string>>} coordinates\n * @return {Store} this\n */\nStore.prototype.setSelectedCoordinates = function(coordinates) {\n  this._selectedCoordinates = coordinates;\n  this._emitSelectionChange = true;\n  return this;\n};\n\n/**\n * Clears the current coordinates selection.\n * @param {Object} [options]\n * @return {Store} this\n */\nStore.prototype.clearSelectedCoordinates = function() {\n  this._selectedCoordinates = [];\n  this._emitSelectionChange = true;\n  return this;\n};\n\n/**\n * Returns the ids of features in the current selection.\n * @return {Array<string>} Selected feature ids.\n */\nStore.prototype.getSelectedIds = function() {\n  return this._selectedFeatureIds.values();\n};\n\n/**\n * Returns features in the current selection.\n * @return {Array<Object>} Selected features.\n */\nStore.prototype.getSelected = function() {\n  return this.getSelectedIds().map(id => this.get(id));\n};\n\n/**\n * Returns selected coordinates in the currently selected feature.\n * @return {Array<Object>} Selected coordinates.\n */\nStore.prototype.getSelectedCoordinates = function() {\n  const selected = this._selectedCoordinates.map((coordinate) => {\n    const feature = this.get(coordinate.feature_id);\n    return {\n      coordinates: feature.getCoordinate(coordinate.coord_path)\n    };\n  });\n  return selected;\n};\n\n/**\n * Indicates whether a feature is selected.\n * @param {string} featureId\n * @return {boolean} `true` if the feature is selected, `false` if not.\n */\nStore.prototype.isSelected = function(featureId) {\n  return this._selectedFeatureIds.has(featureId);\n};\n\n/**\n * Sets a property on the given feature\n * @param {string} featureId\n * @param {string} property property\n * @param {string} property value\n * @param {Object} [options]\n * @param {Object} [options.silent] - If `true`, this invocation will not fire an event.\n*/\nStore.prototype.setFeatureProperty = function(featureId, property, value, options = {}) {\n  this.get(featureId).setProperty(property, value);\n\n  this.featureChanged(featureId, {\n    silent: options.silent,\n    action: Constants.updateActions.CHANGE_PROPERTIES\n  });\n};\n\nfunction refreshSelectedCoordinates(store, options = {}) {\n  const newSelectedCoordinates = store._selectedCoordinates.filter(point => store._selectedFeatureIds.has(point.feature_id));\n  if (store._selectedCoordinates.length !== newSelectedCoordinates.length && !options.silent) {\n    store._emitSelectionChange = true;\n  }\n  store._selectedCoordinates = newSelectedCoordinates;\n}\n\n/**\n * Stores the initial config for a map, so that we can set it again after we're done.\n*/\nStore.prototype.storeMapConfig = function() {\n  Constants.interactions.forEach((interaction) => {\n    const interactionSet = this.ctx.map[interaction];\n    if (interactionSet) {\n      this._mapInitialConfig[interaction] = this.ctx.map[interaction].isEnabled();\n    }\n  });\n};\n\n/**\n * Restores the initial config for a map, ensuring all is well.\n*/\nStore.prototype.restoreMapConfig = function() {\n  Object.keys(this._mapInitialConfig).forEach((key) => {\n    const value = this._mapInitialConfig[key];\n    if (value) {\n      this.ctx.map[key].enable();\n    } else {\n      this.ctx.map[key].disable();\n    }\n  });\n};\n\n/**\n * Returns the initial state of an interaction setting.\n * @param {string} interaction\n * @return {boolean} `true` if the interaction is enabled, `false` if not.\n * Defaults to `true`. (Todo: include defaults.)\n*/\nStore.prototype.getInitialConfigValue = function(interaction) {\n  if (this._mapInitialConfig[interaction] !== undefined) {\n    return this._mapInitialConfig[interaction];\n  } else {\n    // This needs to be set to whatever the default is for that interaction\n    // It seems to be true for all cases currently, so let's send back `true`.\n    return true;\n  }\n};\n","import * as Constants from './constants.js';\n\nconst classTypes = ['mode', 'feature', 'mouse'];\n\nexport default function(ctx) {\n\n\n  const buttonElements = {};\n  let activeButton = null;\n\n  let currentMapClasses = {\n    mode: null, // e.g. mode-direct_select\n    feature: null, // e.g. feature-vertex\n    mouse: null // e.g. mouse-move\n  };\n\n  let nextMapClasses = {\n    mode: null,\n    feature: null,\n    mouse: null\n  };\n\n  function clearMapClasses() {\n    queueMapClasses({mode:null, feature:null, mouse:null});\n    updateMapClasses();\n  }\n\n  function queueMapClasses(options) {\n    nextMapClasses = Object.assign(nextMapClasses, options);\n  }\n\n  function updateMapClasses() {\n    if (!ctx.container) return;\n\n    const classesToRemove = [];\n    const classesToAdd = [];\n\n    classTypes.forEach((type) => {\n      if (nextMapClasses[type] === currentMapClasses[type]) return;\n\n      classesToRemove.push(`${type}-${currentMapClasses[type]}`);\n      if (nextMapClasses[type] !== null) {\n        classesToAdd.push(`${type}-${nextMapClasses[type]}`);\n      }\n    });\n\n    if (classesToRemove.length > 0) {\n      ctx.container.classList.remove(...classesToRemove);\n    }\n\n    if (classesToAdd.length > 0) {\n      ctx.container.classList.add(...classesToAdd);\n    }\n\n    currentMapClasses = Object.assign(currentMapClasses, nextMapClasses);\n  }\n\n  function createControlButton(id, options = {}) {\n    const button = document.createElement('button');\n    button.className = `${Constants.classes.CONTROL_BUTTON} ${options.className}`;\n    button.setAttribute('title', options.title);\n    options.container.appendChild(button);\n\n    button.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const clickedButton = e.target;\n      if (clickedButton === activeButton) {\n        deactivateButtons();\n        options.onDeactivate();\n        return;\n      }\n\n      setActiveButton(id);\n      options.onActivate();\n    }, true);\n\n    return button;\n  }\n\n  function deactivateButtons() {\n    if (!activeButton) return;\n    activeButton.classList.remove(Constants.classes.ACTIVE_BUTTON);\n    activeButton = null;\n  }\n\n  function setActiveButton(id) {\n    deactivateButtons();\n\n    const button = buttonElements[id];\n    if (!button) return;\n\n    if (button && id !== 'trash') {\n      button.classList.add(Constants.classes.ACTIVE_BUTTON);\n      activeButton = button;\n    }\n  }\n\n  function addButtons() {\n    const controls = ctx.options.controls;\n    const controlGroup = document.createElement('div');\n    controlGroup.className = `${Constants.classes.CONTROL_GROUP} ${Constants.classes.CONTROL_BASE}`;\n\n    if (!controls) return controlGroup;\n\n    if (controls[Constants.types.POINT]) {\n      buttonElements[Constants.types.POINT] = createControlButton(Constants.types.POINT, {\n        container: controlGroup,\n        className: Constants.classes.CONTROL_BUTTON_POINT,\n        title: `Marker tool ${ctx.options.keybindings ? '(1)' : ''}`,\n        onActivate: () => ctx.events.changeMode(Constants.modes.DRAW_POINT),\n        onDeactivate: () => ctx.events.trash()\n      });\n    }\n\n\n    if (controls[Constants.types.LINE]) {\n      buttonElements[Constants.types.LINE] = createControlButton(Constants.types.LINE, {\n        container: controlGroup,\n        className: Constants.classes.CONTROL_BUTTON_LINE,\n        title: `LineString tool ${ctx.options.keybindings ? '(2)' : ''}`,\n        onActivate: () => ctx.events.changeMode(Constants.modes.DRAW_LINE_STRING),\n        onDeactivate: () => ctx.events.trash()\n      });\n    }\n\n    if (controls[Constants.types.POLYGON]) {\n      buttonElements[Constants.types.POLYGON] = createControlButton(Constants.types.POLYGON, {\n        container: controlGroup,\n        className: Constants.classes.CONTROL_BUTTON_POLYGON,\n        title: `Polygon tool ${ctx.options.keybindings ? '(3)' : ''}`,\n        onActivate: () => ctx.events.changeMode(Constants.modes.DRAW_POLYGON),\n        onDeactivate: () => ctx.events.trash()\n      });\n    }\n\n    if (controls.trash) {\n      buttonElements.trash = createControlButton('trash', {\n        container: controlGroup,\n        className: Constants.classes.CONTROL_BUTTON_TRASH,\n        title: 'Delete',\n        onActivate: () => {\n          ctx.events.trash();\n        }\n      });\n    }\n\n    if (controls.combine_features) {\n      buttonElements.combine_features = createControlButton('combineFeatures', {\n        container: controlGroup,\n        className: Constants.classes.CONTROL_BUTTON_COMBINE_FEATURES,\n        title: 'Combine',\n        onActivate: () => {\n          ctx.events.combineFeatures();\n        }\n      });\n    }\n\n    if (controls.uncombine_features) {\n      buttonElements.uncombine_features = createControlButton('uncombineFeatures', {\n        container: controlGroup,\n        className: Constants.classes.CONTROL_BUTTON_UNCOMBINE_FEATURES,\n        title: 'Uncombine',\n        onActivate: () => {\n          ctx.events.uncombineFeatures();\n        }\n      });\n    }\n\n    return controlGroup;\n  }\n\n  function removeButtons() {\n    Object.keys(buttonElements).forEach((buttonId) => {\n      const button = buttonElements[buttonId];\n      if (button.parentNode) {\n        button.parentNode.removeChild(button);\n      }\n      delete buttonElements[buttonId];\n    });\n  }\n\n  return {\n    setActiveButton,\n    queueMapClasses,\n    updateMapClasses,\n    clearMapClasses,\n    addButtons,\n    removeButtons\n  };\n}\n","import events from './events.js';\nimport Store from './store.js';\nimport ui from './ui.js';\nimport * as Constants from './constants.js';\n\nexport default function(ctx) {\n\n  let controlContainer = null;\n  let mapLoadedInterval = null;\n\n  const setup = {\n    onRemove() {\n      // Stop connect attempt in the event that control is removed before map is loaded\n      ctx.map.off('load', setup.connect);\n      clearInterval(mapLoadedInterval);\n\n      setup.removeLayers();\n      ctx.store.restoreMapConfig();\n      ctx.ui.removeButtons();\n      ctx.events.removeEventListeners();\n      ctx.ui.clearMapClasses();\n      if (ctx.boxZoomInitial) ctx.map.boxZoom.enable();\n      ctx.map = null;\n      ctx.container = null;\n      ctx.store = null;\n\n      if (controlContainer && controlContainer.parentNode) controlContainer.parentNode.removeChild(controlContainer);\n      controlContainer = null;\n\n      return this;\n    },\n    connect() {\n      ctx.map.off('load', setup.connect);\n      clearInterval(mapLoadedInterval);\n      setup.addLayers();\n      ctx.store.storeMapConfig();\n      ctx.events.addEventListeners();\n    },\n    onAdd(map) {\n      ctx.map = map;\n      ctx.events = events(ctx);\n      ctx.ui = ui(ctx);\n      ctx.container = map.getContainer();\n      ctx.store = new Store(ctx);\n\n\n      controlContainer = ctx.ui.addButtons();\n\n      if (ctx.options.boxSelect) {\n        ctx.boxZoomInitial = map.boxZoom.isEnabled();\n        map.boxZoom.disable();\n        const dragPanIsEnabled = map.dragPan.isEnabled();\n        // Need to toggle dragPan on and off or else first\n        // dragPan disable attempt in simple_select doesn't work\n        map.dragPan.disable();\n        map.dragPan.enable();\n        if (!dragPanIsEnabled) {\n          map.dragPan.disable();\n        }\n      }\n\n      if (map.loaded()) {\n        setup.connect();\n      } else {\n        map.on('load', setup.connect);\n        mapLoadedInterval = setInterval(() => { if (map.loaded()) setup.connect(); }, 16);\n      }\n\n      ctx.events.start();\n      return controlContainer;\n    },\n    addLayers() {\n      // drawn features style\n      ctx.map.addSource(Constants.sources.COLD, {\n        data: {\n          type: Constants.geojsonTypes.FEATURE_COLLECTION,\n          features: []\n        },\n        type: 'geojson'\n      });\n\n      // hot features style\n      ctx.map.addSource(Constants.sources.HOT, {\n        data: {\n          type: Constants.geojsonTypes.FEATURE_COLLECTION,\n          features: []\n        },\n        type: 'geojson'\n      });\n\n      ctx.options.styles.forEach((style) => {\n        ctx.map.addLayer(style);\n      });\n\n      ctx.store.setDirty(true);\n      ctx.store.render();\n    },\n    // Check for layers and sources before attempting to remove\n    // If user adds draw control and removes it before the map is loaded, layers and sources will be missing\n    removeLayers() {\n      ctx.options.styles.forEach((style) => {\n        if (ctx.map.getLayer(style.id)) {\n          ctx.map.removeLayer(style.id);\n        }\n      });\n\n      if (ctx.map.getSource(Constants.sources.COLD)) {\n        ctx.map.removeSource(Constants.sources.COLD);\n      }\n\n      if (ctx.map.getSource(Constants.sources.HOT)) {\n        ctx.map.removeSource(Constants.sources.HOT);\n      }\n    }\n  };\n\n  ctx.setup = setup;\n\n  return setup;\n}\n","/* eslint comma-dangle: [\"error\", \"always-multiline\"] */\n\nconst blue = '#3bb2d0';\nconst orange = '#fbb03b';\nconst white = '#fff';\n\nexport default [\n  // Polygons\n  //   Solid fill\n  //   Active state defines color\n  {\n    'id': 'gl-draw-polygon-fill',\n    'type': 'fill',\n    'filter': [\n      'all',\n      ['==', '$type', 'Polygon'],\n    ],\n    'paint': {\n      'fill-color': [\n        'case',\n        ['==', ['get', 'active'], 'true'], orange,\n        blue,\n      ],\n      'fill-opacity': 0.1,\n    },\n  },\n  // Lines\n  // Polygon\n  //   Matches Lines AND Polygons\n  //   Active state defines color\n  {\n    'id': 'gl-draw-lines',\n    'type': 'line',\n    'filter': [\n      'any',\n      ['==', '$type', 'LineString'],\n      ['==', '$type', 'Polygon'],\n    ],\n    'layout': {\n      'line-cap': 'round',\n      'line-join': 'round',\n    },\n    'paint': {\n      'line-color': [\n        'case',\n        ['==', ['get', 'active'], 'true'], orange,\n        blue,\n      ],\n      'line-dasharray': [\n        'case',\n        ['==', ['get', 'active'], 'true'], [0.2, 2],\n        [2, 0],\n      ],\n      'line-width': 2,\n    },\n  },\n  // Points\n  //   Circle with an outline\n  //   Active state defines size and color\n  {\n    'id': 'gl-draw-point-outer',\n    'type': 'circle',\n    'filter': [\n      'all',\n      ['==', '$type', 'Point'],\n      ['==', 'meta', 'feature'],\n    ],\n    'paint': {\n      'circle-radius': [\n        'case',\n        ['==', ['get', 'active'], 'true'], 7,\n        5,\n      ],\n      'circle-color': white,\n    },\n  },\n  {\n    'id': 'gl-draw-point-inner',\n    'type': 'circle',\n    'filter': [\n      'all',\n      ['==', '$type', 'Point'],\n      ['==', 'meta', 'feature'],\n    ],\n    'paint': {\n      'circle-radius': [\n        'case',\n        ['==', ['get', 'active'], 'true'], 5,\n        3,\n      ],\n      'circle-color': [\n        'case',\n        ['==', ['get', 'active'], 'true'], orange,\n        blue,\n      ],\n    },\n  },\n  // Vertex\n  //   Visible when editing polygons and lines\n  //   Similar behaviour to Points\n  //   Active state defines size\n  {\n    'id': 'gl-draw-vertex-outer',\n    'type': 'circle',\n    'filter': [\n      'all',\n      ['==', '$type', 'Point'],\n      ['==', 'meta', 'vertex'],\n      ['!=', 'mode', 'simple_select'],\n    ],\n    'paint': {\n      'circle-radius': [\n        'case',\n        ['==', ['get', 'active'], 'true'], 7,\n        5,\n      ],\n      'circle-color': white,\n    },\n  },\n  {\n    'id': 'gl-draw-vertex-inner',\n    'type': 'circle',\n    'filter': [\n      'all',\n      ['==', '$type', 'Point'],\n      ['==', 'meta', 'vertex'],\n      ['!=', 'mode', 'simple_select'],\n    ],\n    'paint': {\n      'circle-radius': [\n        'case',\n        ['==', ['get', 'active'], 'true'], 5,\n        3,\n      ],\n      'circle-color': orange,\n    },\n  },\n  // Midpoint\n  //   Visible when editing polygons and lines\n  //   Tapping or dragging them adds a new vertex to the feature\n  {\n    'id': 'gl-draw-midpoint',\n    'type': 'circle',\n    'filter': [\n      'all',\n      ['==', 'meta', 'midpoint'],\n    ],\n    'paint': {\n      'circle-radius': 3,\n      'circle-color': orange,\n    },\n  },\n];\n","/**\n * A standalone point geometry with useful accessor, comparison, and\n * modification methods.\n *\n * @class\n * @param {number} x the x-coordinate. This could be longitude or screen pixels, or any other sort of unit.\n * @param {number} y the y-coordinate. This could be latitude or screen pixels, or any other sort of unit.\n *\n * @example\n * const point = new Point(-77, 38);\n */\nexport default function Point(x, y) {\n    this.x = x;\n    this.y = y;\n}\n\nPoint.prototype = {\n    /**\n     * Clone this point, returning a new point that can be modified\n     * without affecting the old one.\n     * @return {Point} the clone\n     */\n    clone() { return new Point(this.x, this.y); },\n\n    /**\n     * Add this point's x & y coordinates to another point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    add(p) { return this.clone()._add(p); },\n\n    /**\n     * Subtract this point's x & y coordinates to from point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    sub(p) { return this.clone()._sub(p); },\n\n    /**\n     * Multiply this point's x & y coordinates by point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    multByPoint(p) { return this.clone()._multByPoint(p); },\n\n    /**\n     * Divide this point's x & y coordinates by point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    divByPoint(p) { return this.clone()._divByPoint(p); },\n\n    /**\n     * Multiply this point's x & y coordinates by a factor,\n     * yielding a new point.\n     * @param {number} k factor\n     * @return {Point} output point\n     */\n    mult(k) { return this.clone()._mult(k); },\n\n    /**\n     * Divide this point's x & y coordinates by a factor,\n     * yielding a new point.\n     * @param {number} k factor\n     * @return {Point} output point\n     */\n    div(k) { return this.clone()._div(k); },\n\n    /**\n     * Rotate this point around the 0, 0 origin by an angle a,\n     * given in radians\n     * @param {number} a angle to rotate around, in radians\n     * @return {Point} output point\n     */\n    rotate(a) { return this.clone()._rotate(a); },\n\n    /**\n     * Rotate this point around p point by an angle a,\n     * given in radians\n     * @param {number} a angle to rotate around, in radians\n     * @param {Point} p Point to rotate around\n     * @return {Point} output point\n     */\n    rotateAround(a, p) { return this.clone()._rotateAround(a, p); },\n\n    /**\n     * Multiply this point by a 4x1 transformation matrix\n     * @param {[number, number, number, number]} m transformation matrix\n     * @return {Point} output point\n     */\n    matMult(m) { return this.clone()._matMult(m); },\n\n    /**\n     * Calculate this point but as a unit vector from 0, 0, meaning\n     * that the distance from the resulting point to the 0, 0\n     * coordinate will be equal to 1 and the angle from the resulting\n     * point to the 0, 0 coordinate will be the same as before.\n     * @return {Point} unit vector point\n     */\n    unit() { return this.clone()._unit(); },\n\n    /**\n     * Compute a perpendicular point, where the new y coordinate\n     * is the old x coordinate and the new x coordinate is the old y\n     * coordinate multiplied by -1\n     * @return {Point} perpendicular point\n     */\n    perp() { return this.clone()._perp(); },\n\n    /**\n     * Return a version of this point with the x & y coordinates\n     * rounded to integers.\n     * @return {Point} rounded point\n     */\n    round() { return this.clone()._round(); },\n\n    /**\n     * Return the magnitude of this point: this is the Euclidean\n     * distance from the 0, 0 coordinate to this point's x and y\n     * coordinates.\n     * @return {number} magnitude\n     */\n    mag() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    },\n\n    /**\n     * Judge whether this point is equal to another point, returning\n     * true or false.\n     * @param {Point} other the other point\n     * @return {boolean} whether the points are equal\n     */\n    equals(other) {\n        return this.x === other.x &&\n               this.y === other.y;\n    },\n\n    /**\n     * Calculate the distance from this point to another point\n     * @param {Point} p the other point\n     * @return {number} distance\n     */\n    dist(p) {\n        return Math.sqrt(this.distSqr(p));\n    },\n\n    /**\n     * Calculate the distance from this point to another point,\n     * without the square root step. Useful if you're comparing\n     * relative distances.\n     * @param {Point} p the other point\n     * @return {number} distance\n     */\n    distSqr(p) {\n        const dx = p.x - this.x,\n            dy = p.y - this.y;\n        return dx * dx + dy * dy;\n    },\n\n    /**\n     * Get the angle from the 0, 0 coordinate to this point, in radians\n     * coordinates.\n     * @return {number} angle\n     */\n    angle() {\n        return Math.atan2(this.y, this.x);\n    },\n\n    /**\n     * Get the angle from this point to another point, in radians\n     * @param {Point} b the other point\n     * @return {number} angle\n     */\n    angleTo(b) {\n        return Math.atan2(this.y - b.y, this.x - b.x);\n    },\n\n    /**\n     * Get the angle between this point and another point, in radians\n     * @param {Point} b the other point\n     * @return {number} angle\n     */\n    angleWith(b) {\n        return this.angleWithSep(b.x, b.y);\n    },\n\n    /**\n     * Find the angle of the two vectors, solving the formula for\n     * the cross product a x b = |a||b|sin() for .\n     * @param {number} x the x-coordinate\n     * @param {number} y the y-coordinate\n     * @return {number} the angle in radians\n     */\n    angleWithSep(x, y) {\n        return Math.atan2(\n            this.x * y - this.y * x,\n            this.x * x + this.y * y);\n    },\n\n    /** @param {[number, number, number, number]} m */\n    _matMult(m) {\n        const x = m[0] * this.x + m[1] * this.y,\n            y = m[2] * this.x + m[3] * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    /** @param {Point} p */\n    _add(p) {\n        this.x += p.x;\n        this.y += p.y;\n        return this;\n    },\n\n    /** @param {Point} p */\n    _sub(p) {\n        this.x -= p.x;\n        this.y -= p.y;\n        return this;\n    },\n\n    /** @param {number} k */\n    _mult(k) {\n        this.x *= k;\n        this.y *= k;\n        return this;\n    },\n\n    /** @param {number} k */\n    _div(k) {\n        this.x /= k;\n        this.y /= k;\n        return this;\n    },\n\n    /** @param {Point} p */\n    _multByPoint(p) {\n        this.x *= p.x;\n        this.y *= p.y;\n        return this;\n    },\n\n    /** @param {Point} p */\n    _divByPoint(p) {\n        this.x /= p.x;\n        this.y /= p.y;\n        return this;\n    },\n\n    _unit() {\n        this._div(this.mag());\n        return this;\n    },\n\n    _perp() {\n        const y = this.y;\n        this.y = this.x;\n        this.x = -y;\n        return this;\n    },\n\n    /** @param {number} angle */\n    _rotate(angle) {\n        const cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = cos * this.x - sin * this.y,\n            y = sin * this.x + cos * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    /**\n     * @param {number} angle\n     * @param {Point} p\n     */\n    _rotateAround(angle, p) {\n        const cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = p.x + cos * (this.x - p.x) - sin * (this.y - p.y),\n            y = p.y + sin * (this.x - p.x) + cos * (this.y - p.y);\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _round() {\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    },\n\n    constructor: Point\n};\n\n/**\n * Construct a point from an array if necessary, otherwise if the input\n * is already a Point, return it unchanged.\n * @param {Point | [number, number] | {x: number, y: number}} p input value\n * @return {Point} constructed point.\n * @example\n * // this\n * var point = Point.convert([0, 1]);\n * // is equivalent to\n * var point = new Point(0, 1);\n */\nPoint.convert = function (p) {\n    if (p instanceof Point) {\n        return /** @type {Point} */ (p);\n    }\n    if (Array.isArray(p)) {\n        return new Point(+p[0], +p[1]);\n    }\n    if (p.x !== undefined && p.y !== undefined) {\n        return new Point(+p.x, +p.y);\n    }\n    throw new Error('Expected [x, y] or {x, y} point format');\n};\n","import Point from '@mapbox/point-geometry';\n\n/**\n * Returns a Point representing a mouse event's position\n * relative to a containing element.\n *\n * @param {MouseEvent} mouseEvent\n * @param {Node} container\n * @returns {Point}\n */\nfunction mouseEventPoint(mouseEvent, container) {\n  const rect = container.getBoundingClientRect();\n  return new Point(\n    mouseEvent.clientX - rect.left - (container.clientLeft || 0),\n    mouseEvent.clientY - rect.top - (container.clientTop || 0)\n  );\n}\n\nexport default mouseEventPoint;\n","import * as Constants from '../constants.js';\n\n/**\n * Returns GeoJSON for a Point representing the\n * vertex of another feature.\n *\n * @param {string} parentId\n * @param {Array<number>} coordinates\n * @param {string} path - Dot-separated numbers indicating exactly\n *   where the point exists within its parent feature's coordinates.\n * @param {boolean} selected\n * @return {GeoJSON} Point\n */\n\nexport default function(parentId, coordinates, path, selected) {\n  return {\n    type: Constants.geojsonTypes.FEATURE,\n    properties: {\n      meta: Constants.meta.VERTEX,\n      parent: parentId,\n      coord_path: path,\n      active: (selected) ? Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE\n    },\n    geometry: {\n      type: Constants.geojsonTypes.POINT,\n      coordinates\n    }\n  };\n}\n","// index.ts\nvar earthRadius = 63710088e-1;\nvar factors = {\n  centimeters: earthRadius * 100,\n  centimetres: earthRadius * 100,\n  degrees: 360 / (2 * Math.PI),\n  feet: earthRadius * 3.28084,\n  inches: earthRadius * 39.37,\n  kilometers: earthRadius / 1e3,\n  kilometres: earthRadius / 1e3,\n  meters: earthRadius,\n  metres: earthRadius,\n  miles: earthRadius / 1609.344,\n  millimeters: earthRadius * 1e3,\n  millimetres: earthRadius * 1e3,\n  nauticalmiles: earthRadius / 1852,\n  radians: 1,\n  yards: earthRadius * 1.0936\n};\nvar areaFactors = {\n  acres: 247105e-9,\n  centimeters: 1e4,\n  centimetres: 1e4,\n  feet: 10.763910417,\n  hectares: 1e-4,\n  inches: 1550.003100006,\n  kilometers: 1e-6,\n  kilometres: 1e-6,\n  meters: 1,\n  metres: 1,\n  miles: 386e-9,\n  nauticalmiles: 29155334959812285e-23,\n  millimeters: 1e6,\n  millimetres: 1e6,\n  yards: 1.195990046\n};\nfunction feature(geom, properties, options = {}) {\n  const feat = { type: \"Feature\" };\n  if (options.id === 0 || options.id) {\n    feat.id = options.id;\n  }\n  if (options.bbox) {\n    feat.bbox = options.bbox;\n  }\n  feat.properties = properties || {};\n  feat.geometry = geom;\n  return feat;\n}\nfunction geometry(type, coordinates, _options = {}) {\n  switch (type) {\n    case \"Point\":\n      return point(coordinates).geometry;\n    case \"LineString\":\n      return lineString(coordinates).geometry;\n    case \"Polygon\":\n      return polygon(coordinates).geometry;\n    case \"MultiPoint\":\n      return multiPoint(coordinates).geometry;\n    case \"MultiLineString\":\n      return multiLineString(coordinates).geometry;\n    case \"MultiPolygon\":\n      return multiPolygon(coordinates).geometry;\n    default:\n      throw new Error(type + \" is invalid\");\n  }\n}\nfunction point(coordinates, properties, options = {}) {\n  if (!coordinates) {\n    throw new Error(\"coordinates is required\");\n  }\n  if (!Array.isArray(coordinates)) {\n    throw new Error(\"coordinates must be an Array\");\n  }\n  if (coordinates.length < 2) {\n    throw new Error(\"coordinates must be at least 2 numbers long\");\n  }\n  if (!isNumber(coordinates[0]) || !isNumber(coordinates[1])) {\n    throw new Error(\"coordinates must contain numbers\");\n  }\n  const geom = {\n    type: \"Point\",\n    coordinates\n  };\n  return feature(geom, properties, options);\n}\nfunction points(coordinates, properties, options = {}) {\n  return featureCollection(\n    coordinates.map((coords) => {\n      return point(coords, properties);\n    }),\n    options\n  );\n}\nfunction polygon(coordinates, properties, options = {}) {\n  for (const ring of coordinates) {\n    if (ring.length < 4) {\n      throw new Error(\n        \"Each LinearRing of a Polygon must have 4 or more Positions.\"\n      );\n    }\n    if (ring[ring.length - 1].length !== ring[0].length) {\n      throw new Error(\"First and last Position are not equivalent.\");\n    }\n    for (let j = 0; j < ring[ring.length - 1].length; j++) {\n      if (ring[ring.length - 1][j] !== ring[0][j]) {\n        throw new Error(\"First and last Position are not equivalent.\");\n      }\n    }\n  }\n  const geom = {\n    type: \"Polygon\",\n    coordinates\n  };\n  return feature(geom, properties, options);\n}\nfunction polygons(coordinates, properties, options = {}) {\n  return featureCollection(\n    coordinates.map((coords) => {\n      return polygon(coords, properties);\n    }),\n    options\n  );\n}\nfunction lineString(coordinates, properties, options = {}) {\n  if (coordinates.length < 2) {\n    throw new Error(\"coordinates must be an array of two or more positions\");\n  }\n  const geom = {\n    type: \"LineString\",\n    coordinates\n  };\n  return feature(geom, properties, options);\n}\nfunction lineStrings(coordinates, properties, options = {}) {\n  return featureCollection(\n    coordinates.map((coords) => {\n      return lineString(coords, properties);\n    }),\n    options\n  );\n}\nfunction featureCollection(features, options = {}) {\n  const fc = { type: \"FeatureCollection\" };\n  if (options.id) {\n    fc.id = options.id;\n  }\n  if (options.bbox) {\n    fc.bbox = options.bbox;\n  }\n  fc.features = features;\n  return fc;\n}\nfunction multiLineString(coordinates, properties, options = {}) {\n  const geom = {\n    type: \"MultiLineString\",\n    coordinates\n  };\n  return feature(geom, properties, options);\n}\nfunction multiPoint(coordinates, properties, options = {}) {\n  const geom = {\n    type: \"MultiPoint\",\n    coordinates\n  };\n  return feature(geom, properties, options);\n}\nfunction multiPolygon(coordinates, properties, options = {}) {\n  const geom = {\n    type: \"MultiPolygon\",\n    coordinates\n  };\n  return feature(geom, properties, options);\n}\nfunction geometryCollection(geometries, properties, options = {}) {\n  const geom = {\n    type: \"GeometryCollection\",\n    geometries\n  };\n  return feature(geom, properties, options);\n}\nfunction round(num, precision = 0) {\n  if (precision && !(precision >= 0)) {\n    throw new Error(\"precision must be a positive number\");\n  }\n  const multiplier = Math.pow(10, precision || 0);\n  return Math.round(num * multiplier) / multiplier;\n}\nfunction radiansToLength(radians, units = \"kilometers\") {\n  const factor = factors[units];\n  if (!factor) {\n    throw new Error(units + \" units is invalid\");\n  }\n  return radians * factor;\n}\nfunction lengthToRadians(distance, units = \"kilometers\") {\n  const factor = factors[units];\n  if (!factor) {\n    throw new Error(units + \" units is invalid\");\n  }\n  return distance / factor;\n}\nfunction lengthToDegrees(distance, units) {\n  return radiansToDegrees(lengthToRadians(distance, units));\n}\nfunction bearingToAzimuth(bearing) {\n  let angle = bearing % 360;\n  if (angle < 0) {\n    angle += 360;\n  }\n  return angle;\n}\nfunction azimuthToBearing(angle) {\n  angle = angle % 360;\n  if (angle > 180) {\n    return angle - 360;\n  } else if (angle < -180) {\n    return angle + 360;\n  }\n  return angle;\n}\nfunction radiansToDegrees(radians) {\n  const normalisedRadians = radians % (2 * Math.PI);\n  return normalisedRadians * 180 / Math.PI;\n}\nfunction degreesToRadians(degrees) {\n  const normalisedDegrees = degrees % 360;\n  return normalisedDegrees * Math.PI / 180;\n}\nfunction convertLength(length, originalUnit = \"kilometers\", finalUnit = \"kilometers\") {\n  if (!(length >= 0)) {\n    throw new Error(\"length must be a positive number\");\n  }\n  return radiansToLength(lengthToRadians(length, originalUnit), finalUnit);\n}\nfunction convertArea(area, originalUnit = \"meters\", finalUnit = \"kilometers\") {\n  if (!(area >= 0)) {\n    throw new Error(\"area must be a positive number\");\n  }\n  const startFactor = areaFactors[originalUnit];\n  if (!startFactor) {\n    throw new Error(\"invalid original units\");\n  }\n  const finalFactor = areaFactors[finalUnit];\n  if (!finalFactor) {\n    throw new Error(\"invalid final units\");\n  }\n  return area / startFactor * finalFactor;\n}\nfunction isNumber(num) {\n  return !isNaN(num) && num !== null && !Array.isArray(num);\n}\nfunction isObject(input) {\n  return input !== null && typeof input === \"object\" && !Array.isArray(input);\n}\nfunction validateBBox(bbox) {\n  if (!bbox) {\n    throw new Error(\"bbox is required\");\n  }\n  if (!Array.isArray(bbox)) {\n    throw new Error(\"bbox must be an Array\");\n  }\n  if (bbox.length !== 4 && bbox.length !== 6) {\n    throw new Error(\"bbox must be an Array of 4 or 6 numbers\");\n  }\n  bbox.forEach((num) => {\n    if (!isNumber(num)) {\n      throw new Error(\"bbox must only contain numbers\");\n    }\n  });\n}\nfunction validateId(id) {\n  if (!id) {\n    throw new Error(\"id is required\");\n  }\n  if ([\"string\", \"number\"].indexOf(typeof id) === -1) {\n    throw new Error(\"id must be a number or a string\");\n  }\n}\nexport {\n  areaFactors,\n  azimuthToBearing,\n  bearingToAzimuth,\n  convertArea,\n  convertLength,\n  degreesToRadians,\n  earthRadius,\n  factors,\n  feature,\n  featureCollection,\n  geometry,\n  geometryCollection,\n  isNumber,\n  isObject,\n  lengthToDegrees,\n  lengthToRadians,\n  lineString,\n  lineStrings,\n  multiLineString,\n  multiPoint,\n  multiPolygon,\n  point,\n  points,\n  polygon,\n  polygons,\n  radiansToDegrees,\n  radiansToLength,\n  round,\n  validateBBox,\n  validateId\n};\n//# sourceMappingURL=index.js.map","// index.js\nimport { feature, point, lineString, isObject } from \"@turf/helpers\";\nfunction coordEach(geojson, callback, excludeWrapCoord) {\n  if (geojson === null) return;\n  var j, k, l, geometry, stopG, coords, geometryMaybeCollection, wrapShrink = 0, coordIndex = 0, isGeometryCollection, type = geojson.type, isFeatureCollection = type === \"FeatureCollection\", isFeature = type === \"Feature\", stop = isFeatureCollection ? geojson.features.length : 1;\n  for (var featureIndex = 0; featureIndex < stop; featureIndex++) {\n    geometryMaybeCollection = isFeatureCollection ? geojson.features[featureIndex].geometry : isFeature ? geojson.geometry : geojson;\n    isGeometryCollection = geometryMaybeCollection ? geometryMaybeCollection.type === \"GeometryCollection\" : false;\n    stopG = isGeometryCollection ? geometryMaybeCollection.geometries.length : 1;\n    for (var geomIndex = 0; geomIndex < stopG; geomIndex++) {\n      var multiFeatureIndex = 0;\n      var geometryIndex = 0;\n      geometry = isGeometryCollection ? geometryMaybeCollection.geometries[geomIndex] : geometryMaybeCollection;\n      if (geometry === null) continue;\n      coords = geometry.coordinates;\n      var geomType = geometry.type;\n      wrapShrink = excludeWrapCoord && (geomType === \"Polygon\" || geomType === \"MultiPolygon\") ? 1 : 0;\n      switch (geomType) {\n        case null:\n          break;\n        case \"Point\":\n          if (callback(\n            coords,\n            coordIndex,\n            featureIndex,\n            multiFeatureIndex,\n            geometryIndex\n          ) === false)\n            return false;\n          coordIndex++;\n          multiFeatureIndex++;\n          break;\n        case \"LineString\":\n        case \"MultiPoint\":\n          for (j = 0; j < coords.length; j++) {\n            if (callback(\n              coords[j],\n              coordIndex,\n              featureIndex,\n              multiFeatureIndex,\n              geometryIndex\n            ) === false)\n              return false;\n            coordIndex++;\n            if (geomType === \"MultiPoint\") multiFeatureIndex++;\n          }\n          if (geomType === \"LineString\") multiFeatureIndex++;\n          break;\n        case \"Polygon\":\n        case \"MultiLineString\":\n          for (j = 0; j < coords.length; j++) {\n            for (k = 0; k < coords[j].length - wrapShrink; k++) {\n              if (callback(\n                coords[j][k],\n                coordIndex,\n                featureIndex,\n                multiFeatureIndex,\n                geometryIndex\n              ) === false)\n                return false;\n              coordIndex++;\n            }\n            if (geomType === \"MultiLineString\") multiFeatureIndex++;\n            if (geomType === \"Polygon\") geometryIndex++;\n          }\n          if (geomType === \"Polygon\") multiFeatureIndex++;\n          break;\n        case \"MultiPolygon\":\n          for (j = 0; j < coords.length; j++) {\n            geometryIndex = 0;\n            for (k = 0; k < coords[j].length; k++) {\n              for (l = 0; l < coords[j][k].length - wrapShrink; l++) {\n                if (callback(\n                  coords[j][k][l],\n                  coordIndex,\n                  featureIndex,\n                  multiFeatureIndex,\n                  geometryIndex\n                ) === false)\n                  return false;\n                coordIndex++;\n              }\n              geometryIndex++;\n            }\n            multiFeatureIndex++;\n          }\n          break;\n        case \"GeometryCollection\":\n          for (j = 0; j < geometry.geometries.length; j++)\n            if (coordEach(geometry.geometries[j], callback, excludeWrapCoord) === false)\n              return false;\n          break;\n        default:\n          throw new Error(\"Unknown Geometry Type\");\n      }\n    }\n  }\n}\nfunction coordReduce(geojson, callback, initialValue, excludeWrapCoord) {\n  var previousValue = initialValue;\n  coordEach(\n    geojson,\n    function(currentCoord, coordIndex, featureIndex, multiFeatureIndex, geometryIndex) {\n      if (coordIndex === 0 && initialValue === void 0)\n        previousValue = currentCoord;\n      else\n        previousValue = callback(\n          previousValue,\n          currentCoord,\n          coordIndex,\n          featureIndex,\n          multiFeatureIndex,\n          geometryIndex\n        );\n    },\n    excludeWrapCoord\n  );\n  return previousValue;\n}\nfunction propEach(geojson, callback) {\n  var i;\n  switch (geojson.type) {\n    case \"FeatureCollection\":\n      for (i = 0; i < geojson.features.length; i++) {\n        if (callback(geojson.features[i].properties, i) === false) break;\n      }\n      break;\n    case \"Feature\":\n      callback(geojson.properties, 0);\n      break;\n  }\n}\nfunction propReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  propEach(geojson, function(currentProperties, featureIndex) {\n    if (featureIndex === 0 && initialValue === void 0)\n      previousValue = currentProperties;\n    else\n      previousValue = callback(previousValue, currentProperties, featureIndex);\n  });\n  return previousValue;\n}\nfunction featureEach(geojson, callback) {\n  if (geojson.type === \"Feature\") {\n    callback(geojson, 0);\n  } else if (geojson.type === \"FeatureCollection\") {\n    for (var i = 0; i < geojson.features.length; i++) {\n      if (callback(geojson.features[i], i) === false) break;\n    }\n  }\n}\nfunction featureReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  featureEach(geojson, function(currentFeature, featureIndex) {\n    if (featureIndex === 0 && initialValue === void 0)\n      previousValue = currentFeature;\n    else previousValue = callback(previousValue, currentFeature, featureIndex);\n  });\n  return previousValue;\n}\nfunction coordAll(geojson) {\n  var coords = [];\n  coordEach(geojson, function(coord) {\n    coords.push(coord);\n  });\n  return coords;\n}\nfunction geomEach(geojson, callback) {\n  var i, j, g, geometry, stopG, geometryMaybeCollection, isGeometryCollection, featureProperties, featureBBox, featureId, featureIndex = 0, isFeatureCollection = geojson.type === \"FeatureCollection\", isFeature = geojson.type === \"Feature\", stop = isFeatureCollection ? geojson.features.length : 1;\n  for (i = 0; i < stop; i++) {\n    geometryMaybeCollection = isFeatureCollection ? geojson.features[i].geometry : isFeature ? geojson.geometry : geojson;\n    featureProperties = isFeatureCollection ? geojson.features[i].properties : isFeature ? geojson.properties : {};\n    featureBBox = isFeatureCollection ? geojson.features[i].bbox : isFeature ? geojson.bbox : void 0;\n    featureId = isFeatureCollection ? geojson.features[i].id : isFeature ? geojson.id : void 0;\n    isGeometryCollection = geometryMaybeCollection ? geometryMaybeCollection.type === \"GeometryCollection\" : false;\n    stopG = isGeometryCollection ? geometryMaybeCollection.geometries.length : 1;\n    for (g = 0; g < stopG; g++) {\n      geometry = isGeometryCollection ? geometryMaybeCollection.geometries[g] : geometryMaybeCollection;\n      if (geometry === null) {\n        if (callback(\n          null,\n          featureIndex,\n          featureProperties,\n          featureBBox,\n          featureId\n        ) === false)\n          return false;\n        continue;\n      }\n      switch (geometry.type) {\n        case \"Point\":\n        case \"LineString\":\n        case \"MultiPoint\":\n        case \"Polygon\":\n        case \"MultiLineString\":\n        case \"MultiPolygon\": {\n          if (callback(\n            geometry,\n            featureIndex,\n            featureProperties,\n            featureBBox,\n            featureId\n          ) === false)\n            return false;\n          break;\n        }\n        case \"GeometryCollection\": {\n          for (j = 0; j < geometry.geometries.length; j++) {\n            if (callback(\n              geometry.geometries[j],\n              featureIndex,\n              featureProperties,\n              featureBBox,\n              featureId\n            ) === false)\n              return false;\n          }\n          break;\n        }\n        default:\n          throw new Error(\"Unknown Geometry Type\");\n      }\n    }\n    featureIndex++;\n  }\n}\nfunction geomReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  geomEach(\n    geojson,\n    function(currentGeometry, featureIndex, featureProperties, featureBBox, featureId) {\n      if (featureIndex === 0 && initialValue === void 0)\n        previousValue = currentGeometry;\n      else\n        previousValue = callback(\n          previousValue,\n          currentGeometry,\n          featureIndex,\n          featureProperties,\n          featureBBox,\n          featureId\n        );\n    }\n  );\n  return previousValue;\n}\nfunction flattenEach(geojson, callback) {\n  geomEach(geojson, function(geometry, featureIndex, properties, bbox, id) {\n    var type = geometry === null ? null : geometry.type;\n    switch (type) {\n      case null:\n      case \"Point\":\n      case \"LineString\":\n      case \"Polygon\":\n        if (callback(\n          feature(geometry, properties, { bbox, id }),\n          featureIndex,\n          0\n        ) === false)\n          return false;\n        return;\n    }\n    var geomType;\n    switch (type) {\n      case \"MultiPoint\":\n        geomType = \"Point\";\n        break;\n      case \"MultiLineString\":\n        geomType = \"LineString\";\n        break;\n      case \"MultiPolygon\":\n        geomType = \"Polygon\";\n        break;\n    }\n    for (var multiFeatureIndex = 0; multiFeatureIndex < geometry.coordinates.length; multiFeatureIndex++) {\n      var coordinate = geometry.coordinates[multiFeatureIndex];\n      var geom = {\n        type: geomType,\n        coordinates: coordinate\n      };\n      if (callback(feature(geom, properties), featureIndex, multiFeatureIndex) === false)\n        return false;\n    }\n  });\n}\nfunction flattenReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  flattenEach(\n    geojson,\n    function(currentFeature, featureIndex, multiFeatureIndex) {\n      if (featureIndex === 0 && multiFeatureIndex === 0 && initialValue === void 0)\n        previousValue = currentFeature;\n      else\n        previousValue = callback(\n          previousValue,\n          currentFeature,\n          featureIndex,\n          multiFeatureIndex\n        );\n    }\n  );\n  return previousValue;\n}\nfunction segmentEach(geojson, callback) {\n  flattenEach(geojson, function(feature2, featureIndex, multiFeatureIndex) {\n    var segmentIndex = 0;\n    if (!feature2.geometry) return;\n    var type = feature2.geometry.type;\n    if (type === \"Point\" || type === \"MultiPoint\") return;\n    var previousCoords;\n    var previousFeatureIndex = 0;\n    var previousMultiIndex = 0;\n    var prevGeomIndex = 0;\n    if (coordEach(\n      feature2,\n      function(currentCoord, coordIndex, featureIndexCoord, multiPartIndexCoord, geometryIndex) {\n        if (previousCoords === void 0 || featureIndex > previousFeatureIndex || multiPartIndexCoord > previousMultiIndex || geometryIndex > prevGeomIndex) {\n          previousCoords = currentCoord;\n          previousFeatureIndex = featureIndex;\n          previousMultiIndex = multiPartIndexCoord;\n          prevGeomIndex = geometryIndex;\n          segmentIndex = 0;\n          return;\n        }\n        var currentSegment = lineString(\n          [previousCoords, currentCoord],\n          feature2.properties\n        );\n        if (callback(\n          currentSegment,\n          featureIndex,\n          multiFeatureIndex,\n          geometryIndex,\n          segmentIndex\n        ) === false)\n          return false;\n        segmentIndex++;\n        previousCoords = currentCoord;\n      }\n    ) === false)\n      return false;\n  });\n}\nfunction segmentReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  var started = false;\n  segmentEach(\n    geojson,\n    function(currentSegment, featureIndex, multiFeatureIndex, geometryIndex, segmentIndex) {\n      if (started === false && initialValue === void 0)\n        previousValue = currentSegment;\n      else\n        previousValue = callback(\n          previousValue,\n          currentSegment,\n          featureIndex,\n          multiFeatureIndex,\n          geometryIndex,\n          segmentIndex\n        );\n      started = true;\n    }\n  );\n  return previousValue;\n}\nfunction lineEach(geojson, callback) {\n  if (!geojson) throw new Error(\"geojson is required\");\n  flattenEach(geojson, function(feature2, featureIndex, multiFeatureIndex) {\n    if (feature2.geometry === null) return;\n    var type = feature2.geometry.type;\n    var coords = feature2.geometry.coordinates;\n    switch (type) {\n      case \"LineString\":\n        if (callback(feature2, featureIndex, multiFeatureIndex, 0, 0) === false)\n          return false;\n        break;\n      case \"Polygon\":\n        for (var geometryIndex = 0; geometryIndex < coords.length; geometryIndex++) {\n          if (callback(\n            lineString(coords[geometryIndex], feature2.properties),\n            featureIndex,\n            multiFeatureIndex,\n            geometryIndex\n          ) === false)\n            return false;\n        }\n        break;\n    }\n  });\n}\nfunction lineReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  lineEach(\n    geojson,\n    function(currentLine, featureIndex, multiFeatureIndex, geometryIndex) {\n      if (featureIndex === 0 && initialValue === void 0)\n        previousValue = currentLine;\n      else\n        previousValue = callback(\n          previousValue,\n          currentLine,\n          featureIndex,\n          multiFeatureIndex,\n          geometryIndex\n        );\n    }\n  );\n  return previousValue;\n}\nfunction findSegment(geojson, options) {\n  options = options || {};\n  if (!isObject(options)) throw new Error(\"options is invalid\");\n  var featureIndex = options.featureIndex || 0;\n  var multiFeatureIndex = options.multiFeatureIndex || 0;\n  var geometryIndex = options.geometryIndex || 0;\n  var segmentIndex = options.segmentIndex || 0;\n  var properties = options.properties;\n  var geometry;\n  switch (geojson.type) {\n    case \"FeatureCollection\":\n      if (featureIndex < 0)\n        featureIndex = geojson.features.length + featureIndex;\n      properties = properties || geojson.features[featureIndex].properties;\n      geometry = geojson.features[featureIndex].geometry;\n      break;\n    case \"Feature\":\n      properties = properties || geojson.properties;\n      geometry = geojson.geometry;\n      break;\n    case \"Point\":\n    case \"MultiPoint\":\n      return null;\n    case \"LineString\":\n    case \"Polygon\":\n    case \"MultiLineString\":\n    case \"MultiPolygon\":\n      geometry = geojson;\n      break;\n    default:\n      throw new Error(\"geojson is invalid\");\n  }\n  if (geometry === null) return null;\n  var coords = geometry.coordinates;\n  switch (geometry.type) {\n    case \"Point\":\n    case \"MultiPoint\":\n      return null;\n    case \"LineString\":\n      if (segmentIndex < 0) segmentIndex = coords.length + segmentIndex - 1;\n      return lineString(\n        [coords[segmentIndex], coords[segmentIndex + 1]],\n        properties,\n        options\n      );\n    case \"Polygon\":\n      if (geometryIndex < 0) geometryIndex = coords.length + geometryIndex;\n      if (segmentIndex < 0)\n        segmentIndex = coords[geometryIndex].length + segmentIndex - 1;\n      return lineString(\n        [\n          coords[geometryIndex][segmentIndex],\n          coords[geometryIndex][segmentIndex + 1]\n        ],\n        properties,\n        options\n      );\n    case \"MultiLineString\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      if (segmentIndex < 0)\n        segmentIndex = coords[multiFeatureIndex].length + segmentIndex - 1;\n      return lineString(\n        [\n          coords[multiFeatureIndex][segmentIndex],\n          coords[multiFeatureIndex][segmentIndex + 1]\n        ],\n        properties,\n        options\n      );\n    case \"MultiPolygon\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      if (geometryIndex < 0)\n        geometryIndex = coords[multiFeatureIndex].length + geometryIndex;\n      if (segmentIndex < 0)\n        segmentIndex = coords[multiFeatureIndex][geometryIndex].length - segmentIndex - 1;\n      return lineString(\n        [\n          coords[multiFeatureIndex][geometryIndex][segmentIndex],\n          coords[multiFeatureIndex][geometryIndex][segmentIndex + 1]\n        ],\n        properties,\n        options\n      );\n  }\n  throw new Error(\"geojson is invalid\");\n}\nfunction findPoint(geojson, options) {\n  options = options || {};\n  if (!isObject(options)) throw new Error(\"options is invalid\");\n  var featureIndex = options.featureIndex || 0;\n  var multiFeatureIndex = options.multiFeatureIndex || 0;\n  var geometryIndex = options.geometryIndex || 0;\n  var coordIndex = options.coordIndex || 0;\n  var properties = options.properties;\n  var geometry;\n  switch (geojson.type) {\n    case \"FeatureCollection\":\n      if (featureIndex < 0)\n        featureIndex = geojson.features.length + featureIndex;\n      properties = properties || geojson.features[featureIndex].properties;\n      geometry = geojson.features[featureIndex].geometry;\n      break;\n    case \"Feature\":\n      properties = properties || geojson.properties;\n      geometry = geojson.geometry;\n      break;\n    case \"Point\":\n    case \"MultiPoint\":\n      return null;\n    case \"LineString\":\n    case \"Polygon\":\n    case \"MultiLineString\":\n    case \"MultiPolygon\":\n      geometry = geojson;\n      break;\n    default:\n      throw new Error(\"geojson is invalid\");\n  }\n  if (geometry === null) return null;\n  var coords = geometry.coordinates;\n  switch (geometry.type) {\n    case \"Point\":\n      return point(coords, properties, options);\n    case \"MultiPoint\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      return point(coords[multiFeatureIndex], properties, options);\n    case \"LineString\":\n      if (coordIndex < 0) coordIndex = coords.length + coordIndex;\n      return point(coords[coordIndex], properties, options);\n    case \"Polygon\":\n      if (geometryIndex < 0) geometryIndex = coords.length + geometryIndex;\n      if (coordIndex < 0)\n        coordIndex = coords[geometryIndex].length + coordIndex;\n      return point(coords[geometryIndex][coordIndex], properties, options);\n    case \"MultiLineString\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      if (coordIndex < 0)\n        coordIndex = coords[multiFeatureIndex].length + coordIndex;\n      return point(coords[multiFeatureIndex][coordIndex], properties, options);\n    case \"MultiPolygon\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      if (geometryIndex < 0)\n        geometryIndex = coords[multiFeatureIndex].length + geometryIndex;\n      if (coordIndex < 0)\n        coordIndex = coords[multiFeatureIndex][geometryIndex].length - coordIndex;\n      return point(\n        coords[multiFeatureIndex][geometryIndex][coordIndex],\n        properties,\n        options\n      );\n  }\n  throw new Error(\"geojson is invalid\");\n}\nexport {\n  coordAll,\n  coordEach,\n  coordReduce,\n  featureEach,\n  featureReduce,\n  findPoint,\n  findSegment,\n  flattenEach,\n  flattenReduce,\n  geomEach,\n  geomReduce,\n  lineEach,\n  lineReduce,\n  propEach,\n  propReduce,\n  segmentEach,\n  segmentReduce\n};\n//# sourceMappingURL=index.js.map","// index.ts\nfunction clone(geojson) {\n  if (!geojson) {\n    throw new Error(\"geojson is required\");\n  }\n  switch (geojson.type) {\n    case \"Feature\":\n      return cloneFeature(geojson);\n    case \"FeatureCollection\":\n      return cloneFeatureCollection(geojson);\n    case \"Point\":\n    case \"LineString\":\n    case \"Polygon\":\n    case \"MultiPoint\":\n    case \"MultiLineString\":\n    case \"MultiPolygon\":\n    case \"GeometryCollection\":\n      return cloneGeometry(geojson);\n    default:\n      throw new Error(\"unknown GeoJSON type\");\n  }\n}\nfunction cloneFeature(geojson) {\n  const cloned = { type: \"Feature\" };\n  Object.keys(geojson).forEach((key) => {\n    switch (key) {\n      case \"type\":\n      case \"properties\":\n      case \"geometry\":\n        return;\n      default:\n        cloned[key] = geojson[key];\n    }\n  });\n  cloned.properties = cloneProperties(geojson.properties);\n  if (geojson.geometry == null) {\n    cloned.geometry = null;\n  } else {\n    cloned.geometry = cloneGeometry(geojson.geometry);\n  }\n  return cloned;\n}\nfunction cloneProperties(properties) {\n  const cloned = {};\n  if (!properties) {\n    return cloned;\n  }\n  Object.keys(properties).forEach((key) => {\n    const value = properties[key];\n    if (typeof value === \"object\") {\n      if (value === null) {\n        cloned[key] = null;\n      } else if (Array.isArray(value)) {\n        cloned[key] = value.map((item) => {\n          return item;\n        });\n      } else {\n        cloned[key] = cloneProperties(value);\n      }\n    } else {\n      cloned[key] = value;\n    }\n  });\n  return cloned;\n}\nfunction cloneFeatureCollection(geojson) {\n  const cloned = { type: \"FeatureCollection\" };\n  Object.keys(geojson).forEach((key) => {\n    switch (key) {\n      case \"type\":\n      case \"features\":\n        return;\n      default:\n        cloned[key] = geojson[key];\n    }\n  });\n  cloned.features = geojson.features.map((feature) => {\n    return cloneFeature(feature);\n  });\n  return cloned;\n}\nfunction cloneGeometry(geometry) {\n  const geom = { type: geometry.type };\n  if (geometry.bbox) {\n    geom.bbox = geometry.bbox;\n  }\n  if (geometry.type === \"GeometryCollection\") {\n    geom.geometries = geometry.geometries.map((g) => {\n      return cloneGeometry(g);\n    });\n    return geom;\n  }\n  geom.coordinates = deepSlice(geometry.coordinates);\n  return geom;\n}\nfunction deepSlice(coords) {\n  const cloned = coords;\n  if (typeof cloned[0] !== \"object\") {\n    return cloned.slice();\n  }\n  return cloned.map((coord) => {\n    return deepSlice(coord);\n  });\n}\nvar index_default = clone;\nexport {\n  clone,\n  cloneProperties,\n  index_default as default\n};\n//# sourceMappingURL=index.js.map","// index.ts\nimport { coordEach } from \"@turf/meta\";\nimport { isNumber } from \"@turf/helpers\";\nimport { clone } from \"@turf/clone\";\nfunction toMercator(geojson, options = {}) {\n  return convert(geojson, \"mercator\", options);\n}\nfunction toWgs84(geojson, options = {}) {\n  return convert(geojson, \"wgs84\", options);\n}\nfunction convert(geojson, projection, options = {}) {\n  options = options || {};\n  var mutate = options.mutate;\n  if (!geojson) throw new Error(\"geojson is required\");\n  if (Array.isArray(geojson) && isNumber(geojson[0]))\n    geojson = projection === \"mercator\" ? convertToMercator(geojson) : convertToWgs84(geojson);\n  else {\n    if (mutate !== true) geojson = clone(geojson);\n    coordEach(geojson, function(coord) {\n      var newCoord = projection === \"mercator\" ? convertToMercator(coord) : convertToWgs84(coord);\n      coord[0] = newCoord[0];\n      coord[1] = newCoord[1];\n    });\n  }\n  return geojson;\n}\nfunction convertToMercator(lonLat) {\n  var D2R = Math.PI / 180, A = 6378137, MAXEXTENT = 20037508342789244e-9;\n  var adjusted = Math.abs(lonLat[0]) <= 180 ? lonLat[0] : lonLat[0] - sign(lonLat[0]) * 360;\n  var xy = [\n    A * adjusted * D2R,\n    A * Math.log(Math.tan(Math.PI * 0.25 + 0.5 * lonLat[1] * D2R))\n  ];\n  if (xy[0] > MAXEXTENT) xy[0] = MAXEXTENT;\n  if (xy[0] < -MAXEXTENT) xy[0] = -MAXEXTENT;\n  if (xy[1] > MAXEXTENT) xy[1] = MAXEXTENT;\n  if (xy[1] < -MAXEXTENT) xy[1] = -MAXEXTENT;\n  return xy;\n}\nfunction convertToWgs84(xy) {\n  var R2D = 180 / Math.PI;\n  var A = 6378137;\n  return [\n    xy[0] * R2D / A,\n    (Math.PI * 0.5 - 2 * Math.atan(Math.exp(-xy[1] / A))) * R2D\n  ];\n}\nfunction sign(x) {\n  return x < 0 ? -1 : x > 0 ? 1 : 0;\n}\nexport {\n  toMercator,\n  toWgs84\n};\n//# sourceMappingURL=index.js.map","import * as Constants from '../constants.js';\nimport { toMercator, toWgs84 } from '@turf/projection';\n\n/**\n * Calculate the midpoint in Web Mercator, then convert back to Mercator\n * to ensure the midpoint appears on the projected line.\n */\nexport default function(parent, startVertex, endVertex) {\n  const startCoord = startVertex.geometry.coordinates;\n  const endCoord = endVertex.geometry.coordinates;\n\n  // If a coordinate exceeds the projection, we can't calculate a midpoint,\n  // so run away\n  if (startCoord[1] > Constants.LAT_RENDERED_MAX ||\n    startCoord[1] < Constants.LAT_RENDERED_MIN ||\n    endCoord[1] > Constants.LAT_RENDERED_MAX ||\n    endCoord[1] < Constants.LAT_RENDERED_MIN) {\n    return null;\n  }\n\n  const start = toMercator(startCoord);\n  const end = toMercator(endCoord);\n\n  const round = num => Number(num.toFixed(8));\n  const getMidpoint = (a, b) => (a + b) / 2;\n\n  const midpointRaw = toWgs84([\n    getMidpoint(start[0], end[0]),\n    getMidpoint(start[1], end[1])\n  ]);\n\n  const midpoint = [\n    round(midpointRaw[0]),\n    round(midpointRaw[1])\n  ];\n\n  return {\n    type: Constants.geojsonTypes.FEATURE,\n    properties: {\n      meta: Constants.meta.MIDPOINT,\n      parent,\n      lng: midpoint[0],\n      lat: midpoint[1],\n      coord_path: endVertex.properties.coord_path\n    },\n    geometry: {\n      type: Constants.geojsonTypes.POINT,\n      coordinates: midpoint\n    }\n  };\n}\n","import createVertex from './create_vertex.js';\nimport createMidpoint from './create_midpoint.js';\nimport * as Constants from '../constants.js';\n\nfunction createSupplementaryPoints(geojson, options = {}, basePath = null) {\n  const { type, coordinates } = geojson.geometry;\n  const featureId = geojson.properties && geojson.properties.id;\n\n  let supplementaryPoints = [];\n\n  if (type === Constants.geojsonTypes.POINT) {\n    // For points, just create a vertex\n    supplementaryPoints.push(createVertex(featureId, coordinates, basePath, isSelectedPath(basePath)));\n  } else if (type === Constants.geojsonTypes.POLYGON) {\n    // Cycle through a Polygon's rings and\n    // process each line\n    coordinates.forEach((line, lineIndex) => {\n      processLine(line, (basePath !== null) ? `${basePath}.${lineIndex}` : String(lineIndex));\n    });\n  } else if (type === Constants.geojsonTypes.LINE_STRING) {\n    processLine(coordinates, basePath);\n  } else if (type.indexOf(Constants.geojsonTypes.MULTI_PREFIX) === 0) {\n    processMultiGeometry();\n  }\n\n  function processLine(line, lineBasePath) {\n    let firstPointString = '';\n    let lastVertex = null;\n    line.forEach((point, pointIndex) => {\n      const pointPath = (lineBasePath !== undefined && lineBasePath !== null) ? `${lineBasePath}.${pointIndex}` : String(pointIndex);\n      const vertex = createVertex(featureId, point, pointPath, isSelectedPath(pointPath));\n\n      // If we're creating midpoints, check if there was a\n      // vertex before this one. If so, add a midpoint\n      // between that vertex and this one.\n      if (options.midpoints && lastVertex) {\n        const midpoint = createMidpoint(featureId, lastVertex, vertex);\n        if (midpoint) {\n          supplementaryPoints.push(midpoint);\n        }\n      }\n      lastVertex = vertex;\n\n      // A Polygon line's last point is the same as the first point. If we're on the last\n      // point, we want to draw a midpoint before it but not another vertex on it\n      // (since we already a vertex there, from the first point).\n      const stringifiedPoint = JSON.stringify(point);\n      if (firstPointString !== stringifiedPoint) {\n        supplementaryPoints.push(vertex);\n      }\n      if (pointIndex === 0) {\n        firstPointString = stringifiedPoint;\n      }\n    });\n  }\n\n  function isSelectedPath(path) {\n    if (!options.selectedPaths) return false;\n    return options.selectedPaths.indexOf(path) !== -1;\n  }\n\n  // Split a multi-geometry into constituent\n  // geometries, and accumulate the supplementary points\n  // for each of those constituents\n  function processMultiGeometry() {\n    const subType = type.replace(Constants.geojsonTypes.MULTI_PREFIX, '');\n    coordinates.forEach((subCoordinates, index) => {\n      const subFeature = {\n        type: Constants.geojsonTypes.FEATURE,\n        properties: geojson.properties,\n        geometry: {\n          type: subType,\n          coordinates: subCoordinates\n        }\n      };\n      supplementaryPoints = supplementaryPoints.concat(createSupplementaryPoints(subFeature, options, index));\n    });\n  }\n\n  return supplementaryPoints;\n}\n\nexport default createSupplementaryPoints;\n","export default {\n  enable(ctx) {\n    setTimeout(() => {\n      // First check we've got a map and some context.\n      if (!ctx.map || !ctx.map.doubleClickZoom || !ctx._ctx || !ctx._ctx.store || !ctx._ctx.store.getInitialConfigValue) return;\n      // Now check initial state wasn't false (we leave it disabled if so)\n      if (!ctx._ctx.store.getInitialConfigValue('doubleClickZoom')) return;\n      ctx.map.doubleClickZoom.enable();\n    }, 0);\n  },\n  disable(ctx) {\n    setTimeout(() => {\n      if (!ctx.map || !ctx.map.doubleClickZoom) return;\n      // Always disable here, as it's necessary in some cases.\n      ctx.map.doubleClickZoom.disable();\n    }, 0);\n  }\n};\n","import * as Constants from '../constants.js';\n\nconst {\n  LAT_MIN,\n  LAT_MAX,\n  LAT_RENDERED_MIN,\n  LAT_RENDERED_MAX,\n  LNG_MIN,\n  LNG_MAX,\n} = Constants;\nfunction extent(feature) {\n  const depth = {\n    Point: 0,\n    LineString: 1,\n    Polygon: 2,\n    MultiPoint: 1,\n    MultiLineString: 2,\n    MultiPolygon: 3,\n  }[feature.geometry.type];\n\n  const coords = [feature.geometry.coordinates].flat(depth);\n  const lngs = coords.map(coord => coord[0]);\n  const lats = coords.map(coord => coord[1]);\n  const min = vals => Math.min.apply(null, vals);\n  const max = vals => Math.max.apply(null, vals);\n  return [min(lngs), min(lats), max(lngs), max(lats)];\n}\n\n// Ensure that we do not drag north-south far enough for\n// - any part of any feature to exceed the poles\n// - any feature to be completely lost in the space between the projection's\n//   edge and the poles, such that it couldn't be re-selected and moved back\nexport default function(geojsonFeatures, delta) {\n  // \"inner edge\" = a feature's latitude closest to the equator\n  let northInnerEdge = LAT_MIN;\n  let southInnerEdge = LAT_MAX;\n  // \"outer edge\" = a feature's latitude furthest from the equator\n  let northOuterEdge = LAT_MIN;\n  let southOuterEdge = LAT_MAX;\n\n  let westEdge = LNG_MAX;\n  let eastEdge = LNG_MIN;\n\n  geojsonFeatures.forEach((feature) => {\n    const bounds = extent(feature);\n    const featureSouthEdge = bounds[1];\n    const featureNorthEdge = bounds[3];\n    const featureWestEdge = bounds[0];\n    const featureEastEdge = bounds[2];\n    if (featureSouthEdge > northInnerEdge) northInnerEdge = featureSouthEdge;\n    if (featureNorthEdge < southInnerEdge) southInnerEdge = featureNorthEdge;\n    if (featureNorthEdge > northOuterEdge) northOuterEdge = featureNorthEdge;\n    if (featureSouthEdge < southOuterEdge) southOuterEdge = featureSouthEdge;\n    if (featureWestEdge < westEdge) westEdge = featureWestEdge;\n    if (featureEastEdge > eastEdge) eastEdge = featureEastEdge;\n  });\n\n\n  // These changes are not mutually exclusive: we might hit the inner\n  // edge but also have hit the outer edge and therefore need\n  // another readjustment\n  const constrainedDelta = delta;\n  if (northInnerEdge + constrainedDelta.lat > LAT_RENDERED_MAX) {\n    constrainedDelta.lat = LAT_RENDERED_MAX - northInnerEdge;\n  }\n  if (northOuterEdge + constrainedDelta.lat > LAT_MAX) {\n    constrainedDelta.lat = LAT_MAX - northOuterEdge;\n  }\n  if (southInnerEdge + constrainedDelta.lat < LAT_RENDERED_MIN) {\n    constrainedDelta.lat = LAT_RENDERED_MIN - southInnerEdge;\n  }\n  if (southOuterEdge + constrainedDelta.lat < LAT_MIN) {\n    constrainedDelta.lat = LAT_MIN - southOuterEdge;\n  }\n  if (westEdge + constrainedDelta.lng <= LNG_MIN) {\n    constrainedDelta.lng += Math.ceil(Math.abs(constrainedDelta.lng) / 360) * 360;\n  }\n  if (eastEdge + constrainedDelta.lng >= LNG_MAX) {\n    constrainedDelta.lng -= Math.ceil(Math.abs(constrainedDelta.lng) / 360) * 360;\n  }\n\n  return constrainedDelta;\n}\n","import constrainFeatureMovement from './constrain_feature_movement.js';\nimport * as Constants from '../constants.js';\n\nexport default function(features, delta) {\n  const constrainedDelta = constrainFeatureMovement(features.map(feature => feature.toGeoJSON()), delta);\n\n  features.forEach((feature) => {\n    const currentCoordinates = feature.getCoordinates();\n\n    const moveCoordinate = (coord) => {\n      const point = {\n        lng: coord[0] + constrainedDelta.lng,\n        lat: coord[1] + constrainedDelta.lat\n      };\n      return [point.lng, point.lat];\n    };\n    const moveRing = ring => ring.map(coord => moveCoordinate(coord));\n    const moveMultiPolygon = multi => multi.map(ring => moveRing(ring));\n\n    let nextCoordinates;\n    if (feature.type === Constants.geojsonTypes.POINT) {\n      nextCoordinates = moveCoordinate(currentCoordinates);\n    } else if (feature.type === Constants.geojsonTypes.LINE_STRING || feature.type === Constants.geojsonTypes.MULTI_POINT) {\n      nextCoordinates = currentCoordinates.map(moveCoordinate);\n    } else if (feature.type === Constants.geojsonTypes.POLYGON || feature.type === Constants.geojsonTypes.MULTI_LINE_STRING) {\n      nextCoordinates = currentCoordinates.map(moveRing);\n    } else if (feature.type === Constants.geojsonTypes.MULTI_POLYGON) {\n      nextCoordinates = currentCoordinates.map(moveMultiPolygon);\n    }\n\n    feature.incomingCoords(nextCoordinates);\n  });\n}\n","import * as CommonSelectors from '../lib/common_selectors.js';\nimport mouseEventPoint from '../lib/mouse_event_point.js';\nimport createSupplementaryPoints from '../lib/create_supplementary_points.js';\nimport StringSet from '../lib/string_set.js';\nimport doubleClickZoom from '../lib/double_click_zoom.js';\nimport moveFeatures from '../lib/move_features.js';\nimport * as Constants from '../constants.js';\n\nconst SimpleSelect = {};\n\nSimpleSelect.onSetup = function(opts) {\n  // turn the opts into state.\n  const state = {\n    dragMoveLocation: null,\n    boxSelectStartLocation: null,\n    boxSelectElement: undefined,\n    boxSelecting: false,\n    canBoxSelect: false,\n    dragMoving: false,\n    canDragMove: false,\n    initialDragPanState: this.map.dragPan.isEnabled(),\n    initiallySelectedFeatureIds: opts.featureIds || []\n  };\n\n  this.setSelected(state.initiallySelectedFeatureIds.filter(id => this.getFeature(id) !== undefined));\n  this.fireActionable();\n\n  this.setActionableState({\n    combineFeatures: true,\n    uncombineFeatures: true,\n    trash: true\n  });\n\n  return state;\n};\n\nSimpleSelect.fireUpdate = function() {\n  this.fire(Constants.events.UPDATE, {\n    action: Constants.updateActions.MOVE,\n    features: this.getSelected().map(f => f.toGeoJSON())\n  });\n};\n\nSimpleSelect.fireActionable = function() {\n  const selectedFeatures = this.getSelected();\n\n  const multiFeatures = selectedFeatures.filter(\n    feature => this.isInstanceOf('MultiFeature', feature)\n  );\n\n  let combineFeatures = false;\n\n  if (selectedFeatures.length > 1) {\n    combineFeatures = true;\n    const featureType = selectedFeatures[0].type.replace('Multi', '');\n    selectedFeatures.forEach((feature) => {\n      if (feature.type.replace('Multi', '') !== featureType) {\n        combineFeatures = false;\n      }\n    });\n  }\n\n  const uncombineFeatures = multiFeatures.length > 0;\n  const trash = selectedFeatures.length > 0;\n\n  this.setActionableState({\n    combineFeatures, uncombineFeatures, trash\n  });\n};\n\nSimpleSelect.getUniqueIds = function(allFeatures) {\n  if (!allFeatures.length) return [];\n  const ids = allFeatures.map(s => s.properties.id)\n    .filter(id => id !== undefined)\n    .reduce((memo, id) => {\n      memo.add(id);\n      return memo;\n    }, new StringSet());\n\n  return ids.values();\n};\n\nSimpleSelect.stopExtendedInteractions = function(state) {\n  if (state.boxSelectElement) {\n    if (state.boxSelectElement.parentNode) state.boxSelectElement.parentNode.removeChild(state.boxSelectElement);\n    state.boxSelectElement = null;\n  }\n\n  if ((state.canDragMove || state.canBoxSelect) && state.initialDragPanState === true) {\n    this.map.dragPan.enable();\n  }\n\n  state.boxSelecting = false;\n  state.canBoxSelect = false;\n  state.dragMoving = false;\n  state.canDragMove = false;\n};\n\nSimpleSelect.onStop = function() {\n  doubleClickZoom.enable(this);\n};\n\nSimpleSelect.onMouseMove = function(state, e) {\n  const isFeature = CommonSelectors.isFeature(e);\n  if (isFeature && state.dragMoving) this.fireUpdate();\n\n  // On mousemove that is not a drag, stop extended interactions.\n  // This is useful if you drag off the canvas, release the button,\n  // then move the mouse back over the canvas --- we don't allow the\n  // interaction to continue then, but we do let it continue if you held\n  // the mouse button that whole time\n  this.stopExtendedInteractions(state);\n\n  // Skip render\n  return true;\n};\n\nSimpleSelect.onMouseOut = function(state) {\n  // As soon as you mouse leaves the canvas, update the feature\n  if (state.dragMoving) return this.fireUpdate();\n\n  // Skip render\n  return true;\n};\n\nSimpleSelect.onTap = SimpleSelect.onClick = function(state, e) {\n  // Click (with or without shift) on no feature\n  if (CommonSelectors.noTarget(e)) return this.clickAnywhere(state, e); // also tap\n  if (CommonSelectors.isOfMetaType(Constants.meta.VERTEX)(e)) return this.clickOnVertex(state, e); //tap\n  if (CommonSelectors.isFeature(e)) return this.clickOnFeature(state, e);\n};\n\nSimpleSelect.clickAnywhere = function (state) {\n  // Clear the re-render selection\n  const wasSelected = this.getSelectedIds();\n  if (wasSelected.length) {\n    this.clearSelectedFeatures();\n    wasSelected.forEach(id => this.doRender(id));\n  }\n  doubleClickZoom.enable(this);\n  this.stopExtendedInteractions(state);\n};\n\nSimpleSelect.clickOnVertex = function(state, e) {\n  // Enter direct select mode\n  this.changeMode(Constants.modes.DIRECT_SELECT, {\n    featureId: e.featureTarget.properties.parent,\n    coordPath: e.featureTarget.properties.coord_path,\n    startPos: e.lngLat\n  });\n  this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n};\n\nSimpleSelect.startOnActiveFeature = function(state, e) {\n  // Stop any already-underway extended interactions\n  this.stopExtendedInteractions(state);\n\n  // Disable map.dragPan immediately so it can't start\n  this.map.dragPan.disable();\n\n  // Re-render it and enable drag move\n  this.doRender(e.featureTarget.properties.id);\n\n  // Set up the state for drag moving\n  state.canDragMove = true;\n  state.dragMoveLocation = e.lngLat;\n};\n\nSimpleSelect.clickOnFeature = function(state, e) {\n  // Stop everything\n  doubleClickZoom.disable(this);\n  this.stopExtendedInteractions(state);\n\n  const isShiftClick = CommonSelectors.isShiftDown(e);\n  const selectedFeatureIds = this.getSelectedIds();\n  const featureId = e.featureTarget.properties.id;\n  const isFeatureSelected = this.isSelected(featureId);\n\n  // Click (without shift) on any selected feature but a point\n  if (!isShiftClick && isFeatureSelected && this.getFeature(featureId).type !== Constants.geojsonTypes.POINT) {\n    // Enter direct select mode\n    return this.changeMode(Constants.modes.DIRECT_SELECT, {\n      featureId\n    });\n  }\n\n  // Shift-click on a selected feature\n  if (isFeatureSelected && isShiftClick) {\n    // Deselect it\n    this.deselect(featureId);\n    this.updateUIClasses({ mouse: Constants.cursors.POINTER });\n    if (selectedFeatureIds.length === 1) {\n      doubleClickZoom.enable(this);\n    }\n  // Shift-click on an unselected feature\n  } else if (!isFeatureSelected && isShiftClick) {\n    // Add it to the selection\n    this.select(featureId);\n    this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n  // Click (without shift) on an unselected feature\n  } else if (!isFeatureSelected && !isShiftClick) {\n    // Make it the only selected feature\n    selectedFeatureIds.forEach(id => this.doRender(id));\n    this.setSelected(featureId);\n    this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n  }\n\n  // No matter what, re-render the clicked feature\n  this.doRender(featureId);\n};\n\nSimpleSelect.onMouseDown = function(state, e) {\n  state.initialDragPanState = this.map.dragPan.isEnabled();\n  if (CommonSelectors.isActiveFeature(e)) return this.startOnActiveFeature(state, e);\n  if (this.drawConfig.boxSelect && CommonSelectors.isShiftMousedown(e)) return this.startBoxSelect(state, e);\n};\n\nSimpleSelect.startBoxSelect = function(state, e) {\n  this.stopExtendedInteractions(state);\n  this.map.dragPan.disable();\n  // Enable box select\n  state.boxSelectStartLocation = mouseEventPoint(e.originalEvent, this.map.getContainer());\n  state.canBoxSelect = true;\n};\n\nSimpleSelect.onTouchStart = function(state, e) {\n  if (CommonSelectors.isActiveFeature(e)) return this.startOnActiveFeature(state, e);\n};\n\nSimpleSelect.onDrag = function(state, e) {\n  if (state.canDragMove) return this.dragMove(state, e);\n  if (this.drawConfig.boxSelect && state.canBoxSelect) return this.whileBoxSelect(state, e);\n};\n\nSimpleSelect.whileBoxSelect = function(state, e) {\n  state.boxSelecting = true;\n  this.updateUIClasses({ mouse: Constants.cursors.ADD });\n\n  // Create the box node if it doesn't exist\n  if (!state.boxSelectElement) {\n    state.boxSelectElement = document.createElement('div');\n    state.boxSelectElement.classList.add(Constants.classes.BOX_SELECT);\n    this.map.getContainer().appendChild(state.boxSelectElement);\n  }\n\n  // Adjust the box node's width and xy position\n  const current = mouseEventPoint(e.originalEvent, this.map.getContainer());\n  const minX = Math.min(state.boxSelectStartLocation.x, current.x);\n  const maxX = Math.max(state.boxSelectStartLocation.x, current.x);\n  const minY = Math.min(state.boxSelectStartLocation.y, current.y);\n  const maxY = Math.max(state.boxSelectStartLocation.y, current.y);\n  const translateValue = `translate(${minX}px, ${minY}px)`;\n  state.boxSelectElement.style.transform = translateValue;\n  state.boxSelectElement.style.WebkitTransform = translateValue;\n  state.boxSelectElement.style.width = `${maxX - minX}px`;\n  state.boxSelectElement.style.height = `${maxY - minY}px`;\n};\n\nSimpleSelect.dragMove = function(state, e) {\n  // Dragging when drag move is enabled\n  state.dragMoving = true;\n  e.originalEvent.stopPropagation();\n\n  const delta = {\n    lng: e.lngLat.lng - state.dragMoveLocation.lng,\n    lat: e.lngLat.lat - state.dragMoveLocation.lat\n  };\n\n  moveFeatures(this.getSelected(), delta);\n\n  state.dragMoveLocation = e.lngLat;\n};\n\nSimpleSelect.onTouchEnd = SimpleSelect.onMouseUp = function(state, e) {\n  // End any extended interactions\n  if (state.dragMoving) {\n    this.fireUpdate();\n  } else if (state.boxSelecting) {\n    const bbox = [\n      state.boxSelectStartLocation,\n      mouseEventPoint(e.originalEvent, this.map.getContainer())\n    ];\n    const featuresInBox = this.featuresAt(null, bbox, 'click');\n    const idsToSelect = this.getUniqueIds(featuresInBox)\n      .filter(id => !this.isSelected(id));\n\n    if (idsToSelect.length) {\n      this.select(idsToSelect);\n      idsToSelect.forEach(id => this.doRender(id));\n      this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n    }\n  }\n  this.stopExtendedInteractions(state);\n};\n\nSimpleSelect.toDisplayFeatures = function(state, geojson, display) {\n  geojson.properties.active = (this.isSelected(geojson.properties.id)) ?\n    Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE;\n  display(geojson);\n  this.fireActionable();\n  if (geojson.properties.active !== Constants.activeStates.ACTIVE ||\n    geojson.geometry.type === Constants.geojsonTypes.POINT) return;\n  createSupplementaryPoints(geojson).forEach(display);\n};\n\nSimpleSelect.onTrash = function() {\n  this.deleteFeature(this.getSelectedIds());\n  this.fireActionable();\n};\n\nSimpleSelect.onCombineFeatures = function() {\n  const selectedFeatures = this.getSelected();\n\n  if (selectedFeatures.length === 0 || selectedFeatures.length < 2) return;\n\n  const coordinates = [], featuresCombined = [];\n  const featureType = selectedFeatures[0].type.replace('Multi', '');\n\n  for (let i = 0; i < selectedFeatures.length; i++) {\n    const feature = selectedFeatures[i];\n\n    if (feature.type.replace('Multi', '') !== featureType) {\n      return;\n    }\n    if (feature.type.includes('Multi')) {\n      feature.getCoordinates().forEach((subcoords) => {\n        coordinates.push(subcoords);\n      });\n    } else {\n      coordinates.push(feature.getCoordinates());\n    }\n\n    featuresCombined.push(feature.toGeoJSON());\n  }\n\n  if (featuresCombined.length > 1) {\n    const multiFeature = this.newFeature({\n      type: Constants.geojsonTypes.FEATURE,\n      properties: featuresCombined[0].properties,\n      geometry: {\n        type: `Multi${featureType}`,\n        coordinates\n      }\n    });\n\n    this.addFeature(multiFeature);\n    this.deleteFeature(this.getSelectedIds(), { silent: true });\n    this.setSelected([multiFeature.id]);\n\n    this.fire(Constants.events.COMBINE_FEATURES, {\n      createdFeatures: [multiFeature.toGeoJSON()],\n      deletedFeatures: featuresCombined\n    });\n  }\n  this.fireActionable();\n};\n\nSimpleSelect.onUncombineFeatures = function() {\n  const selectedFeatures = this.getSelected();\n  if (selectedFeatures.length === 0) return;\n\n  const createdFeatures = [];\n  const featuresUncombined = [];\n\n  for (let i = 0; i < selectedFeatures.length; i++) {\n    const feature = selectedFeatures[i];\n\n    if (this.isInstanceOf('MultiFeature', feature)) {\n      feature.getFeatures().forEach((subFeature) => {\n        this.addFeature(subFeature);\n        subFeature.properties = feature.properties;\n        createdFeatures.push(subFeature.toGeoJSON());\n        this.select([subFeature.id]);\n      });\n      this.deleteFeature(feature.id, { silent: true });\n      featuresUncombined.push(feature.toGeoJSON());\n    }\n  }\n\n  if (createdFeatures.length > 1) {\n    this.fire(Constants.events.UNCOMBINE_FEATURES, {\n      createdFeatures,\n      deletedFeatures: featuresUncombined\n    });\n  }\n  this.fireActionable();\n};\n\nexport default SimpleSelect;\n","import { noTarget, isOfMetaType, isActiveFeature, isInactiveFeature, isShiftDown } from '../lib/common_selectors.js';\nimport createSupplementaryPoints from '../lib/create_supplementary_points.js';\nimport constrainFeatureMovement from '../lib/constrain_feature_movement.js';\nimport doubleClickZoom from '../lib/double_click_zoom.js';\nimport * as Constants from '../constants.js';\nimport moveFeatures from '../lib/move_features.js';\n\nconst isVertex = isOfMetaType(Constants.meta.VERTEX);\nconst isMidpoint = isOfMetaType(Constants.meta.MIDPOINT);\n\nconst DirectSelect = {};\n\n// INTERNAL FUCNTIONS\n\nDirectSelect.fireUpdate = function() {\n  this.fire(Constants.events.UPDATE, {\n    action: Constants.updateActions.CHANGE_COORDINATES,\n    features: this.getSelected().map(f => f.toGeoJSON())\n  });\n};\n\nDirectSelect.fireActionable = function(state) {\n  this.setActionableState({\n    combineFeatures: false,\n    uncombineFeatures: false,\n    trash: state.selectedCoordPaths.length > 0\n  });\n};\n\nDirectSelect.startDragging = function(state, e) {\n  if (state.initialDragPanState == null) {\n    state.initialDragPanState = this.map.dragPan.isEnabled();\n  }\n\n  this.map.dragPan.disable();\n  state.canDragMove = true;\n  state.dragMoveLocation = e.lngLat;\n};\n\nDirectSelect.stopDragging = function(state) {\n  if (state.canDragMove && state.initialDragPanState === true) {\n    this.map.dragPan.enable();\n  }\n\n  state.initialDragPanState = null;\n  state.dragMoving = false;\n  state.canDragMove = false;\n  state.dragMoveLocation = null;\n};\n\nDirectSelect.onVertex = function (state, e) {\n  this.startDragging(state, e);\n  const about = e.featureTarget.properties;\n  const selectedIndex = state.selectedCoordPaths.indexOf(about.coord_path);\n  if (!isShiftDown(e) && selectedIndex === -1) {\n    state.selectedCoordPaths = [about.coord_path];\n  } else if (isShiftDown(e) && selectedIndex === -1) {\n    state.selectedCoordPaths.push(about.coord_path);\n  }\n\n  const selectedCoordinates = this.pathsToCoordinates(state.featureId, state.selectedCoordPaths);\n  this.setSelectedCoordinates(selectedCoordinates);\n};\n\nDirectSelect.onMidpoint = function(state, e) {\n  this.startDragging(state, e);\n  const about = e.featureTarget.properties;\n  state.feature.addCoordinate(about.coord_path, about.lng, about.lat);\n  this.fireUpdate();\n  state.selectedCoordPaths = [about.coord_path];\n};\n\nDirectSelect.pathsToCoordinates = function(featureId, paths) {\n  return paths.map(coord_path => ({ feature_id: featureId, coord_path }));\n};\n\nDirectSelect.onFeature = function(state, e) {\n  if (state.selectedCoordPaths.length === 0) this.startDragging(state, e);\n  else this.stopDragging(state);\n};\n\nDirectSelect.dragFeature = function(state, e, delta) {\n  moveFeatures(this.getSelected(), delta);\n  state.dragMoveLocation = e.lngLat;\n};\n\nDirectSelect.dragVertex = function(state, e, delta) {\n  const selectedCoords = state.selectedCoordPaths.map(coord_path => state.feature.getCoordinate(coord_path));\n  const selectedCoordPoints = selectedCoords.map(coords => ({\n    type: Constants.geojsonTypes.FEATURE,\n    properties: {},\n    geometry: {\n      type: Constants.geojsonTypes.POINT,\n      coordinates: coords\n    }\n  }));\n\n  const constrainedDelta = constrainFeatureMovement(selectedCoordPoints, delta);\n  for (let i = 0; i < selectedCoords.length; i++) {\n    const coord = selectedCoords[i];\n    state.feature.updateCoordinate(state.selectedCoordPaths[i], coord[0] + constrainedDelta.lng, coord[1] + constrainedDelta.lat);\n  }\n};\n\nDirectSelect.clickNoTarget = function () {\n  this.changeMode(Constants.modes.SIMPLE_SELECT);\n};\n\nDirectSelect.clickInactive = function () {\n  this.changeMode(Constants.modes.SIMPLE_SELECT);\n};\n\nDirectSelect.clickActiveFeature = function (state) {\n  state.selectedCoordPaths = [];\n  this.clearSelectedCoordinates();\n  state.feature.changed();\n};\n\n// EXTERNAL FUNCTIONS\n\nDirectSelect.onSetup = function(opts) {\n  const featureId = opts.featureId;\n  const feature = this.getFeature(featureId);\n\n  if (!feature) {\n    throw new Error('You must provide a featureId to enter direct_select mode');\n  }\n\n  if (feature.type === Constants.geojsonTypes.POINT) {\n    throw new TypeError('direct_select mode doesn\\'t handle point features');\n  }\n\n  const state = {\n    featureId,\n    feature,\n    dragMoveLocation: opts.startPos || null,\n    dragMoving: false,\n    canDragMove: false,\n    selectedCoordPaths: opts.coordPath ? [opts.coordPath] : [],\n  };\n\n  this.setSelectedCoordinates(this.pathsToCoordinates(featureId, state.selectedCoordPaths));\n  this.setSelected(featureId);\n  doubleClickZoom.disable(this);\n\n  this.setActionableState({\n    trash: true\n  });\n\n  return state;\n};\n\nDirectSelect.onStop = function() {\n  doubleClickZoom.enable(this);\n  this.clearSelectedCoordinates();\n};\n\nDirectSelect.toDisplayFeatures = function(state, geojson, push) {\n  if (state.featureId === geojson.properties.id) {\n    geojson.properties.active = Constants.activeStates.ACTIVE;\n    push(geojson);\n    createSupplementaryPoints(geojson, {\n      map: this.map,\n      midpoints: true,\n      selectedPaths: state.selectedCoordPaths\n    }).forEach(push);\n  } else {\n    geojson.properties.active = Constants.activeStates.INACTIVE;\n    push(geojson);\n  }\n  this.fireActionable(state);\n};\n\nDirectSelect.onTrash = function(state) {\n  // Uses number-aware sorting to make sure '9' < '10'. Comparison is reversed because we want them\n  // in reverse order so that we can remove by index safely.\n  state.selectedCoordPaths\n    .sort((a, b) => b.localeCompare(a, 'en', { numeric: true }))\n    .forEach(id => state.feature.removeCoordinate(id));\n  this.fireUpdate();\n  state.selectedCoordPaths = [];\n  this.clearSelectedCoordinates();\n  this.fireActionable(state);\n  if (state.feature.isValid() === false) {\n    this.deleteFeature([state.featureId]);\n    this.changeMode(Constants.modes.SIMPLE_SELECT, {});\n  }\n};\n\nDirectSelect.onMouseMove = function(state, e) {\n  // On mousemove that is not a drag, stop vertex movement.\n  const isFeature = isActiveFeature(e);\n  const onVertex = isVertex(e);\n  const isMidPoint = isMidpoint(e);\n  const noCoords = state.selectedCoordPaths.length === 0;\n  if (isFeature && noCoords) this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n  else if (onVertex && !noCoords) this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n  else this.updateUIClasses({ mouse: Constants.cursors.NONE });\n\n  const isDraggableItem = onVertex || isFeature || isMidPoint;\n  if (isDraggableItem && state.dragMoving) this.fireUpdate();\n\n  this.stopDragging(state);\n\n  // Skip render\n  return true;\n};\n\nDirectSelect.onMouseOut = function(state) {\n  // As soon as you mouse leaves the canvas, update the feature\n  if (state.dragMoving) this.fireUpdate();\n\n  // Skip render\n  return true;\n};\n\nDirectSelect.onTouchStart = DirectSelect.onMouseDown = function(state, e) {\n  if (isVertex(e)) return this.onVertex(state, e);\n  if (isActiveFeature(e)) return this.onFeature(state, e);\n  if (isMidpoint(e)) return this.onMidpoint(state, e);\n};\n\nDirectSelect.onDrag = function(state, e) {\n  if (state.canDragMove !== true) return;\n  state.dragMoving = true;\n  e.originalEvent.stopPropagation();\n\n  const delta = {\n    lng: e.lngLat.lng - state.dragMoveLocation.lng,\n    lat: e.lngLat.lat - state.dragMoveLocation.lat\n  };\n  if (state.selectedCoordPaths.length > 0) this.dragVertex(state, e, delta);\n  else this.dragFeature(state, e, delta);\n\n  state.dragMoveLocation = e.lngLat;\n};\n\nDirectSelect.onClick = function(state, e) {\n  if (noTarget(e)) return this.clickNoTarget(state, e);\n  if (isActiveFeature(e)) return this.clickActiveFeature(state, e);\n  if (isInactiveFeature(e)) return this.clickInactive(state, e);\n  this.stopDragging(state);\n};\n\nDirectSelect.onTap = function(state, e) {\n  if (noTarget(e)) return this.clickNoTarget(state, e);\n  if (isActiveFeature(e)) return this.clickActiveFeature(state, e);\n  if (isInactiveFeature(e)) return this.clickInactive(state, e);\n};\n\nDirectSelect.onTouchEnd = DirectSelect.onMouseUp = function(state) {\n  if (state.dragMoving) {\n    this.fireUpdate();\n  }\n  this.stopDragging(state);\n};\n\nexport default DirectSelect;\n\n","import * as CommonSelectors from '../lib/common_selectors.js';\nimport * as Constants from '../constants.js';\n\nconst DrawPoint = {};\n\nDrawPoint.onSetup = function() {\n  const point = this.newFeature({\n    type: Constants.geojsonTypes.FEATURE,\n    properties: {},\n    geometry: {\n      type: Constants.geojsonTypes.POINT,\n      coordinates: []\n    }\n  });\n\n  this.addFeature(point);\n\n  this.clearSelectedFeatures();\n  this.updateUIClasses({ mouse: Constants.cursors.ADD });\n  this.activateUIButton(Constants.types.POINT);\n\n  this.setActionableState({\n    trash: true\n  });\n\n  return { point };\n};\n\nDrawPoint.stopDrawingAndRemove = function(state) {\n  this.deleteFeature([state.point.id], { silent: true });\n  this.changeMode(Constants.modes.SIMPLE_SELECT);\n};\n\nDrawPoint.onTap = DrawPoint.onClick = function(state, e) {\n  this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n  state.point.updateCoordinate('', e.lngLat.lng, e.lngLat.lat);\n  this.fire(Constants.events.CREATE, {\n    features: [state.point.toGeoJSON()]\n  });\n  this.changeMode(Constants.modes.SIMPLE_SELECT, { featureIds: [state.point.id] });\n};\n\nDrawPoint.onStop = function(state) {\n  this.activateUIButton();\n  if (!state.point.getCoordinate().length) {\n    this.deleteFeature([state.point.id], { silent: true });\n  }\n};\n\nDrawPoint.toDisplayFeatures = function(state, geojson, display) {\n  // Never render the point we're drawing\n  const isActivePoint = geojson.properties.id === state.point.id;\n  geojson.properties.active = (isActivePoint) ? Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE;\n  if (!isActivePoint) return display(geojson);\n};\n\nDrawPoint.onTrash = DrawPoint.stopDrawingAndRemove;\n\nDrawPoint.onKeyUp = function(state, e) {\n  if (CommonSelectors.isEscapeKey(e) || CommonSelectors.isEnterKey(e)) {\n    return this.stopDrawingAndRemove(state, e);\n  }\n};\n\nexport default DrawPoint;\n","function isEventAtCoordinates(event, coordinates) {\n  if (!event.lngLat) return false;\n  return event.lngLat.lng === coordinates[0] && event.lngLat.lat === coordinates[1];\n}\n\nexport default isEventAtCoordinates;\n","import * as CommonSelectors from '../lib/common_selectors.js';\nimport doubleClickZoom from '../lib/double_click_zoom.js';\nimport * as Constants from '../constants.js';\nimport isEventAtCoordinates from '../lib/is_event_at_coordinates.js';\nimport createVertex from '../lib/create_vertex.js';\n\nconst DrawPolygon = {};\n\nDrawPolygon.onSetup = function() {\n  const polygon = this.newFeature({\n    type: Constants.geojsonTypes.FEATURE,\n    properties: {},\n    geometry: {\n      type: Constants.geojsonTypes.POLYGON,\n      coordinates: [[]]\n    }\n  });\n\n  this.addFeature(polygon);\n\n  this.clearSelectedFeatures();\n  doubleClickZoom.disable(this);\n  this.updateUIClasses({ mouse: Constants.cursors.ADD });\n  this.activateUIButton(Constants.types.POLYGON);\n  this.setActionableState({\n    trash: true\n  });\n\n  return {\n    polygon,\n    currentVertexPosition: 0\n  };\n};\n\nDrawPolygon.clickAnywhere = function(state, e) {\n  if (state.currentVertexPosition > 0 && isEventAtCoordinates(e, state.polygon.coordinates[0][state.currentVertexPosition - 1])) {\n    return this.changeMode(Constants.modes.SIMPLE_SELECT, { featureIds: [state.polygon.id] });\n  }\n  this.updateUIClasses({ mouse: Constants.cursors.ADD });\n  state.polygon.updateCoordinate(`0.${state.currentVertexPosition}`, e.lngLat.lng, e.lngLat.lat);\n  state.currentVertexPosition++;\n  state.polygon.updateCoordinate(`0.${state.currentVertexPosition}`, e.lngLat.lng, e.lngLat.lat);\n};\n\nDrawPolygon.clickOnVertex = function(state) {\n  return this.changeMode(Constants.modes.SIMPLE_SELECT, { featureIds: [state.polygon.id] });\n};\n\nDrawPolygon.onMouseMove = function(state, e) {\n  state.polygon.updateCoordinate(`0.${state.currentVertexPosition}`, e.lngLat.lng, e.lngLat.lat);\n  if (CommonSelectors.isVertex(e)) {\n    this.updateUIClasses({ mouse: Constants.cursors.POINTER });\n  }\n};\n\nDrawPolygon.onTap = DrawPolygon.onClick = function(state, e) {\n  if (CommonSelectors.isVertex(e)) return this.clickOnVertex(state, e);\n  return this.clickAnywhere(state, e);\n};\n\nDrawPolygon.onKeyUp = function(state, e) {\n  if (CommonSelectors.isEscapeKey(e)) {\n    this.deleteFeature([state.polygon.id], { silent: true });\n    this.changeMode(Constants.modes.SIMPLE_SELECT);\n  } else if (CommonSelectors.isEnterKey(e)) {\n    this.changeMode(Constants.modes.SIMPLE_SELECT, { featureIds: [state.polygon.id] });\n  }\n};\n\nDrawPolygon.onStop = function(state) {\n  this.updateUIClasses({ mouse: Constants.cursors.NONE });\n  doubleClickZoom.enable(this);\n  this.activateUIButton();\n\n  // check to see if we've deleted this feature\n  if (this.getFeature(state.polygon.id) === undefined) return;\n\n  //remove last added coordinate\n  state.polygon.removeCoordinate(`0.${state.currentVertexPosition}`);\n  if (state.polygon.isValid()) {\n    this.fire(Constants.events.CREATE, {\n      features: [state.polygon.toGeoJSON()]\n    });\n  } else {\n    this.deleteFeature([state.polygon.id], { silent: true });\n    this.changeMode(Constants.modes.SIMPLE_SELECT, {}, { silent: true });\n  }\n};\n\nDrawPolygon.toDisplayFeatures = function(state, geojson, display) {\n  const isActivePolygon = geojson.properties.id === state.polygon.id;\n  geojson.properties.active = (isActivePolygon) ? Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE;\n  if (!isActivePolygon) return display(geojson);\n\n  // Don't render a polygon until it has two positions\n  // (and a 3rd which is just the first repeated)\n  if (geojson.geometry.coordinates.length === 0) return;\n\n  const coordinateCount = geojson.geometry.coordinates[0].length;\n  // 2 coordinates after selecting a draw type\n  // 3 after creating the first point\n  if (coordinateCount < 3) {\n    return;\n  }\n  geojson.properties.meta = Constants.meta.FEATURE;\n  display(createVertex(state.polygon.id, geojson.geometry.coordinates[0][0], '0.0', false));\n  if (coordinateCount > 3) {\n    // Add a start position marker to the map, clicking on this will finish the feature\n    // This should only be shown when we're in a valid spot\n    const endPos = geojson.geometry.coordinates[0].length - 3;\n    display(createVertex(state.polygon.id, geojson.geometry.coordinates[0][endPos], `0.${endPos}`, false));\n  }\n  if (coordinateCount <= 4) {\n    // If we've only drawn two positions (plus the closer),\n    // make a LineString instead of a Polygon\n    const lineCoordinates = [\n      [geojson.geometry.coordinates[0][0][0], geojson.geometry.coordinates[0][0][1]], [geojson.geometry.coordinates[0][1][0], geojson.geometry.coordinates[0][1][1]]\n    ];\n    // create an initial vertex so that we can track the first point on mobile devices\n    display({\n      type: Constants.geojsonTypes.FEATURE,\n      properties: geojson.properties,\n      geometry: {\n        coordinates: lineCoordinates,\n        type: Constants.geojsonTypes.LINE_STRING\n      }\n    });\n    if (coordinateCount === 3) {\n      return;\n    }\n  }\n  // render the Polygon\n  return display(geojson);\n};\n\nDrawPolygon.onTrash = function(state) {\n  this.deleteFeature([state.polygon.id], { silent: true });\n  this.changeMode(Constants.modes.SIMPLE_SELECT);\n};\n\nexport default DrawPolygon;\n","import * as CommonSelectors from '../lib/common_selectors.js';\nimport isEventAtCoordinates from '../lib/is_event_at_coordinates.js';\nimport doubleClickZoom from '../lib/double_click_zoom.js';\nimport * as Constants from '../constants.js';\nimport createVertex from '../lib/create_vertex.js';\n\nconst DrawLineString = {};\n\nDrawLineString.onSetup = function(opts) {\n  opts = opts || {};\n  const featureId = opts.featureId;\n\n  let line, currentVertexPosition;\n  let direction = 'forward';\n  if (featureId) {\n    line = this.getFeature(featureId);\n    if (!line) {\n      throw new Error('Could not find a feature with the provided featureId');\n    }\n    let from = opts.from;\n    if (from && from.type === 'Feature' && from.geometry && from.geometry.type === 'Point') {\n      from = from.geometry;\n    }\n    if (from && from.type === 'Point' && from.coordinates && from.coordinates.length === 2) {\n      from = from.coordinates;\n    }\n    if (!from || !Array.isArray(from)) {\n      throw new Error('Please use the `from` property to indicate which point to continue the line from');\n    }\n    const lastCoord = line.coordinates.length - 1;\n    if (line.coordinates[lastCoord][0] === from[0] && line.coordinates[lastCoord][1] === from[1]) {\n      currentVertexPosition = lastCoord + 1;\n      // add one new coordinate to continue from\n      line.addCoordinate(currentVertexPosition, ...line.coordinates[lastCoord]);\n    } else if (line.coordinates[0][0] === from[0] && line.coordinates[0][1] === from[1]) {\n      direction = 'backwards';\n      currentVertexPosition = 0;\n      // add one new coordinate to continue from\n      line.addCoordinate(currentVertexPosition, ...line.coordinates[0]);\n    } else {\n      throw new Error('`from` should match the point at either the start or the end of the provided LineString');\n    }\n  } else {\n    line = this.newFeature({\n      type: Constants.geojsonTypes.FEATURE,\n      properties: {},\n      geometry: {\n        type: Constants.geojsonTypes.LINE_STRING,\n        coordinates: []\n      }\n    });\n    currentVertexPosition = 0;\n    this.addFeature(line);\n  }\n\n  this.clearSelectedFeatures();\n  doubleClickZoom.disable(this);\n  this.updateUIClasses({ mouse: Constants.cursors.ADD });\n  this.activateUIButton(Constants.types.LINE);\n  this.setActionableState({\n    trash: true\n  });\n\n  return {\n    line,\n    currentVertexPosition,\n    direction\n  };\n};\n\nDrawLineString.clickAnywhere = function(state, e) {\n  if (state.currentVertexPosition > 0 && isEventAtCoordinates(e, state.line.coordinates[state.currentVertexPosition - 1]) ||\n      state.direction === 'backwards' && isEventAtCoordinates(e, state.line.coordinates[state.currentVertexPosition + 1])) {\n    return this.changeMode(Constants.modes.SIMPLE_SELECT, { featureIds: [state.line.id] });\n  }\n  this.updateUIClasses({ mouse: Constants.cursors.ADD });\n  state.line.updateCoordinate(state.currentVertexPosition, e.lngLat.lng, e.lngLat.lat);\n  if (state.direction === 'forward') {\n    state.currentVertexPosition++;\n    state.line.updateCoordinate(state.currentVertexPosition, e.lngLat.lng, e.lngLat.lat);\n  } else {\n    state.line.addCoordinate(0, e.lngLat.lng, e.lngLat.lat);\n  }\n};\n\nDrawLineString.clickOnVertex = function(state) {\n  return this.changeMode(Constants.modes.SIMPLE_SELECT, { featureIds: [state.line.id] });\n};\n\nDrawLineString.onMouseMove = function(state, e) {\n  state.line.updateCoordinate(state.currentVertexPosition, e.lngLat.lng, e.lngLat.lat);\n  if (CommonSelectors.isVertex(e)) {\n    this.updateUIClasses({ mouse: Constants.cursors.POINTER });\n  }\n};\n\nDrawLineString.onTap = DrawLineString.onClick = function(state, e) {\n  if (CommonSelectors.isVertex(e)) return this.clickOnVertex(state, e);\n  this.clickAnywhere(state, e);\n};\n\nDrawLineString.onKeyUp = function(state, e) {\n  if (CommonSelectors.isEnterKey(e)) {\n    this.changeMode(Constants.modes.SIMPLE_SELECT, { featureIds: [state.line.id] });\n  } else if (CommonSelectors.isEscapeKey(e)) {\n    this.deleteFeature([state.line.id], { silent: true });\n    this.changeMode(Constants.modes.SIMPLE_SELECT);\n  }\n};\n\nDrawLineString.onStop = function(state) {\n  doubleClickZoom.enable(this);\n  this.activateUIButton();\n\n  // check to see if we've deleted this feature\n  if (this.getFeature(state.line.id) === undefined) return;\n\n  //remove last added coordinate\n  state.line.removeCoordinate(`${state.currentVertexPosition}`);\n  if (state.line.isValid()) {\n    this.fire(Constants.events.CREATE, {\n      features: [state.line.toGeoJSON()]\n    });\n  } else {\n    this.deleteFeature([state.line.id], { silent: true });\n    this.changeMode(Constants.modes.SIMPLE_SELECT, {}, { silent: true });\n  }\n};\n\nDrawLineString.onTrash = function(state) {\n  this.deleteFeature([state.line.id], { silent: true });\n  this.changeMode(Constants.modes.SIMPLE_SELECT);\n};\n\nDrawLineString.toDisplayFeatures = function(state, geojson, display) {\n  const isActiveLine = geojson.properties.id === state.line.id;\n  geojson.properties.active = (isActiveLine) ? Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE;\n  if (!isActiveLine) return display(geojson);\n  // Only render the line if it has at least one real coordinate\n  if (geojson.geometry.coordinates.length < 2) return;\n  geojson.properties.meta = Constants.meta.FEATURE;\n  display(createVertex(\n    state.line.id,\n    geojson.geometry.coordinates[state.direction === 'forward' ? geojson.geometry.coordinates.length - 2 : 1],\n    `${state.direction === 'forward' ? geojson.geometry.coordinates.length - 2 : 1}`,\n    false\n  ));\n\n  display(geojson);\n};\n\nexport default DrawLineString;\n","\nimport simple_select from './simple_select.js';\nimport direct_select from './direct_select.js';\nimport draw_point from './draw_point.js';\nimport draw_polygon from './draw_polygon.js';\nimport draw_line_string from './draw_line_string.js';\n\nexport default {\n  simple_select,\n  direct_select,\n  draw_point,\n  draw_polygon,\n  draw_line_string,\n};\n","import * as Constants from './constants.js';\n\nimport styles from './lib/theme.js';\nimport modes from './modes/index.js';\n\nconst defaultOptions = {\n  defaultMode: Constants.modes.SIMPLE_SELECT,\n  keybindings: true,\n  touchEnabled: true,\n  clickBuffer: 2,\n  touchBuffer: 25,\n  boxSelect: true,\n  displayControlsDefault: true,\n  styles,\n  modes,\n  controls: {},\n  userProperties: false,\n  suppressAPIEvents: true\n};\n\nconst showControls = {\n  point: true,\n  line_string: true,\n  polygon: true,\n  trash: true,\n  combine_features: true,\n  uncombine_features: true\n};\n\nconst hideControls = {\n  point: false,\n  line_string: false,\n  polygon: false,\n  trash: false,\n  combine_features: false,\n  uncombine_features: false\n};\n\nfunction addSources(styles, sourceBucket) {\n  return styles.map((style) => {\n    if (style.source) return style;\n    return Object.assign({}, style, {\n      id: `${style.id}.${sourceBucket}`,\n      source: (sourceBucket === 'hot') ? Constants.sources.HOT : Constants.sources.COLD\n    });\n  });\n}\n\nexport default function(options = {}) {\n  let withDefaults = Object.assign({}, options);\n\n  if (!options.controls) {\n    withDefaults.controls = {};\n  }\n\n  if (options.displayControlsDefault === false) {\n    withDefaults.controls = Object.assign({}, hideControls, options.controls);\n  } else {\n    withDefaults.controls = Object.assign({}, showControls, options.controls);\n  }\n\n  withDefaults = Object.assign({}, defaultOptions, withDefaults);\n\n  // Layers with a shared source should be adjacent for performance reasons\n  withDefaults.styles = addSources(withDefaults.styles, 'cold').concat(addSources(withDefaults.styles, 'hot'));\n\n  return withDefaults;\n}\n","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","module.exports = normalize;\n\nvar types = {\n    Point: 'geometry',\n    MultiPoint: 'geometry',\n    LineString: 'geometry',\n    MultiLineString: 'geometry',\n    Polygon: 'geometry',\n    MultiPolygon: 'geometry',\n    GeometryCollection: 'geometry',\n    Feature: 'feature',\n    FeatureCollection: 'featurecollection'\n};\n\n/**\n * Normalize a GeoJSON feature into a FeatureCollection.\n *\n * @param {object} gj geojson data\n * @returns {object} normalized geojson data\n */\nfunction normalize(gj) {\n    if (!gj || !gj.type) return null;\n    var type = types[gj.type];\n    if (!type) return null;\n\n    if (type === 'geometry') {\n        return {\n            type: 'FeatureCollection',\n            features: [{\n                type: 'Feature',\n                properties: {},\n                geometry: gj\n            }]\n        };\n    } else if (type === 'feature') {\n        return {\n            type: 'FeatureCollection',\n            features: [gj]\n        };\n    } else if (type === 'featurecollection') {\n        return gj;\n    }\n}\n","export default function(a, b) {\n  if (a.length !== b.length) return false;\n  return JSON.stringify(a.map(id => id).sort()) === JSON.stringify(b.map(id => id).sort());\n}\n","import isEqual from 'fast-deep-equal';\nimport normalize from '@mapbox/geojson-normalize';\nimport {generateID} from './lib/id.js';\nimport featuresAt from './lib/features_at.js';\nimport stringSetsAreEqual from './lib/string_sets_are_equal.js';\nimport * as Constants from './constants.js';\nimport StringSet from './lib/string_set.js';\n\nimport Polygon from './feature_types/polygon.js';\nimport LineString from './feature_types/line_string.js';\nimport Point from './feature_types/point.js';\nimport MultiFeature from './feature_types/multi_feature.js';\n\nconst featureTypes = {\n  Polygon,\n  LineString,\n  Point,\n  MultiPolygon: MultiFeature,\n  MultiLineString: MultiFeature,\n  MultiPoint: MultiFeature\n};\n\nexport default function(ctx, api) {\n  api.modes = Constants.modes;\n\n  // API doesn't emit events by default\n  const silent = ctx.options.suppressAPIEvents !== undefined ? !!ctx.options.suppressAPIEvents : true;\n\n  api.getFeatureIdsAt = function(point) {\n    const features = featuresAt.click({ point }, null, ctx);\n    return features.map(feature => feature.properties.id);\n  };\n\n  api.getSelectedIds = function() {\n    return ctx.store.getSelectedIds();\n  };\n\n  api.getSelected = function() {\n    return {\n      type: Constants.geojsonTypes.FEATURE_COLLECTION,\n      features: ctx.store.getSelectedIds().map(id => ctx.store.get(id)).map(feature => feature.toGeoJSON())\n    };\n  };\n\n  api.getSelectedPoints = function() {\n    return {\n      type: Constants.geojsonTypes.FEATURE_COLLECTION,\n      features: ctx.store.getSelectedCoordinates().map(coordinate => ({\n        type: Constants.geojsonTypes.FEATURE,\n        properties: {},\n        geometry: {\n          type: Constants.geojsonTypes.POINT,\n          coordinates: coordinate.coordinates\n        }\n      }))\n    };\n  };\n\n  api.set = function(featureCollection) {\n    if (featureCollection.type === undefined || featureCollection.type !== Constants.geojsonTypes.FEATURE_COLLECTION || !Array.isArray(featureCollection.features)) {\n      throw new Error('Invalid FeatureCollection');\n    }\n    const renderBatch = ctx.store.createRenderBatch();\n    let toDelete = ctx.store.getAllIds().slice();\n    const newIds = api.add(featureCollection);\n    const newIdsLookup = new StringSet(newIds);\n\n    toDelete = toDelete.filter(id => !newIdsLookup.has(id));\n    if (toDelete.length) {\n      api.delete(toDelete);\n    }\n\n    renderBatch();\n    return newIds;\n  };\n\n  api.add = function(geojson) {\n    const featureCollection = JSON.parse(JSON.stringify(normalize(geojson)));\n\n    const ids = featureCollection.features.map((feature) => {\n      feature.id = feature.id || generateID();\n\n      if (feature.geometry === null) {\n        throw new Error('Invalid geometry: null');\n      }\n\n      if (ctx.store.get(feature.id) === undefined || ctx.store.get(feature.id).type !== feature.geometry.type) {\n        // If the feature has not yet been created ...\n        const Model = featureTypes[feature.geometry.type];\n        if (Model === undefined) {\n          throw new Error(`Invalid geometry type: ${feature.geometry.type}.`);\n        }\n        const internalFeature = new Model(ctx, feature);\n        ctx.store.add(internalFeature, { silent });\n      } else {\n        // If a feature of that id has already been created, and we are swapping it out ...\n        const internalFeature = ctx.store.get(feature.id);\n        const originalProperties = internalFeature.properties;\n        internalFeature.properties = feature.properties;\n        if (!isEqual(originalProperties, feature.properties)) {\n          ctx.store.featureChanged(internalFeature.id, { silent });\n        }\n        if (!isEqual(internalFeature.getCoordinates(), feature.geometry.coordinates)) {\n          internalFeature.incomingCoords(feature.geometry.coordinates);\n        }\n      }\n      return feature.id;\n    });\n\n    ctx.store.render();\n    return ids;\n  };\n\n\n  api.get = function(id) {\n    const feature = ctx.store.get(id);\n    if (feature) {\n      return feature.toGeoJSON();\n    }\n  };\n\n  api.getAll = function() {\n    return {\n      type: Constants.geojsonTypes.FEATURE_COLLECTION,\n      features: ctx.store.getAll().map(feature => feature.toGeoJSON())\n    };\n  };\n\n  api.delete = function(featureIds) {\n    ctx.store.delete(featureIds, { silent });\n    // If we were in direct select mode and our selected feature no longer exists\n    // (because it was deleted), we need to get out of that mode.\n    if (api.getMode() === Constants.modes.DIRECT_SELECT && !ctx.store.getSelectedIds().length) {\n      ctx.events.changeMode(Constants.modes.SIMPLE_SELECT, undefined, { silent });\n    } else {\n      ctx.store.render();\n    }\n\n    return api;\n  };\n\n  api.deleteAll = function() {\n    ctx.store.delete(ctx.store.getAllIds(), { silent });\n    // If we were in direct select mode, now our selected feature no longer exists,\n    // so escape that mode.\n    if (api.getMode() === Constants.modes.DIRECT_SELECT) {\n      ctx.events.changeMode(Constants.modes.SIMPLE_SELECT, undefined, { silent });\n    } else {\n      ctx.store.render();\n    }\n\n    return api;\n  };\n\n  api.changeMode = function(mode, modeOptions = {}) {\n    // Avoid changing modes just to re-select what's already selected\n    if (mode === Constants.modes.SIMPLE_SELECT && api.getMode() === Constants.modes.SIMPLE_SELECT) {\n      if (stringSetsAreEqual((modeOptions.featureIds || []), ctx.store.getSelectedIds())) return api;\n      // And if we are changing the selection within simple_select mode, just change the selection,\n      // instead of stopping and re-starting the mode\n      ctx.store.setSelected(modeOptions.featureIds, { silent });\n      ctx.store.render();\n      return api;\n    }\n\n    if (mode === Constants.modes.DIRECT_SELECT && api.getMode() === Constants.modes.DIRECT_SELECT &&\n      modeOptions.featureId === ctx.store.getSelectedIds()[0]) {\n      return api;\n    }\n\n    ctx.events.changeMode(mode, modeOptions, { silent });\n    return api;\n  };\n\n  api.getMode = function() {\n    return ctx.events.getMode();\n  };\n\n  api.trash = function() {\n    ctx.events.trash({ silent });\n    return api;\n  };\n\n  api.combineFeatures = function() {\n    ctx.events.combineFeatures({ silent });\n    return api;\n  };\n\n  api.uncombineFeatures = function() {\n    ctx.events.uncombineFeatures({ silent });\n    return api;\n  };\n\n  api.setFeatureProperty = function(featureId, property, value) {\n    ctx.store.setFeatureProperty(featureId, property, value, { silent });\n    return api;\n  };\n\n  return api;\n}\n","import runSetup from './src/setup.js';\nimport setupOptions from './src/options.js';\nimport setupAPI from './src/api.js';\nimport modes from './src/modes/index.js';\nimport * as Constants from './src/constants.js';\nimport * as lib from './src/lib/index.js';\n\nconst setupDraw = function(options, api) {\n  options = setupOptions(options);\n\n  const ctx = {\n    options\n  };\n\n  api = setupAPI(ctx, api);\n  ctx.api = api;\n\n  const setup = runSetup(ctx);\n\n  api.onAdd = setup.onAdd;\n  api.onRemove = setup.onRemove;\n  api.types = Constants.types;\n  api.options = options;\n\n  return api;\n};\n\nfunction MapboxDraw(options) {\n  setupDraw(options, this);\n}\n\nMapboxDraw.modes = modes;\nMapboxDraw.constants = Constants;\nMapboxDraw.lib = lib;\n\nexport default MapboxDraw;\n","// index.ts\nimport { isNumber } from \"@turf/helpers\";\nfunction getCoord(coord) {\n  if (!coord) {\n    throw new Error(\"coord is required\");\n  }\n  if (!Array.isArray(coord)) {\n    if (coord.type === \"Feature\" && coord.geometry !== null && coord.geometry.type === \"Point\") {\n      return [...coord.geometry.coordinates];\n    }\n    if (coord.type === \"Point\") {\n      return [...coord.coordinates];\n    }\n  }\n  if (Array.isArray(coord) && coord.length >= 2 && !Array.isArray(coord[0]) && !Array.isArray(coord[1])) {\n    return [...coord];\n  }\n  throw new Error(\"coord must be GeoJSON Point or an Array of numbers\");\n}\nfunction getCoords(coords) {\n  if (Array.isArray(coords)) {\n    return coords;\n  }\n  if (coords.type === \"Feature\") {\n    if (coords.geometry !== null) {\n      return coords.geometry.coordinates;\n    }\n  } else {\n    if (coords.coordinates) {\n      return coords.coordinates;\n    }\n  }\n  throw new Error(\n    \"coords must be GeoJSON Feature, Geometry Object or an Array\"\n  );\n}\nfunction containsNumber(coordinates) {\n  if (coordinates.length > 1 && isNumber(coordinates[0]) && isNumber(coordinates[1])) {\n    return true;\n  }\n  if (Array.isArray(coordinates[0]) && coordinates[0].length) {\n    return containsNumber(coordinates[0]);\n  }\n  throw new Error(\"coordinates must only contain numbers\");\n}\nfunction geojsonType(value, type, name) {\n  if (!type || !name) {\n    throw new Error(\"type and name required\");\n  }\n  if (!value || value.type !== type) {\n    throw new Error(\n      \"Invalid input to \" + name + \": must be a \" + type + \", given \" + value.type\n    );\n  }\n}\nfunction featureOf(feature, type, name) {\n  if (!feature) {\n    throw new Error(\"No feature passed\");\n  }\n  if (!name) {\n    throw new Error(\".featureOf() requires a name\");\n  }\n  if (!feature || feature.type !== \"Feature\" || !feature.geometry) {\n    throw new Error(\n      \"Invalid input to \" + name + \", Feature with geometry required\"\n    );\n  }\n  if (!feature.geometry || feature.geometry.type !== type) {\n    throw new Error(\n      \"Invalid input to \" + name + \": must be a \" + type + \", given \" + feature.geometry.type\n    );\n  }\n}\nfunction collectionOf(featureCollection, type, name) {\n  if (!featureCollection) {\n    throw new Error(\"No featureCollection passed\");\n  }\n  if (!name) {\n    throw new Error(\".collectionOf() requires a name\");\n  }\n  if (!featureCollection || featureCollection.type !== \"FeatureCollection\") {\n    throw new Error(\n      \"Invalid input to \" + name + \", FeatureCollection required\"\n    );\n  }\n  for (const feature of featureCollection.features) {\n    if (!feature || feature.type !== \"Feature\" || !feature.geometry) {\n      throw new Error(\n        \"Invalid input to \" + name + \", Feature with geometry required\"\n      );\n    }\n    if (!feature.geometry || feature.geometry.type !== type) {\n      throw new Error(\n        \"Invalid input to \" + name + \": must be a \" + type + \", given \" + feature.geometry.type\n      );\n    }\n  }\n}\nfunction getGeom(geojson) {\n  if (geojson.type === \"Feature\") {\n    return geojson.geometry;\n  }\n  return geojson;\n}\nfunction getType(geojson, _name) {\n  if (geojson.type === \"FeatureCollection\") {\n    return \"FeatureCollection\";\n  }\n  if (geojson.type === \"GeometryCollection\") {\n    return \"GeometryCollection\";\n  }\n  if (geojson.type === \"Feature\" && geojson.geometry !== null) {\n    return geojson.geometry.type;\n  }\n  return geojson.type;\n}\nexport {\n  collectionOf,\n  containsNumber,\n  featureOf,\n  geojsonType,\n  getCoord,\n  getCoords,\n  getGeom,\n  getType\n};\n//# sourceMappingURL=index.js.map","// index.ts\nimport { getCoord } from \"@turf/invariant\";\nimport { radiansToLength, degreesToRadians } from \"@turf/helpers\";\nfunction distance(from, to, options = {}) {\n  var coordinates1 = getCoord(from);\n  var coordinates2 = getCoord(to);\n  var dLat = degreesToRadians(coordinates2[1] - coordinates1[1]);\n  var dLon = degreesToRadians(coordinates2[0] - coordinates1[0]);\n  var lat1 = degreesToRadians(coordinates1[1]);\n  var lat2 = degreesToRadians(coordinates2[1]);\n  var a = Math.pow(Math.sin(dLat / 2), 2) + Math.pow(Math.sin(dLon / 2), 2) * Math.cos(lat1) * Math.cos(lat2);\n  return radiansToLength(\n    2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)),\n    options.units\n  );\n}\nvar index_default = distance;\nexport {\n  index_default as default,\n  distance\n};\n//# sourceMappingURL=index.js.map","// index.ts\nimport { earthRadius } from \"@turf/helpers\";\nimport { geomReduce } from \"@turf/meta\";\nfunction area(geojson) {\n  return geomReduce(\n    geojson,\n    (value, geom) => {\n      return value + calculateArea(geom);\n    },\n    0\n  );\n}\nfunction calculateArea(geom) {\n  let total = 0;\n  let i;\n  switch (geom.type) {\n    case \"Polygon\":\n      return polygonArea(geom.coordinates);\n    case \"MultiPolygon\":\n      for (i = 0; i < geom.coordinates.length; i++) {\n        total += polygonArea(geom.coordinates[i]);\n      }\n      return total;\n    case \"Point\":\n    case \"MultiPoint\":\n    case \"LineString\":\n    case \"MultiLineString\":\n      return 0;\n  }\n  return 0;\n}\nfunction polygonArea(coords) {\n  let total = 0;\n  if (coords && coords.length > 0) {\n    total += Math.abs(ringArea(coords[0]));\n    for (let i = 1; i < coords.length; i++) {\n      total -= Math.abs(ringArea(coords[i]));\n    }\n  }\n  return total;\n}\nvar FACTOR = earthRadius * earthRadius / 2;\nvar PI_OVER_180 = Math.PI / 180;\nfunction ringArea(coords) {\n  const coordsLength = coords.length - 1;\n  if (coordsLength <= 2) return 0;\n  let total = 0;\n  let i = 0;\n  while (i < coordsLength) {\n    const lower = coords[i];\n    const middle = coords[i + 1 === coordsLength ? 0 : i + 1];\n    const upper = coords[i + 2 >= coordsLength ? (i + 2) % coordsLength : i + 2];\n    const lowerX = lower[0] * PI_OVER_180;\n    const middleY = middle[1] * PI_OVER_180;\n    const upperX = upper[0] * PI_OVER_180;\n    total += (upperX - lowerX) * Math.sin(middleY);\n    i++;\n  }\n  return total * FACTOR;\n}\nvar index_default = area;\nexport {\n  area,\n  index_default as default\n};\n//# sourceMappingURL=index.js.map","// index.ts\nimport { featureCollection, lineString } from \"@turf/helpers\";\nimport { getCoords } from \"@turf/invariant\";\nimport { flattenEach } from \"@turf/meta\";\nfunction lineSegment(geojson) {\n  if (!geojson) {\n    throw new Error(\"geojson is required\");\n  }\n  const results = [];\n  flattenEach(geojson, (feature) => {\n    lineSegmentFeature(feature, results);\n  });\n  return featureCollection(results);\n}\nfunction lineSegmentFeature(geojson, results) {\n  let coords = [];\n  const geometry = geojson.geometry;\n  if (geometry !== null) {\n    switch (geometry.type) {\n      case \"Polygon\":\n        coords = getCoords(geometry);\n        break;\n      case \"LineString\":\n        coords = [getCoords(geometry)];\n    }\n    coords.forEach((coord) => {\n      const segments = createSegments(coord, geojson.properties);\n      segments.forEach((segment) => {\n        segment.id = results.length;\n        results.push(segment);\n      });\n    });\n  }\n}\nfunction createSegments(coords, properties) {\n  const segments = [];\n  coords.reduce((previousCoords, currentCoords) => {\n    const segment = lineString([previousCoords, currentCoords], properties);\n    segment.bbox = bbox(previousCoords, currentCoords);\n    segments.push(segment);\n    return currentCoords;\n  });\n  return segments;\n}\nfunction bbox(coords1, coords2) {\n  const x1 = coords1[0];\n  const y1 = coords1[1];\n  const x2 = coords2[0];\n  const y2 = coords2[1];\n  const west = x1 < x2 ? x1 : x2;\n  const south = y1 < y2 ? y1 : y2;\n  const east = x1 > x2 ? x1 : x2;\n  const north = y1 > y2 ? y1 : y2;\n  return [west, south, east, north];\n}\nvar index_default = lineSegment;\nexport {\n  index_default as default,\n  lineSegment\n};\n//# sourceMappingURL=index.js.map","// index.ts\nimport { point } from \"@turf/helpers\";\nimport { coordEach } from \"@turf/meta\";\nfunction centroid(geojson, options = {}) {\n  let xSum = 0;\n  let ySum = 0;\n  let len = 0;\n  coordEach(\n    geojson,\n    function(coord) {\n      xSum += coord[0];\n      ySum += coord[1];\n      len++;\n    },\n    true\n  );\n  return point([xSum / len, ySum / len], options.properties);\n}\nvar index_default = centroid;\nexport {\n  centroid,\n  index_default as default\n};\n//# sourceMappingURL=index.js.map","// index.ts\nimport { distance } from \"@turf/distance\";\nimport { segmentReduce } from \"@turf/meta\";\nfunction length(geojson, options = {}) {\n  return segmentReduce(\n    geojson,\n    (previousValue, segment) => {\n      const coords = segment.geometry.coordinates;\n      return previousValue + distance(coords[0], coords[1], options);\n    },\n    0\n  );\n}\nvar index_default = length;\nexport {\n  index_default as default,\n  length\n};\n//# sourceMappingURL=index.js.map","const lengthUnits = {\n\tmm: { system: 'metric', toBase: 0.001 },\n\tcm: { system: 'metric', toBase: 0.01 },\n\tm: { system: 'metric', toBase: 1 },\n\tkm: { system: 'metric', toBase: 1000 },\n\tin: { system: 'imperial', toBase: 0.0254 },\n\tft: { system: 'imperial', toBase: 0.3048 },\n\tyd: { system: 'imperial', toBase: 0.9144 },\n\tmi: { system: 'imperial', toBase: 1609.344 },\n};\n\nconst areaUnits = {\n\tmm2: { system: 'metric', toBase: 0.000001 },\n\tcm2: { system: 'metric', toBase: 0.0001 },\n\tm2: { system: 'metric', toBase: 1 },\n\tkm2: { system: 'metric', toBase: 1000000 },\n\tha: { system: 'metric', toBase: 10000 },\n\tin2: { system: 'imperial', toBase: 0.00064516 },\n\tft2: { system: 'imperial', toBase: 0.092903 },\n\tyd2: { system: 'imperial', toBase: 0.836127 },\n\tac: { system: 'imperial', toBase: 4046.8564224 },\n\tmi2: { system: 'imperial', toBase: 2589988.110336 },\n};\n\nconst allUnits = {\n\t...lengthUnits,\n\t...areaUnits,\n};\n\nexport default function convert(value) {\n\treturn {\n\t\tfrom: function (fromUnit) {\n\t\t\tconst fromUnitData = allUnits[fromUnit];\n\t\t\tif (!fromUnitData) {\n\t\t\t\tthrow new Error(`Unknown unit: ${fromUnit}`);\n\t\t\t}\n\n\t\t\tconst baseValue = value * fromUnitData.toBase;\n\n\t\t\treturn {\n\t\t\t\tto: function (toUnit) {\n\t\t\t\t\tconst toUnitData = allUnits[toUnit];\n\t\t\t\t\tif (!toUnitData) {\n\t\t\t\t\t\tthrow new Error(`Unknown unit: ${toUnit}`);\n\t\t\t\t\t}\n\t\t\t\t\treturn baseValue / toUnitData.toBase;\n\t\t\t\t},\n\t\t\t\ttoBest: function (options = {}) {\n\t\t\t\t\tconst system = options.system;\n\t\t\t\t\tconst isArea = fromUnit.endsWith('2');\n\n\t\t\t\t\tif (isArea) {\n\t\t\t\t\t\tif (system === 'imperial') {\n\t\t\t\t\t\t\tconst ft2Value = baseValue / areaUnits.ft2.toBase;\n\t\t\t\t\t\t\tif (ft2Value < 43560) {\n\t\t\t\t\t\t\t\treturn { val: ft2Value, unit: 'ft2' };\n\t\t\t\t\t\t\t} else if (ft2Value < 6272640) {\n\t\t\t\t\t\t\t\tconst acValue = baseValue / 4046.8564224;\n\t\t\t\t\t\t\t\treturn { val: acValue, unit: 'ac' };\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst mi2Value = baseValue / areaUnits.mi2.toBase;\n\t\t\t\t\t\t\t\treturn { val: mi2Value, unit: 'mi2' };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst m2Value = baseValue;\n\t\t\t\t\t\t\tif (m2Value < 10000) {\n\t\t\t\t\t\t\t\treturn { val: m2Value, unit: 'm2' };\n\t\t\t\t\t\t\t} else if (m2Value < 1000000) {\n\t\t\t\t\t\t\t\tconst haValue = baseValue / areaUnits.ha.toBase;\n\t\t\t\t\t\t\t\treturn { val: haValue, unit: 'ha' };\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst km2Value = baseValue / areaUnits.km2.toBase;\n\t\t\t\t\t\t\t\treturn { val: km2Value, unit: 'km2' };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (system === 'imperial') {\n\t\t\t\t\t\t\tconst ftValue = baseValue / lengthUnits.ft.toBase;\n\t\t\t\t\t\t\tif (ftValue < 5280) {\n\t\t\t\t\t\t\t\treturn { val: ftValue, unit: 'ft' };\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst miValue = baseValue / lengthUnits.mi.toBase;\n\t\t\t\t\t\t\t\treturn { val: miValue, unit: 'mi' };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst mValue = baseValue;\n\t\t\t\t\t\t\tif (mValue < 1000) {\n\t\t\t\t\t\t\t\treturn { val: mValue, unit: 'm' };\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst kmValue = baseValue / lengthUnits.km.toBase;\n\t\t\t\t\t\t\t\treturn { val: kmValue, unit: 'km' };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t};\n}\n","import MapboxDraw from '@mapbox/mapbox-gl-draw';\nimport * as turf from '@turf/turf';\nimport convert from './convert-units.js';\n\nconst DRAW_LABELS_SOURCE_ID = 'source-draw-labels';\nconst DRAW_LABELS_LAYER_ID = 'layer-draw-labels';\nconst SOURCE_DATA = {\n\ttype: 'FeatureCollection',\n\tfeatures: [],\n};\n\nexport default class MeasuresControl {\n\tconstructor(options) {\n\t\tthis.options = options;\n\t\tthis._drawCtrl = new MapboxDraw({\n\t\t\tdisplayControlsDefault: false,\n\t\t\tstyles: [\n\t\t\t\t// ACTIVE (being drawn)\n\t\t\t\t// line stroke\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-line',\n\t\t\t\t\ttype: 'line',\n\t\t\t\t\tfilter: ['all', ['==', '$type', 'LineString'], ['!=', 'mode', 'static']],\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\t'line-cap': 'round',\n\t\t\t\t\t\t'line-join': 'round',\n\t\t\t\t\t},\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'line-color': this.options?.style?.lengthMeasurement?.lineColor ?? '#D20C0C',\n\t\t\t\t\t\t'line-dasharray': [0.2, 2],\n\t\t\t\t\t\t'line-width': this.options?.style?.lengthMeasurement?.lineWidth ?? 2,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t// polygon fill\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-polygon-fill',\n\t\t\t\t\ttype: 'fill',\n\t\t\t\t\tfilter: ['all', ['==', '$type', 'Polygon'], ['!=', 'mode', 'static']],\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'fill-color': this.options?.style?.areaMeasurement?.fillColor ?? '#D20C0C',\n\t\t\t\t\t\t'fill-outline-color': this.options?.style?.areaMeasurement?.fillOutlineColor ?? '#D20C0C',\n\t\t\t\t\t\t'fill-opacity': this.options?.style?.areaMeasurement?.fillOpacity ?? 0.1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t// polygon mid points\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-polygon-midpoint',\n\t\t\t\t\ttype: 'circle',\n\t\t\t\t\tfilter: ['all', ['==', '$type', 'Point'], ['==', 'meta', 'midpoint']],\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'circle-radius': this.options?.style?.common?.midPointRadius ?? 3,\n\t\t\t\t\t\t'circle-color': this.options?.style?.common?.midPointColor ?? '#fbb03b',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t// polygon outline stroke\n\t\t\t\t// This doesn't style the first edge of the polygon, which uses the line stroke styling instead\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-polygon-stroke-active',\n\t\t\t\t\ttype: 'line',\n\t\t\t\t\tfilter: ['all', ['==', '$type', 'Polygon'], ['!=', 'mode', 'static']],\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\t'line-cap': 'round',\n\t\t\t\t\t\t'line-join': 'round',\n\t\t\t\t\t},\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'line-color': this.options?.style?.areaMeasurement?.fillOutlineColor ?? '#D20C0C',\n\t\t\t\t\t\t'line-dasharray': [0.2, 2],\n\t\t\t\t\t\t'line-width': this.options?.style?.areaMeasurement?.lineWidth ?? 2,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t// vertex point halos\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-polygon-and-line-vertex-halo-active',\n\t\t\t\t\ttype: 'circle',\n\t\t\t\t\tfilter: ['all', ['==', 'meta', 'vertex'], ['==', '$type', 'Point'], ['!=', 'mode', 'static']],\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'circle-radius': this.options?.style?.common?.midPointHaloRadius ?? 3,\n\t\t\t\t\t\t'circle-color': this.options?.style?.common?.midPointHaloColor ?? '#FFF',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t// vertex points\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-polygon-and-line-vertex-active',\n\t\t\t\t\ttype: 'circle',\n\t\t\t\t\tfilter: ['all', ['==', 'meta', 'vertex'], ['==', '$type', 'Point'], ['!=', 'mode', 'static']],\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'circle-radius': this.options?.style?.common?.midPointRadius ?? 3,\n\t\t\t\t\t\t'circle-color': this.options?.style?.common?.midPointColor ?? '#fbb03b',\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t// INACTIVE (static, already drawn)\n\t\t\t\t// line stroke\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-line-static',\n\t\t\t\t\ttype: 'line',\n\t\t\t\t\tfilter: ['all', ['==', '$type', 'LineString'], ['==', 'mode', 'static']],\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\t'line-cap': 'round',\n\t\t\t\t\t\t'line-join': 'round',\n\t\t\t\t\t},\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'line-color': this.options?.style?.lengthMeasurement?.lineColor ?? '#D20C0C',\n\t\t\t\t\t\t'line-width': this.options?.style?.lengthMeasurement?.lineWidth ?? 3,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t// polygon fill\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-polygon-fill-static',\n\t\t\t\t\ttype: 'fill',\n\t\t\t\t\tfilter: ['all', ['==', '$type', 'Polygon'], ['==', 'mode', 'static']],\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'fill-color': this.options?.style?.areaMeasurement?.fillColor ?? '#000',\n\t\t\t\t\t\t'fill-outline-color': this.options?.style?.areaMeasurement?.fillOutlineColor ?? '#000',\n\t\t\t\t\t\t'fill-opacity': this.options?.style?.areaMeasurement?.fillOpacity ?? 0.1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t// polygon outline\n\t\t\t\t{\n\t\t\t\t\tid: 'gl-draw-polygon-stroke-static',\n\t\t\t\t\ttype: 'line',\n\t\t\t\t\tfilter: ['all', ['==', '$type', 'Polygon'], ['==', 'mode', 'static']],\n\t\t\t\t\tlayout: {\n\t\t\t\t\t\t'line-cap': 'round',\n\t\t\t\t\t\t'line-join': 'round',\n\t\t\t\t\t},\n\t\t\t\t\tpaint: {\n\t\t\t\t\t\t'line-color': this.options?.style?.areaMeasurement?.fillOutlineColor ?? '#000',\n\t\t\t\t\t\t'line-width': this.options?.style?.areaMeasurement?.lineWidth ?? 2,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\tonAdd(map) {\n\t\tthis._map = map;\n\t\tthis._map.addControl(this._drawCtrl, 'top-left');\n\t\tthis._initControl();\n\t\tthis._registerEvents();\n\t\treturn this._container;\n\t}\n\n\t_initControl() {\n\t\tthis._container = document.createElement('div');\n\t\tthis._container.className = 'maplibregl-ctrl mapboxgl-ctrl maplibregl-measures maplibregl-ctrl-group mapboxgl-ctrl-group';\n\n\t\tthis.initDrawBtn(this._drawCtrl.modes.DRAW_LINE_STRING);\n\t\tthis.initDrawBtn(this._drawCtrl.modes.DRAW_POLYGON);\n\t\tthis.initClearBtn();\n\t}\n\n\t_formatMeasure(dist, isAreaMeasurement = false) {\n\t\tif (this.options?.units === 'imperial') {\n\t\t\treturn isAreaMeasurement ? this._formatAreaToImperialSystem(dist) : this._formatToImperialSystem(dist);\n\t\t} else {\n\t\t\treturn isAreaMeasurement ? this._formatAreaToMetricSystem(dist) : this._formatToMetricSystem(dist);\n\t\t}\n\t}\n\n\t// area in sqm\n\t_formatAreaToMetricSystem(dist) {\n\t\tlet measure;\n\t\tlet unit;\n\t\tif (this.options?.fixedAreaUnit) {\n\t\t\tmeasure = convert(dist).from('m2').to(this.options.fixedAreaUnit);\n\t\t\tunit = this.options.fixedAreaUnit;\n\t\t} else {\n\t\t\tmeasure = convert(dist).from('m2').toBest({ system: 'metric' });\n\t\t\tunit = measure.unit;\n\t\t}\n\t\tlet val = this._getLocaleNumber(measure.val || measure);\n\t\treturn `${val} ${unit.replaceAll('2', '')}`;\n\t}\n\n\t// area in sqm\n\t_formatAreaToImperialSystem(dist) {\n\t\tlet measure;\n\t\tlet unit;\n\t\tif (this.options?.fixedAreaUnit) {\n\t\t\tmeasure = convert(dist).from('m2').to(this.options.fixedAreaUnit);\n\t\t\tunit = this.options.fixedAreaUnit;\n\t\t} else {\n\t\t\tmeasure = convert(dist).from('m2').to('mi2');\n\t\t\tmeasure = convert(measure).from('mi2').toBest({ system: 'imperial' });\n\t\t\tunit = measure.unit;\n\t\t}\n\t\tlet val = this._getLocaleNumber(measure.val || measure);\n\t\treturn `${val} ${unit.replaceAll('2', '')}`;\n\t}\n\n\t_formatToMetricSystem(dist) {\n\t\tlet measure;\n\t\tlet unit;\n\t\tif (this.options?.fixedLengthUnit) {\n\t\t\tmeasure = convert(dist).from('m').to(this.options.fixedLengthUnit);\n\t\t\tunit = this.options.fixedLengthUnit;\n\t\t} else {\n\t\t\tmeasure = convert(dist).from('m').toBest({ system: 'metric' });\n\t\t\tunit = measure.unit;\n\t\t}\n\t\tlet val = this._getLocaleNumber(measure.val || measure);\n\t\treturn `${val} ${unit}`;\n\t}\n\n\t_formatToImperialSystem(dist) {\n\t\tlet measure;\n\t\tlet unit;\n\t\tif (this.options?.fixedLengthUnit) {\n\t\t\tmeasure = convert(dist).from('m').to(this.options.fixedLengthUnit);\n\t\t\tunit = this.options.fixedLengthUnit;\n\t\t} else {\n\t\t\tmeasure = convert(dist).from('m').to('mi');\n\t\t\tmeasure = convert(measure).from('mi').toBest({ system: 'imperial' });\n\t\t\tunit = measure.unit;\n\t\t}\n\t\tlet val = this._getLocaleNumber(measure.val || measure);\n\t\treturn `${val} ${unit}`;\n\t}\n\n\t_getLocaleNumber(val) {\n\t\tlet num = typeof val === 'number' ? val : val.val !== undefined ? val.val : val;\n\n\t\tlet formattedNumber = num.toLocaleString(undefined, {\n\t\t\tminimumFractionDigits: this.options?.minimumFractionDigits ?? 2,\n\t\t\tmaximumFractionDigits: this.options?.maximumFractionDigits ?? 2,\n\t\t\tuseGrouping: !this.options?.unitsGroupingSeparator,\n\t\t});\n\n\t\tlet groupingSeparator = this.options?.unitsGroupingSeparator;\n\t\tif (groupingSeparator) {\n\t\t\tformattedNumber = formattedNumber.replace(/\\B(?=(\\d{3})+(?!\\d))/g, groupingSeparator);\n\t\t}\n\n\t\treturn formattedNumber;\n\t}\n\n\tinitDrawBtn(mode) {\n\t\tlet btn = document.createElement('button');\n\t\tbtn.type = 'button';\n\t\tswitch (mode) {\n\t\t\tcase this._drawCtrl.modes.DRAW_LINE_STRING:\n\t\t\t\tbtn.title = this.options?.lang?.lengthMeasurementButtonTitle ?? '';\n\t\t\t\tbtn.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" \n                viewBox=\"0 0 512 512\" xml:space=\"preserve\" style=\"padding:4px\">\n               <path d=\"M503.467,0h-51.2c-4.71,0-8.533,3.814-8.533,8.533v51.2c0,4.719,3.823,8.533,8.533,8.533h16.077\n                   c-15.027,136.132-31.095,243.354-75.81,275.678V332.8c0-4.719-3.823-8.533-8.533-8.533h-51.2c-4.71,0-8.533,3.814-8.533,8.533\n                   v9.207c-24.226-20.591-47.59-60.45-70.298-99.26c-22.485-38.426-43.793-74.795-66.236-93.269V128c0-4.719-3.823-8.533-8.533-8.533\n                   H128c-4.71,0-8.533,3.814-8.533,8.533v20.326c-45.833,25.207-73.916,114.697-93.005,295.407H8.533\n                   c-4.71,0-8.533,3.814-8.533,8.533v51.2C0,508.186,3.823,512,8.533,512h51.2c4.71,0,8.533-3.814,8.533-8.533v-51.2\n                   c0-4.719-3.823-8.533-8.533-8.533H43.622c16.734-157.124,41.054-245.598,75.844-274.765V179.2c0,4.719,3.823,8.533,8.533,8.533\n                   h51.2c4.71,0,8.533-3.814,8.533-8.533v-5.973c16.614,18.56,33.664,47.667,51.499,78.14\n                   c26.539,45.363,53.948,92.117,85.035,111.829V384c0,4.719,3.823,8.533,8.533,8.533H384c4.71,0,8.533-3.814,8.533-8.533v-20.096\n                   c58.539-29.158,75.981-141.21,92.979-295.637h17.954c4.71,0,8.533-3.814,8.533-8.533v-51.2C512,3.814,508.177,0,503.467,0z\"/>\n           </svg>`;\n\t\t\t\tbreak;\n\t\t\tcase this._drawCtrl.modes.DRAW_POLYGON:\n\t\t\t\tbtn.title = this.options?.lang?.areaMeasurementButtonTitle ?? '';\n\t\t\t\tbtn.innerHTML = `<svg viewBox=\"0 0 48 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M18 38C18 40.2091 16.2091 42 14 42C11.7909 42 10 40.2091 10 38C10 35.7909 11.7909 34 14 34C16.2091 34 18 35.7909 18 38Z\" fill=\"#333333\"/>\n                <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14 40C15.1046 40 16 39.1046 16 38C16 36.8954 15.1046 36 14 36C12.8954 36 12 36.8954 12 38C12 39.1046 12.8954 40 14 40ZM14 42C16.2091 42 18 40.2091 18 38C18 35.7909 16.2091 34 14 34C11.7909 34 10 35.7909 10 38C10 40.2091 11.7909 42 14 42Z\" fill=\"#333333\"/>\n                <path d=\"M14 20C14 22.2091 12.2091 24 10 24C7.79086 24 6 22.2091 6 20C6 17.7909 7.79086 16 10 16C12.2091 16 14 17.7909 14 20Z\" fill=\"#333333\"/>\n                <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M10 22C11.1046 22 12 21.1046 12 20C12 18.8954 11.1046 18 10 18C8.89543 18 8 18.8954 8 20C8 21.1046 8.89543 22 10 22ZM10 24C12.2091 24 14 22.2091 14 20C14 17.7909 12.2091 16 10 16C7.79086 16 6 17.7909 6 20C6 22.2091 7.79086 24 10 24Z\" fill=\"#333333\"/>\n                <path d=\"M42 20C42 22.2091 40.2091 24 38 24C35.7909 24 34 22.2091 34 20C34 17.7909 35.7909 16 38 16C40.2091 16 42 17.7909 42 20Z\" fill=\"#333333\"/>\n                <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M38 22C39.1046 22 40 21.1046 40 20C40 18.8954 39.1046 18 38 18C36.8954 18 36 18.8954 36 20C36 21.1046 36.8954 22 38 22ZM38 24C40.2091 24 42 22.2091 42 20C42 17.7909 40.2091 16 38 16C35.7909 16 34 17.7909 34 20C34 22.2091 35.7909 24 38 24Z\" fill=\"#333333\"/>\n                <path d=\"M38 38C38 40.2091 36.2091 42 34 42C31.7909 42 30 40.2091 30 38C30 35.7909 31.7909 34 34 34C36.2091 34 38 35.7909 38 38Z\" fill=\"#333333\"/>\n                <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M34 40C35.1046 40 36 39.1046 36 38C36 36.8954 35.1046 36 34 36C32.8954 36 32 36.8954 32 38C32 39.1046 32.8954 40 34 40ZM34 42C36.2091 42 38 40.2091 38 38C38 35.7909 36.2091 34 34 34C31.7909 34 30 35.7909 30 38C30 40.2091 31.7909 42 34 42Z\" fill=\"#333333\"/>\n                <path d=\"M28 10C28 12.2091 26.2091 14 24 14C21.7909 14 20 12.2091 20 10C20 7.79086 21.7909 6 24 6C26.2091 6 28 7.79086 28 10Z\" fill=\"#333333\"/>\n                <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M24 12C25.1046 12 26 11.1046 26 10C26 8.89543 25.1046 8 24 8C22.8954 8 22 8.89543 22 10C22 11.1046 22.8954 12 24 12ZM24 14C26.2091 14 28 12.2091 28 10C28 7.79086 26.2091 6 24 6C21.7909 6 20 7.79086 20 10C20 12.2091 21.7909 14 24 14Z\" fill=\"#333333\"/>\n                <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M34.9188 19.028L25.9188 12.5994L27.0812 10.9719L36.0812 17.4005L34.9188 19.028ZM21.7844 12.8114L13.0812 19.028L11.9187 17.4005L20.6219 11.1839L21.7844 12.8114ZM11.6428 22.783L14.3095 34.783L12.3571 35.2169L9.69047 23.2169L11.6428 22.783ZM33.6905 34.783L36.246 23.283L38.1984 23.7169L35.6428 35.2169L33.6905 34.783ZM17 36.9999H31V38.9999H17V36.9999Z\" fill=\"#333333\"/>\n                </svg>\n                `;\n\t\t\t\tbreak;\n\t\t}\n\t\tbtn.addEventListener('click', () => {\n\t\t\tthis._drawCtrl.changeMode(mode);\n\t\t});\n\t\tthis._container.appendChild(btn);\n\t}\n\n\tinitClearBtn() {\n\t\tlet btn = document.createElement('button');\n\t\tbtn.type = 'button';\n\t\tbtn.title = this.options?.lang?.clearMeasurementsButtonTitle ?? '';\n\t\tbtn.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\"\n                            viewBox=\"0 0 465.311 465.311\" style=\"padding:5px\" xml:space=\"preserve\">\n                            <g>\n                                <path d=\"M372.811,51.002h-59.908V36.566C312.902,16.404,296.499,0,276.335,0h-87.356c-20.163,0-36.567,16.404-36.567,36.566v14.436\n                                    H92.5c-20.726,0-37.587,16.861-37.587,37.587v38.91c0,8.284,6.716,15,15,15h7.728v307.812c0,8.284,6.716,15,15,15H372.67\n                                    c8.284,0,15-6.716,15-15V142.499h7.728c8.284,0,15-6.716,15-15v-38.91C410.397,67.863,393.536,51.002,372.811,51.002z\n                                        M182.412,36.566c0-3.621,2.946-6.566,6.567-6.566h87.356c3.621,0,6.567,2.946,6.567,6.566v14.436h-100.49V36.566z M84.914,88.589\n                                    c0-4.184,3.403-7.587,7.587-7.587h280.31c4.184,0,7.587,3.403,7.587,7.587v23.91H84.914V88.589z M357.67,435.311H107.641V142.499\n                                    H357.67V435.311z\"/>\n                                <path d=\"M137.41,413.485c5.523,0,10-4.477,10-10V166.497c0-5.523-4.477-10-10-10s-10,4.477-10,10v236.988\n                                    C127.41,409.008,131.887,413.485,137.41,413.485z\"/>\n                                <path d=\"M200.907,413.485c5.523,0,10-4.477,10-10V166.497c0-5.523-4.477-10-10-10s-10,4.477-10,10v236.988\n                                    C190.907,409.008,195.384,413.485,200.907,413.485z\"/>\n                                <path d=\"M264.404,413.485c5.523,0,10-4.477,10-10V166.497c0-5.523-4.477-10-10-10s-10,4.477-10,10v236.988\n                                    C254.404,409.008,258.881,413.485,264.404,413.485z\"/>\n                                <path d=\"M327.901,413.485c5.523,0,10-4.477,10-10V166.497c0-5.523-4.477-10-10-10s-10,4.477-10,10v236.988\n                                    C317.901,409.008,322.378,413.485,327.901,413.485z\"/>\n                            </g>\n                            </svg>`;\n\t\tbtn.addEventListener('click', () => {\n\t\t\tthis._drawCtrl.deleteAll();\n\t\t\tthis._updateLabels();\n\t\t});\n\t\tthis._container.appendChild(btn);\n\t}\n\n\t_registerEvents() {\n\t\tif (this._map) {\n\t\t\tthis._map.on('load', () => {\n\t\t\t\tthis._recreateSourceAndLayers();\n\t\t\t});\n\t\t\tthis._map.on('draw.create', () => {\n\t\t\t\tthis._updateLabels();\n\t\t\t\tthis._handleOnCreate();\n\t\t\t});\n\t\t\tthis._map.on('draw.update', this._updateLabels.bind(this));\n\t\t\tthis._map.on('draw.delete', this._updateLabels.bind(this));\n\t\t\tthis._map.on('draw.render', () => {\n\t\t\t\tthis._updateLabels();\n\t\t\t\tthis._handleOnRender();\n\t\t\t});\n\t\t}\n\t}\n\n\t_recreateSourceAndLayers() {\n\t\tif (!this._map.getSource(DRAW_LABELS_SOURCE_ID))\n\t\t\tthis._map.addSource(DRAW_LABELS_SOURCE_ID, {\n\t\t\t\ttype: 'geojson',\n\t\t\t\tdata: SOURCE_DATA,\n\t\t\t});\n\t\tif (!this._map.getLayer(DRAW_LABELS_LAYER_ID))\n\t\t\tthis._map.addLayer({\n\t\t\t\tid: DRAW_LABELS_LAYER_ID,\n\t\t\t\ttype: 'symbol',\n\t\t\t\tsource: DRAW_LABELS_SOURCE_ID,\n\t\t\t\tlayout: {\n\t\t\t\t\t'text-font': [this.options?.style?.text?.font ?? 'Klokantech Noto Sans Bold'],\n\t\t\t\t\t'text-field': ['get', 'measurement'],\n\t\t\t\t\t'text-variable-anchor': ['top', 'bottom', 'left', 'right'],\n\t\t\t\t\t'text-radial-offset': this.options?.style?.text?.radialOffset ?? 0.5,\n\t\t\t\t\t'text-justify': 'auto',\n\t\t\t\t\t'text-letter-spacing': this.options?.style?.text?.letterSpacing ?? 0.05,\n\t\t\t\t\t'text-size': [\n\t\t\t\t\t\t'interpolate',\n\t\t\t\t\t\t['linear'],\n\t\t\t\t\t\t['zoom'],\n\t\t\t\t\t\t5,\n\t\t\t\t\t\t10,\n\t\t\t\t\t\t10,\n\t\t\t\t\t\t12.0,\n\t\t\t\t\t\t13,\n\t\t\t\t\t\t14.0,\n\t\t\t\t\t\t14,\n\t\t\t\t\t\t16.0,\n\t\t\t\t\t\t18,\n\t\t\t\t\t\t18.0, // Change 15.0 to 10.0 or lower\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tpaint: {\n\t\t\t\t\t'text-color': this.options?.style?.text?.color ?? '#D20C0C',\n\t\t\t\t\t'text-halo-color': this.options?.style?.text?.haloColor ?? '#fff',\n\t\t\t\t\t'text-halo-width': this.options?.style?.text?.haloWidth ?? 10,\n\t\t\t\t},\n\t\t\t});\n\t}\n\n\t_reorderLayers() {\n\t\tif (this._map) {\n\t\t\tlet mapboxGlSources = Object.values(MapboxDraw.constants.sources);\n\t\t\tthis._map\n\t\t\t\t.getStyle()\n\t\t\t\t.layers.filter((l) => mapboxGlSources.includes(l.source))\n\t\t\t\t.forEach((l) => {\n\t\t\t\t\tthis._map.moveLayer(l.id);\n\t\t\t\t});\n\n\t\t\t// move to top\n\t\t\tthis._map.moveLayer(DRAW_LABELS_LAYER_ID);\n\t\t}\n\t}\n\n\t/**\n\t * Handles the optional onRender callback provided in the options\n\t */\n\t_handleOnRender() {\n\t\tif (this.options && this.options.onRender !== null && this.options.onRender !== undefined && this.options.onRender instanceof Function) {\n\t\t\tconst features = this._getDrawnFeatures();\n\t\t\t// Pass drawn features to callback\n\t\t\ttry {\n\t\t\t\tthis.options.onRender.call(this, features);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handles the optional onCreate callback provided in the options\n\t */\n\t_handleOnCreate() {\n\t\tif (this.options && this.options.onCreate !== null && this.options.onCreate !== undefined && this.options.onCreate instanceof Function) {\n\t\t\tconst features = this._getDrawnFeatures();\n\t\t\t// Pass drawn features to callback\n\t\t\ttry {\n\t\t\t\tthis.options.onCreate.call(this, features);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n\n\t_updateLabels() {\n\t\tlet source = this._map.getSource(DRAW_LABELS_SOURCE_ID);\n\t\tif (!source && this._map) {\n\t\t\t// in case of the source is somehow missing, recreate and empty one\n\t\t\tthis._recreateSourceAndLayers();\n\t\t\tsource = this._map.getSource(DRAW_LABELS_SOURCE_ID);\n\t\t}\n\n\t\tconst data = this._getDrawnFeatures();\n\t\tsource.setData(data);\n\t\tthis._reorderLayers();\n\t}\n\n\t/**\n\t * Retrieves features drawn on the map\n\t * @returns {Object} A FeatureCollection of drawn features\n\t */\n\t_getDrawnFeatures() {\n\t\t// Build up the centroids for each segment into a features list, containing a property\n\t\t// to hold up the measurements\n\t\tlet features = [];\n\t\t// Generate features from what we have on the drawControl:\n\t\tlet drawnFeatures = this._drawCtrl.getAll();\n\t\tdrawnFeatures.features.forEach((feature) => {\n\t\t\ttry {\n\t\t\t\tif (feature.geometry.type === 'Polygon') {\n\t\t\t\t\tlet area = this._formatMeasure(turf.area(feature), true);\n\t\t\t\t\tlet centroid = turf.centroid(feature);\n\t\t\t\t\tlet measurement = `${area}`;\n\t\t\t\t\tcentroid.properties = {\n\t\t\t\t\t\tmeasurement,\n\t\t\t\t\t};\n\t\t\t\t\tfeatures.push(centroid);\n\t\t\t\t} else if (feature.geometry.type === 'LineString') {\n\t\t\t\t\tif (this.options?.showOnlyTotalLineLength) {\n\t\t\t\t\t\tconst lineLength = this._formatMeasure(turf.length(feature) * 1000); //km to m\n\t\t\t\t\t\tconst centroid = turf.centroid(feature);\n\t\t\t\t\t\tconst measurement = `${lineLength}`;\n\t\t\t\t\t\tcentroid.properties = {\n\t\t\t\t\t\t\tmeasurement,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfeatures.push(centroid);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet segments = turf.lineSegment(feature);\n\t\t\t\t\t\tsegments.features.forEach((segment) => {\n\t\t\t\t\t\t\tlet centroid = turf.centroid(segment);\n\t\t\t\t\t\t\tlet lineLength = this._formatMeasure(turf.length(segment) * 1000); //km to m\n\t\t\t\t\t\t\tlet measurement = `${lineLength}`;\n\t\t\t\t\t\t\tcentroid.properties = {\n\t\t\t\t\t\t\t\tmeasurement,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tfeatures.push(centroid);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t//Silently ignored\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: features,\n\t\t};\n\t}\n\n\tonRemove() {\n\t\tthis._container.parentNode.removeChild(this._container);\n\t\tthis._map.removeLayer(DRAW_LABELS_LAYER_ID);\n\t\tthis._map = undefined;\n\t}\n}\n"],"names":["classes","sources","cursors","types","geojsonTypes","modes","events","updateActions","meta","activeStates","interactions","LAT_MIN","LAT_RENDERED_MIN","LAT_MAX","LAT_RENDERED_MAX","isOfMetaType","type","e","featureTarget","isShiftMousedown","isActiveFeature","Constants.activeStates","Constants.meta","isInactiveFeature","noTarget","isFeature","isVertex","isShiftDown","isEscapeKey","isEnterKey","isBackspaceKey","isDeleteKey","isDigit1Key","isDigit2Key","isDigit3Key","isDigitKey","key","isTrue","wgs84","require$$0","geojsonArea","geometry","ringArea","_","area","i","polygonArea","coords","p1","p2","p3","lowerIndex","middleIndex","upperIndex","coordsLength","rad","FEATURE_SORT_RANKS","comparator","a","b","score","Constants.geojsonTypes","sortFeatures","features","feature","mapEventToBoundingBox","mapEvent","buffer","StringSet","items","l","x","values","k","META_TYPES","featuresAt","featuresAtClick","featuresAtTouch","event","bbox","ctx","box","queryParams","s","id","featureIds","uniqueFeatures","featureId","getFeatureAtAndSetCursors","Constants.cursors","euclideanDistance","y","FINE_TOLERANCE","GROSS_TOLERANCE","INTERVAL","isClick","start","end","options","fineTolerance","grossTolerance","interval","moveDistance","TAP_TOLERANCE","TAP_INTERVAL","isTap","tolerance","ModeHandler","mode","DrawContext","handlers","selector","fn","delegate","eventName","handles","iHandle","handle","nanoid","alphabet","defaultSize","size","generateID","Feature","geojson","property","value","properties","name","Point","pathOrLng","lngOrLat","lat","LineString","path","lng","Polygon","ring","ids","parts","ringId","coordId","models","MultiPoint","MultiLineString","MultiPolygon","takeAction","action","idx","tail","MultiFeature","coordinates","Model","f","ModeInterface","m","c","opts","actions","newSet","eventOpts","eventData","bufferType","eventMapper","eventKeys","objectToMode","modeObject","modeObjectKeys","startOpts","state","wrapper","eh","modeHandler","push","mouseDownInfo","touchStartInfo","currentModeName","currentMode","isDrag","endInfo","target","getFeaturesAndSetCursor","isKeyModeValid","CommonSelectors.isBackspaceKey","CommonSelectors.isDeleteKey","CommonSelectors.isDigitKey","Constants.classes","CommonSelectors.isDigit1Key","changeMode","Constants.modes","CommonSelectors.isDigit2Key","CommonSelectors.isDigit3Key","setup","map","store","style","modename","nextModeOptions","eventOptions","modebuilder","setupModeHandler","Constants.events","actionState","actionable","changed","toDenseArray","render","Constants.sources","cleanup","newHotIds","newColdIds","lastColdCount","coldChanged","renderFeature","source","featureInternal","Store","renderRequest","coordinate","holdRender","numRenders","Constants.updateActions","deletedFeaturesToEmit","refreshSelectedCoordinates","newSelectedCoordinates","point","Constants.interactions","interaction","classTypes","ui","buttonElements","activeButton","currentMapClasses","nextMapClasses","clearMapClasses","queueMapClasses","updateMapClasses","classesToRemove","classesToAdd","createControlButton","button","deactivateButtons","setActiveButton","addButtons","controls","controlGroup","Constants.types","removeButtons","buttonId","runSetup","controlContainer","mapLoadedInterval","dragPanIsEnabled","blue","orange","white","styles","p","other","dx","dy","angle","cos","sin","mouseEventPoint","mouseEvent","container","rect","createVertex","parentId","selected","earthRadius","factors","geom","feat","isNumber","lineString","featureCollection","fc","radiansToLength","radians","units","factor","degreesToRadians","degrees","num","coordEach","callback","excludeWrapCoord","j","stopG","geometryMaybeCollection","wrapShrink","coordIndex","isGeometryCollection","isFeatureCollection","stop","featureIndex","geomIndex","multiFeatureIndex","geometryIndex","geomType","geomEach","g","featureProperties","featureBBox","geomReduce","initialValue","previousValue","currentGeometry","flattenEach","segmentEach","feature2","segmentIndex","previousCoords","previousFeatureIndex","previousMultiIndex","prevGeomIndex","currentCoord","featureIndexCoord","multiPartIndexCoord","currentSegment","segmentReduce","started","clone","cloneFeature","cloneFeatureCollection","cloneGeometry","cloned","cloneProperties","item","deepSlice","coord","toMercator","convert","toWgs84","projection","mutate","convertToMercator","convertToWgs84","newCoord","lonLat","D2R","A","MAXEXTENT","adjusted","sign","xy","R2D","createMidpoint","parent","startVertex","endVertex","startCoord","endCoord","Constants.LAT_RENDERED_MAX","Constants.LAT_RENDERED_MIN","round","getMidpoint","midpointRaw","midpoint","createSupplementaryPoints","basePath","supplementaryPoints","isSelectedPath","line","lineIndex","processLine","processMultiGeometry","lineBasePath","firstPointString","lastVertex","pointIndex","pointPath","vertex","stringifiedPoint","subType","subCoordinates","index","subFeature","doubleClickZoom","LNG_MIN","LNG_MAX","Constants","extent","depth","lngs","lats","min","vals","max","constrainFeatureMovement","geojsonFeatures","delta","northInnerEdge","southInnerEdge","northOuterEdge","southOuterEdge","westEdge","eastEdge","bounds","featureSouthEdge","featureNorthEdge","featureWestEdge","featureEastEdge","constrainedDelta","moveFeatures","currentCoordinates","moveCoordinate","moveRing","moveMultiPolygon","multi","nextCoordinates","SimpleSelect","selectedFeatures","multiFeatures","combineFeatures","featureType","uncombineFeatures","trash","allFeatures","memo","CommonSelectors.isFeature","CommonSelectors.noTarget","CommonSelectors.isOfMetaType","wasSelected","isShiftClick","CommonSelectors.isShiftDown","selectedFeatureIds","isFeatureSelected","CommonSelectors.isActiveFeature","CommonSelectors.isShiftMousedown","current","minX","maxX","minY","maxY","translateValue","featuresInBox","idsToSelect","display","featuresCombined","subcoords","multiFeature","createdFeatures","featuresUncombined","isMidpoint","DirectSelect","about","selectedIndex","selectedCoordinates","paths","coord_path","selectedCoords","selectedCoordPoints","onVertex","isMidPoint","noCoords","DrawPoint","isActivePoint","CommonSelectors.isEscapeKey","CommonSelectors.isEnterKey","isEventAtCoordinates","DrawPolygon","polygon","CommonSelectors.isVertex","isActivePolygon","coordinateCount","endPos","lineCoordinates","DrawLineString","currentVertexPosition","direction","from","lastCoord","isActiveLine","simple_select","direct_select","draw_point","draw_polygon","draw_line_string","defaultOptions","showControls","hideControls","addSources","sourceBucket","setupOptions","withDefaults","fastDeepEqual","equal","length","keys","geojsonNormalize","normalize","gj","stringSetsAreEqual","featureTypes","setupAPI","api","silent","renderBatch","toDelete","newIds","newIdsLookup","internalFeature","originalProperties","isEqual","modeOptions","setupDraw","MapboxDraw","lib","getCoord","getCoords","distance","to","coordinates1","coordinates2","dLat","dLon","lat1","lat2","calculateArea","total","FACTOR","PI_OVER_180","lower","middle","upper","lowerX","middleY","upperX","lineSegment","results","lineSegmentFeature","createSegments","segment","segments","currentCoords","coords1","coords2","x1","y1","x2","y2","west","south","east","north","centroid","xSum","ySum","len","lengthUnits","areaUnits","allUnits","fromUnit","fromUnitData","baseValue","toUnit","toUnitData","system","ft2Value","m2Value","ftValue","mValue","DRAW_LABELS_SOURCE_ID","DRAW_LABELS_LAYER_ID","SOURCE_DATA","MeasuresControl","dist","isAreaMeasurement","measure","unit","val","formattedNumber","groupingSeparator","btn","mapboxGlSources","data","turf.area","turf.centroid","measurement","lineLength","turf.length","turf.lineSegment"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]}